/**
 * Planck.js v2.0-dev.0
 * @license The MIT license
 * @copyright Copyright (c) 2021 Erin Catto, Ali Shakiba
 *
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 *
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 *
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports):"function"==typeof define&&define.amd?define(["exports"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).planck={})}(this,(function(t){"use strict";var e=Object.defineProperty,i=(t,i,s)=>(((t,i,s)=>{i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[i]=s})(t,"symbol"!=typeof i?i+"":i,s),s);const s={create:0,tick:0,node:0,draw:0,fps:0};class o{constructor(t,e,i,s,o,n){this.reset(t,e,i,s,o,n)}toString(){return"["+this.a+", "+this.b+", "+this.c+", "+this.d+", "+this.e+", "+this.f+"]"}clone(){return new o(this.a,this.b,this.c,this.d,this.e,this.f)}reset(t,e,i,s,o,n){return this._dirty=!0,"object"==typeof t?(this.a=t.a,this.d=t.d,this.b=t.b,this.c=t.c,this.e=t.e,this.f=t.f):(this.a=t||1,this.d=s||1,this.b=e||0,this.c=i||0,this.e=o||0,this.f=n||0),this}identity(){return this._dirty=!0,this.a=1,this.b=0,this.c=0,this.d=1,this.e=0,this.f=0,this}rotate(t){if(!t)return this;this._dirty=!0;var e=t?Math.cos(t):1,i=t?Math.sin(t):0,s=e*this.a-i*this.b,o=e*this.b+i*this.a,n=e*this.c-i*this.d,r=e*this.d+i*this.c,h=e*this.e-i*this.f,a=e*this.f+i*this.e;return this.a=s,this.b=o,this.c=n,this.d=r,this.e=h,this.f=a,this}translate(t,e){return t||e?(this._dirty=!0,this.e+=t,this.f+=e,this):this}scale(t,e){return t-1||e-1?(this._dirty=!0,this.a*=t,this.b*=e,this.c*=t,this.d*=e,this.e*=t,this.f*=e,this):this}skew(t,e){if(!t&&!e)return this;this._dirty=!0;var i=this.a+this.b*t,s=this.b+this.a*e,o=this.c+this.d*t,n=this.d+this.c*e,r=this.e+this.f*t,h=this.f+this.e*e;return this.a=i,this.b=s,this.c=o,this.d=n,this.e=r,this.f=h,this}concat(t){this._dirty=!0;var e=this,i=e.a*t.a+e.b*t.c,s=e.b*t.d+e.a*t.b,o=e.c*t.a+e.d*t.c,n=e.d*t.d+e.c*t.b,r=e.e*t.a+t.e+e.f*t.c,h=e.f*t.d+t.f+e.e*t.b;return this.a=i,this.b=s,this.c=o,this.d=n,this.e=r,this.f=h,this}inverse(){if(this._dirty){this._dirty=!1,this.inverted=this.inverted||new o;var t=this.a*this.d-this.b*this.c;this.inverted.a=this.d/t,this.inverted.b=-this.b/t,this.inverted.c=-this.c/t,this.inverted.d=this.a/t,this.inverted.e=(this.c*this.f-this.e*this.d)/t,this.inverted.f=(this.e*this.b-this.a*this.f)/t}return this.inverted}map(t,e){return(e=e||{}).x=this.a*t.x+this.c*t.y+this.e,e.y=this.b*t.x+this.d*t.y+this.f,e}mapX(t,e){return"object"==typeof t&&(e=t.y,t=t.x),this.a*t+this.c*e+this.e}mapY(t,e){return"object"==typeof t&&(e=t.y,t=t.x),this.b*t+this.d*e+this.f}}var n=0;function r(t){this._owner=t,this._parent=null,this._relativeMatrix=new o,this._absoluteMatrix=new o,this.reset()}r.prototype.reset=function(){this._textureAlpha=1,this._alpha=1,this._width=0,this._height=0,this._scaleX=1,this._scaleY=1,this._skewX=0,this._skewY=0,this._rotation=0,this._pivoted=!1,this._pivotX=null,this._pivotY=null,this._handled=!1,this._handleX=0,this._handleY=0,this._aligned=!1,this._alignX=0,this._alignY=0,this._offsetX=0,this._offsetY=0,this._boxX=0,this._boxY=0,this._boxWidth=this._width,this._boxHeight=this._height,this._ts_translate=++n,this._ts_transform=++n,this._ts_matrix=++n},r.prototype._update=function(){return this._parent=this._owner._parent&&this._owner._parent._pin,this._handled&&this._mo_handle!=this._ts_transform&&(this._mo_handle=this._ts_transform,this._ts_translate=++n),this._aligned&&this._parent&&this._mo_align!=this._parent._ts_transform&&(this._mo_align=this._parent._ts_transform,this._ts_translate=++n),this},r.prototype.toString=function(){return this._owner+" ("+(this._parent?this._parent._owner:null)+")"},r.prototype.absoluteMatrix=function(){this._update();var t=Math.max(this._ts_transform,this._ts_translate,this._parent?this._parent._ts_matrix:0);if(this._mo_abs==t)return this._absoluteMatrix;this._mo_abs=t;var e=this._absoluteMatrix;return e.reset(this.relativeMatrix()),this._parent&&e.concat(this._parent._absoluteMatrix),this._ts_matrix=++n,e},r.prototype.relativeMatrix=function(){this._update();var t=Math.max(this._ts_transform,this._ts_translate,this._parent?this._parent._ts_transform:0);if(this._mo_rel==t)return this._relativeMatrix;this._mo_rel=t;var e,i,s=this._relativeMatrix;(s.identity(),this._pivoted&&s.translate(-this._pivotX*this._width,-this._pivotY*this._height),s.scale(this._scaleX,this._scaleY),s.skew(this._skewX,this._skewY),s.rotate(this._rotation),this._pivoted&&s.translate(this._pivotX*this._width,this._pivotY*this._height),this._pivoted)?(this._boxX=0,this._boxY=0,this._boxWidth=this._width,this._boxHeight=this._height):(s.a>0&&s.c>0||s.a<0&&s.c<0?(e=0,i=s.a*this._width+s.c*this._height):(e=s.a*this._width,i=s.c*this._height),e>i?(this._boxX=i,this._boxWidth=e-i):(this._boxX=e,this._boxWidth=i-e),s.b>0&&s.d>0||s.b<0&&s.d<0?(e=0,i=s.b*this._width+s.d*this._height):(e=s.b*this._width,i=s.d*this._height),e>i?(this._boxY=i,this._boxHeight=e-i):(this._boxY=e,this._boxHeight=i-e));return this._x=this._offsetX,this._y=this._offsetY,this._x-=this._boxX+this._handleX*this._boxWidth,this._y-=this._boxY+this._handleY*this._boxHeight,this._aligned&&this._parent&&(this._parent.relativeMatrix(),this._x+=this._alignX*this._parent._width,this._y+=this._alignY*this._parent._height),s.translate(this._x,this._y),this._relativeMatrix},r.prototype.get=function(t){if("function"==typeof h[t])return h[t](this)},r.prototype.set=function(t,e){if("string"==typeof t)"function"==typeof a[t]&&void 0!==e&&a[t](this,e);else if("object"==typeof t)for(e in t)"function"==typeof a[e]&&void 0!==t[e]&&a[e](this,t[e],t);return this._owner&&(this._owner._ts_pin=++n,this._owner.touch()),this};var h={alpha:function(t){return t._alpha},textureAlpha:function(t){return t._textureAlpha},width:function(t){return t._width},height:function(t){return t._height},boxWidth:function(t){return t._boxWidth},boxHeight:function(t){return t._boxHeight},scaleX:function(t){return t._scaleX},scaleY:function(t){return t._scaleY},skewX:function(t){return t._skewX},skewY:function(t){return t._skewY},rotation:function(t){return t._rotation},pivotX:function(t){return t._pivotX},pivotY:function(t){return t._pivotY},offsetX:function(t){return t._offsetX},offsetY:function(t){return t._offsetY},alignX:function(t){return t._alignX},alignY:function(t){return t._alignY},handleX:function(t){return t._handleX},handleY:function(t){return t._handleY}},a={alpha:function(t,e){t._alpha=e},textureAlpha:function(t,e){t._textureAlpha=e},width:function(t,e){t._width_=e,t._width=e,t._ts_transform=++n},height:function(t,e){t._height_=e,t._height=e,t._ts_transform=++n},scale:function(t,e){t._scaleX=e,t._scaleY=e,t._ts_transform=++n},scaleX:function(t,e){t._scaleX=e,t._ts_transform=++n},scaleY:function(t,e){t._scaleY=e,t._ts_transform=++n},skew:function(t,e){t._skewX=e,t._skewY=e,t._ts_transform=++n},skewX:function(t,e){t._skewX=e,t._ts_transform=++n},skewY:function(t,e){t._skewY=e,t._ts_transform=++n},rotation:function(t,e){t._rotation=e,t._ts_transform=++n},pivot:function(t,e){t._pivotX=e,t._pivotY=e,t._pivoted=!0,t._ts_transform=++n},pivotX:function(t,e){t._pivotX=e,t._pivoted=!0,t._ts_transform=++n},pivotY:function(t,e){t._pivotY=e,t._pivoted=!0,t._ts_transform=++n},offset:function(t,e){t._offsetX=e,t._offsetY=e,t._ts_translate=++n},offsetX:function(t,e){t._offsetX=e,t._ts_translate=++n},offsetY:function(t,e){t._offsetY=e,t._ts_translate=++n},align:function(t,e){this.alignX(t,e),this.alignY(t,e)},alignX:function(t,e){t._alignX=e,t._aligned=!0,t._ts_translate=++n,this.handleX(t,e)},alignY:function(t,e){t._alignY=e,t._aligned=!0,t._ts_translate=++n,this.handleY(t,e)},handle:function(t,e){this.handleX(t,e),this.handleY(t,e)},handleX:function(t,e){t._handleX=e,t._handled=!0,t._ts_translate=++n},handleY:function(t,e){t._handleY=e,t._handled=!0,t._ts_translate=++n},resizeMode:function(t,e,i){i&&("in"==e?e="in-pad":"out"==e&&(e="out-crop"),m(t,i.resizeWidth,i.resizeHeight,e))},resizeWidth:function(t,e,i){i&&i.resizeMode||m(t,e,null)},resizeHeight:function(t,e,i){i&&i.resizeMode||m(t,null,e)},scaleMode:function(t,e,i){i&&m(t,i.scaleWidth,i.scaleHeight,e)},scaleWidth:function(t,e,i){i&&i.scaleMode||m(t,e,null)},scaleHeight:function(t,e,i){i&&i.scaleMode||m(t,null,e)},matrix:function(t,e){this.scaleX(t,e.a),this.skewX(t,e.c/e.d),this.skewY(t,e.b/e.a),this.scaleY(t,e.d),this.offsetX(t,e.e),this.offsetY(t,e.f),this.rotation(t,0)}};function m(t,e,i,s){var o="number"==typeof e,r="number"==typeof i,h="string"==typeof s;t._ts_transform=++n,o&&(t._scaleX=e/t._width_,t._width=t._width_),r&&(t._scaleY=i/t._height_,t._height=t._height_),o&&r&&h&&("out"==s||"out-crop"==s?t._scaleX=t._scaleY=Math.max(t._scaleX,t._scaleY):"in"!=s&&"in-pad"!=s||(t._scaleX=t._scaleY=Math.min(t._scaleX,t._scaleY)),"out-crop"!=s&&"in-pad"!=s||(t._width=e/t._scaleX,t._height=i/t._scaleY))}r.prototype.scaleTo=function(t,e,i){m(this,t,e,i)},r._add_shortcuts=function(t){t.size=function(t,e){return this.pin("width",t),this.pin("height",e),this},t.width=function(t){return void 0===t?this.pin("width"):(this.pin("width",t),this)},t.height=function(t){return void 0===t?this.pin("height"):(this.pin("height",t),this)},t.offset=function(t,e){return"object"==typeof t&&(e=t.y,t=t.x),this.pin("offsetX",t),this.pin("offsetY",e),this},t.rotate=function(t){return this.pin("rotation",t),this},t.skew=function(t,e){return"object"==typeof t?(e=t.y,t=t.x):void 0===e&&(e=t),this.pin("skewX",t),this.pin("skewY",e),this},t.scale=function(t,e){return"object"==typeof t?(e=t.y,t=t.x):void 0===e&&(e=t),this.pin("scaleX",t),this.pin("scaleY",e),this},t.alpha=function(t,e){return this.pin("alpha",t),void 0!==e&&this.pin("textureAlpha",e),this}};var c=0;function l(t){if(t&&t instanceof u)return t;throw"Invalid node: "+t}s.create=0;const _=function(){return new u};function u(){s.create++,this._pin=new r(this)}function d(t,e){l(e),l(t),e.remove(),t._last&&(t._last._next=e,e._prev=t._last),e._parent=t,t._last=e,t._first||(t._first=e),e._parent._flag(e,!0),e._ts_parent=++c,t._ts_children=++c,t.touch()}function p(t,e){l(e),l(t),e.remove(),t._first&&(t._first._prev=e,e._next=t._first),e._parent=t,t._first=e,t._last||(t._last=e),e._parent._flag(e,!0),e._ts_parent=++c,t._ts_children=++c,t.touch()}function y(t,e){l(t),l(e),t.remove();var i=e._parent,s=e._prev;e._prev=t,s&&(s._next=t)||i&&(i._first=t),t._parent=i,t._prev=s,t._next=e,t._parent._flag(t,!0),t._ts_parent=++c,t.touch()}function x(t,e){l(t),l(e),t.remove();var i=e._parent,s=e._next;e._next=t,s&&(s._prev=t)||i&&(i._last=t),t._parent=i,t._prev=e,t._next=s,t._parent._flag(t,!0),t._ts_parent=++c,t.touch()}u.prototype.matrix=function(t){return!0===t?this._pin.relativeMatrix():this._pin.absoluteMatrix()},u.prototype.pin=function(t,e){return"object"==typeof t?(this._pin.set(t),this):"string"==typeof t?void 0===e?this._pin.get(t):(this._pin.set(t,e),this):void 0===t?this._pin:void 0},u.prototype.scaleTo=function(t,e,i){return"object"==typeof t&&(i=e,e=t.y,t=t.x),this._pin.scaleTo(t,e,i),this},r._add_shortcuts(u.prototype),u.prototype._label="",u.prototype._visible=!0,u.prototype._parent=null,u.prototype._next=null,u.prototype._prev=null,u.prototype._first=null,u.prototype._last=null,u.prototype._attrs=null,u.prototype._flags=null,u.prototype.toString=function(){return"["+this._label+"]"},u.prototype.id=function(t){return this.label(t)},u.prototype.label=function(t){return void 0===t?this._label:(this._label=t,this)},u.prototype.attr=function(t,e){return void 0===e?null!==this._attrs?this._attrs[t]:void 0:((null!==this._attrs?this._attrs:this._attrs={})[t]=e,this)},u.prototype.visible=function(t){return void 0===t?this._visible:(this._visible=t,this._parent&&(this._parent._ts_children=++c),this._ts_pin=++c,this.touch(),this)},u.prototype.hide=function(){return this.visible(!1)},u.prototype.show=function(){return this.visible(!0)},u.prototype.parent=function(){return this._parent},u.prototype.next=function(t){for(var e=this._next;e&&t&&!e._visible;)e=e._next;return e},u.prototype.prev=function(t){for(var e=this._prev;e&&t&&!e._visible;)e=e._prev;return e},u.prototype.first=function(t){for(var e=this._first;e&&t&&!e._visible;)e=e._next;return e},u.prototype.last=function(t){for(var e=this._last;e&&t&&!e._visible;)e=e._prev;return e},u.prototype.visit=function(t,e){var i=t.reverse,s=t.visible;if(!t.start||!t.start(this,e)){for(var o,n=i?this.last(s):this.first(s);o=n;)if(n=i?o.prev(s):o.next(s),o.visit(t,e))return!0;return t.end&&t.end(this,e)}},u.prototype.append=function(t,e){if(Array.isArray(t))for(var i=0;i<t.length;i++)d(this,t[i]);else if(void 0!==e)for(i=0;i<arguments.length;i++)d(this,arguments[i]);else void 0!==t&&d(this,t);return this},u.prototype.prepend=function(t,e){if(Array.isArray(t))for(var i=t.length-1;i>=0;i--)p(this,t[i]);else if(void 0!==e)for(i=arguments.length-1;i>=0;i--)p(this,arguments[i]);else void 0!==t&&p(this,t);return this},u.prototype.appendTo=function(t){return d(t,this),this},u.prototype.prependTo=function(t){return p(t,this),this},u.prototype.insertNext=function(t,e){if(Array.isArray(t))for(var i=0;i<t.length;i++)x(t[i],this);else if(void 0!==e)for(i=0;i<arguments.length;i++)x(arguments[i],this);else void 0!==t&&x(t,this);return this},u.prototype.insertPrev=function(t,e){if(Array.isArray(t))for(var i=t.length-1;i>=0;i--)y(t[i],this);else if(void 0!==e)for(i=arguments.length-1;i>=0;i--)y(arguments[i],this);else void 0!==t&&y(t,this);return this},u.prototype.insertAfter=function(t){return x(this,t),this},u.prototype.insertBefore=function(t){return y(this,t),this},u.prototype.remove=function(t,e){if(void 0!==t){if(Array.isArray(t))for(var i=0;i<t.length;i++)l(t[i]).remove();else if(void 0!==e)for(i=0;i<arguments.length;i++)l(arguments[i]).remove();else l(t).remove();return this}return this._prev&&(this._prev._next=this._next),this._next&&(this._next._prev=this._prev),this._parent&&(this._parent._first===this&&(this._parent._first=this._next),this._parent._last===this&&(this._parent._last=this._prev),this._parent._flag(this,!1),this._parent._ts_children=++c,this._parent.touch()),this._prev=this._next=this._parent=null,this._ts_parent=++c,this},u.prototype.empty=function(){for(var t,e=this._first;t=e;)e=t._next,t._prev=t._next=t._parent=null,this._flag(t,!1);return this._first=this._last=null,this._ts_children=++c,this.touch(),this},u.prototype._ts_touch=null,u.prototype.touch=function(){return this._ts_touch=++c,this._parent&&this._parent.touch(),this},u.prototype._flag=function(t,e){if(void 0===e)return null!==this._flags&&this._flags[t]||0;if("string"==typeof t&&(e?(this._flags=this._flags||{},!this._flags[t]&&this._parent&&this._parent._flag(t,!0),this._flags[t]=(this._flags[t]||0)+1):this._flags&&this._flags[t]>0&&(1==this._flags[t]&&this._parent&&this._parent._flag(t,!1),this._flags[t]=this._flags[t]-1)),"object"==typeof t&&t._flags)for(var i in t._flags)t._flags[i]>0&&this._flag(i,e);return this},u.prototype.hitTest=function(t){var e=this._pin._width,i=this._pin._height;return t.x>=0&&t.x<=e&&t.y>=0&&t.y<=i},u.prototype._textures=null,u.prototype._alpha=1,u.prototype.render=function(t){if(this._visible){s.node++;var e=this.matrix();t.setTransform(e.a,e.b,e.c,e.d,e.e,e.f),this._alpha=this._pin._alpha*(this._parent?this._parent._alpha:1);var i=this._pin._textureAlpha*this._alpha;if(t.globalAlpha!=i&&(t.globalAlpha=i),null!==this._textures)for(var o=0,n=this._textures.length;o<n;o++)this._textures[o].draw(t);t.globalAlpha!=this._alpha&&(t.globalAlpha=this._alpha);for(var r,h=this._first;r=h;)h=r._next,r.render(t)}},u.prototype._tickBefore=null,u.prototype._tickAfter=null,u.prototype.MAX_ELAPSE=1/0,u.prototype._tick=function(t,e,i){if(this._visible){t>this.MAX_ELAPSE&&(t=this.MAX_ELAPSE);var o=!1;if(null!==this._tickBefore)for(var n=0;n<this._tickBefore.length;n++){s.tick++,o=!0===this._tickBefore[n].call(this,t,e,i)||o}for(var r,h=this._first;r=h;)h=r._next,r._flag("_tick")&&(o=!0===r._tick(t,e,i)||o);if(null!==this._tickAfter)for(n=0;n<this._tickAfter.length;n++){s.tick++,o=!0===this._tickAfter[n].call(this,t,e,i)||o}return o}},u.prototype.tick=function(t,e){"function"==typeof t&&(e?(null===this._tickBefore&&(this._tickBefore=[]),this._tickBefore.push(t)):(null===this._tickAfter&&(this._tickAfter=[]),this._tickAfter.push(t)),this._flag("_tick",null!==this._tickAfter&&this._tickAfter.length>0||null!==this._tickBefore&&this._tickBefore.length>0))},u.prototype.untick=function(t){var e;"function"==typeof t&&(null!==this._tickBefore&&(e=this._tickBefore.indexOf(t))>=0&&this._tickBefore.splice(e,1),null!==this._tickAfter&&(e=this._tickAfter.indexOf(t))>=0&&this._tickAfter.splice(e,1))},u.prototype.timeout=function(t,e){this.setTimeout(t,e)},u.prototype.setTimeout=function(t,e){function i(s){if(!((e-=s)<0))return!0;this.untick(i),t.call(this)}return this.tick(i),i},u.prototype.clearTimeout=function(t){this.untick(t)},u.prototype._listeners=null,u.prototype._event_callback=function(t,e){this._flag(t,e)},u.prototype.on=function(t,e){if(!t||!t.length||"function"!=typeof e)return this;if(null===this._listeners&&(this._listeners={}),t=("string"!=typeof t&&"function"==typeof t.join?t.join(" "):t).match(/\S+/g))for(var i=0;i<t.length;i++){var s=t[i];this._listeners[s]=this._listeners[s]||[],this._listeners[s].push(e),"function"==typeof this._event_callback&&this._event_callback(s,!0)}return this},u.prototype.off=function(t,e){if(!t||!t.length||"function"!=typeof e)return this;if(null===this._listeners)return this;if(t=("string"!=typeof t&&"function"==typeof t.join?t.join(" "):t).match(/\S+/g))for(var i=0;i<t.length;i++){var s,o=t[i],n=this._listeners[o];n&&(s=n.indexOf(e))>=0&&(n.splice(s,1),n.length||delete this._listeners[o],"function"==typeof this._event_callback&&this._event_callback(o,!1))}return this},u.prototype.listeners=function(t){return this._listeners&&this._listeners[t]},u.prototype.publish=function(t,e){var i=this.listeners(t);if(!i||!i.length)return 0;for(var s=0;s<i.length;s++)i[s].apply(this,e);return i.length},u.prototype.trigger=function(t,e){return this.publish(t,e),this};var f=Math;const g=Object.create(Math);g.random=function(t,e){return void 0===t?(e=1,t=0):void 0===e&&(e=t,t=0),t==e?t:f.random()*(e-t)+t},g.wrap=function(t,e,i){return void 0===e?(i=1,e=0):void 0===i&&(i=e,e=0),i>e?(t=(t-e)%(i-e))+(t<0?i:e):(t=(t-i)%(e-i))+(t<=0?e:i)},g.clamp=function(t,e,i){return t<e?e:t>i?i:t},g.length=function(t,e){return f.sqrt(t*t+e*e)},g.rotate=g.wrap,g.limit=g.clamp;const v=function(t){var e=Object.prototype.toString.call(t);return"[object Function]"===e||"[object GeneratorFunction]"===e||"[object AsyncFunction]"===e},A=function(t){return"[object Object]"===Object.prototype.toString.call(t)&&t.constructor===Object};class b{constructor(t,e){"object"==typeof t&&this.src(t,e)}pipe(){return new b(this)}src(t,e,i,s){if("object"==typeof t){var o=t,n=e||1;this._image=o,this._sx=this._dx=0,this._sy=this._dy=0,this._sw=this._dw=o.width/n,this._sh=this._dh=o.height/n,this.width=o.width/n,this.height=o.height/n,this.ratio=n}else void 0===i?(i=t,s=e):(this._sx=t,this._sy=e),this._sw=this._dw=i,this._sh=this._dh=s,this.width=i,this.height=s;return this}dest(t,e,i,s){return this._dx=t,this._dy=e,this._dx=t,this._dy=e,void 0!==i&&(this._dw=i,this._dh=s,this.width=i,this.height=s),this}draw(t,e,i,o,n,r,h,a,m){var c=this._image;if(null!==c&&"object"==typeof c){var l=this._sx,_=this._sy,u=this._sw,d=this._sh,p=this._dx,y=this._dy,x=this._dw,f=this._dh;void 0!==r?(e=g.clamp(e,0,this._sw),o=g.clamp(o,0,this._sw-e),l+=e,_+=i=g.clamp(i,0,this._sh),u=o,d=n=g.clamp(n,0,this._sh-i),p=r,y=h,x=a,f=m):void 0!==o?(p=e,y=i,x=o,f=n):void 0!==e&&(x=e,f=i);var v=this.ratio||1;l*=v,_*=v,u*=v,d*=v;try{"function"==typeof c.draw?c.draw(t,l,_,u,d,p,y,x,f):(s.draw++,t.drawImage(c,l,_,u,d,p,y,x,f))}catch(t){c._draw_failed||(console.log("Unable to draw: ",c),console.log(t),c._draw_failed=!0)}}}}var B=new class extends b{constructor(){super(),i(this,"pipe",(function(){return this})),i(this,"src",(function(){return this})),i(this,"dest",(function(){return this})),i(this,"draw",(function(){})),this.x=this.y=this.width=this.height=0}},w=new I(B);var C={},M=[];class V extends b{constructor(t){super();var e=this;P(t,"filter"),P(t,"cutouts"),P(t,"sprites"),P(t,"factory");var i=t.map||t.filter,s=t.ppu||t.ratio||1,o=t.trim||0,n=t.textures,r=t.factory,h=t.cutouts||t.sprites;function a(t){if(!t||v(t.draw))return t;t=Object.assign({},t),v(i)&&(t=i(t)),1!=s&&(t.x*=s,t.y*=s,t.width*=s,t.height*=s,t.top*=s,t.bottom*=s,t.left*=s,t.right*=s),0!=o&&(t.x+=o,t.y+=o,t.width-=2*o,t.height-=2*o,t.top-=o,t.bottom-=o,t.left-=o,t.right-=o);var n=e.pipe();return n.top=t.top,n.bottom=t.bottom,n.left=t.left,n.right=t.right,n.src(t.x,t.y,t.width,t.height),n}function m(t){if(n){if(v(n))return n(t);if(A(n))return n[t]}if(h){for(var e=null,i=0,s=0;s<h.length;s++)string.startsWith(h[s].name,t)&&(0===i?e=h[s]:1===i?e=[e,h[s]]:e.push(h[s]),i++);return 0===i&&v(r)&&(e=function(e){return r(t+(e||""))}),e}}this.select=function(t){if(!t)return new I(this.pipe());var e=m(t);return e?new I(e,m,a):void 0}}}function I(t,e,i){function s(t,o){return t?v(t.draw)?t:A(t)&&"number"==typeof t.width&&"number"==typeof t.height&&v(i)?i(t):A(t)&&void 0!==o?s(t[o]):v(t)?s(t(o)):Array.isArray(t)?s(t[0]):"string"==typeof t&&v(e)?s(e(t)):void 0:B}this.one=function(e){return s(t,e)},this.array=function(e){var i=Array.isArray(e)?e:[];if(Array.isArray(t))for(var o=0;o<t.length;o++)i[o]=s(t[o]);else i[0]=s(t);return i}}const S=function(t){if("string"!=typeof t)return new I(t);var e,i,s=null;for((i=t.indexOf(":"))>0&&t.length>i+1&&(s=(e=C[t.slice(0,i)])&&e.select(t.slice(i+1))),!s&&(e=C[t])&&(s=e.select()),i=0;!s&&i<M.length;i++)s=M[i].select(t);return s||(console.error("Texture not found: "+t),s=w),s};function P(t,e,i){e in t&&console.log(i?i.replace("%name",e):"'"+e+"' field of texture atlas is deprecated.")}let T;class z{constructor(){i(this,"x",0),i(this,"y",0),i(this,"ratio",1),i(this,"stage"),i(this,"elem"),i(this,"clicklist",[]),i(this,"cancellist",[]),i(this,"handleStart",(t=>{t.preventDefault(),this.locate(t),this.publish(t.type,t),this.lookup("click",this.clicklist),this.lookup("mousecancel",this.cancellist)})),i(this,"handleMove",(t=>{t.preventDefault(),this.locate(t),this.publish(t.type,t)})),i(this,"handleEnd",(t=>{t.preventDefault(),this.publish(t.type,t),this.clicklist.length&&this.publish("click",t,this.clicklist),this.cancellist.length=0})),i(this,"handleCancel",(t=>{this.cancellist.length&&this.publish("mousecancel",t,this.cancellist),this.clicklist.length=0})),i(this,"toString",(function(){return(0|this.x)+"x"+(0|this.y)})),i(this,"locate",(function(t){const e=this.elem;let i,s;t.touches&&t.touches.length?(i=t.touches[0].clientX,s=t.touches[0].clientY):(i=t.clientX,s=t.clientY);var o=e.getBoundingClientRect();i-=o.left,s-=o.top,i-=0|e.clientLeft,s-=0|e.clientTop,this.x=i*this.ratio,this.y=s*this.ratio})),i(this,"lookup",(function(t,e){this.type=t,this.root=this.stage,this.event=null,e.length=0,this.collect=e,this.root.visit({reverse:!0,visible:!0,start:this.visitStart,end:this.visitEnd},this)})),i(this,"publish",(function(t,e,i){if(this.type=t,this.root=this.stage,this.event=e,this.collect=!1,this.timeStamp=Date.now(),"mousemove"!==t&&"touchmove"!==t&&console.log(this.type+" "+this),i){for(;i.length&&!this.visitEnd(i.shift()););i.length=0}else this.root.visit({reverse:!0,visible:!0,start:this.visitStart,end:this.visitEnd},this)})),i(this,"visitStart",(t=>!t._flag(this.type))),i(this,"visitEnd",(t=>{F.raw=this.event,F.type=this.type,F.timeStamp=this.timeStamp,F.abs.x=this.x,F.abs.y=this.y;var e=t.listeners(this.type);if(e&&(t.matrix().inverse().map(this,F),(t===this.root||t.attr("spy")||t.hitTest(F))&&(this.collect&&this.collect.push(t),this.event))){for(var i=!1,s=0;s<e.length;s++)i=!!e[s].call(t,F)||i;return i}}))}mount(t,e){return this.stage=t,this.elem=e,this.ratio=t.viewport().ratio||1,t.on("viewport",(t=>{this.ratio=t.ratio??this.ratio})),e.addEventListener("touchstart",this.handleStart),e.addEventListener("touchend",this.handleEnd),e.addEventListener("touchmove",this.handleMove),e.addEventListener("touchcancel",this.handleCancel),e.addEventListener("mousedown",this.handleStart),e.addEventListener("mouseup",this.handleEnd),e.addEventListener("mousemove",this.handleMove),document.addEventListener("mouseup",this.handleCancel),window.addEventListener("blur",this.handleCancel),this}unmount(){const t=this.elem;return t.removeEventListener("touchstart",this.handleStart),t.removeEventListener("touchend",this.handleEnd),t.removeEventListener("touchmove",this.handleMove),t.removeEventListener("touchcancel",this.handleCancel),t.removeEventListener("mousedown",this.handleStart),t.removeEventListener("mouseup",this.handleEnd),t.removeEventListener("mousemove",this.handleMove),document.removeEventListener("mouseup",this.handleCancel),window.removeEventListener("blur",this.handleCancel),this}}i(z,"CLICK","click"),i(z,"START","touchstart mousedown"),i(z,"MOVE","touchmove mousemove"),i(z,"END","touchend mouseup"),i(z,"CANCEL","touchcancel mousecancel");var F={},k={};function L(t,e,i){Object.defineProperty(t,e,{value:i})}function q(t){return t}L(F,"clone",(function(t){return(t=t||{}).x=this.x,t.y=this.y,t})),L(F,"toString",(function(){return(0|this.x)+"x"+(0|this.y)+" ("+this.abs+")"})),L(F,"abs",k),L(k,"clone",(function(t){return(t=t||{}).x=this.x,t.y=this.y,t})),L(k,"toString",(function(){return(0|this.x)+"x"+(0|this.y)}));var D={},j={},R={};class N{static get(t,e=q){if("function"==typeof t)return t;if("string"!=typeof t)return e;var i=D[t];if(i)return i;var s=/^(\w+)(-(in|out|in-out|out-in))?(\((.*)\))?$/i.exec(t);if(!s||!s.length)return e;var o=R[s[1]],n=j[s[3]],r=s[5];return i=o&&o.fn?o.fn:o&&o.fc?o.fc.apply(o.fc,r&&r.replace(/\s+/,"").split(",")):e,n&&(i=n.fn(i)),D[t]=i,i}static add(t){for(var e=(t.name||t.mode).split(/\s+/),i=0;i<e.length;i++){var s=e[i];s&&((t.name?R:j)[s]=t)}}}N.add({mode:"in",fn:function(t){return t}}),N.add({mode:"out",fn:function(t){return function(e){return 1-t(1-e)}}}),N.add({mode:"in-out",fn:function(t){return function(e){return e<.5?t(2*e)/2:1-t(2*(1-e))/2}}}),N.add({mode:"out-in",fn:function(t){return function(e){return e<.5?1-t(2*(1-e))/2:t(2*e)/2}}}),N.add({name:"linear",fn:function(t){return t}}),N.add({name:"quad",fn:function(t){return t*t}}),N.add({name:"cubic",fn:function(t){return t*t*t}}),N.add({name:"quart",fn:function(t){return t*t*t*t}}),N.add({name:"quint",fn:function(t){return t*t*t*t*t}}),N.add({name:"sin sine",fn:function(t){return 1-Math.cos(t*Math.PI/2)}}),N.add({name:"exp expo",fn:function(t){return 0==t?0:Math.pow(2,10*(t-1))}}),N.add({name:"circle circ",fn:function(t){return 1-Math.sqrt(1-t*t)}}),N.add({name:"bounce",fn:function(t){return t<1/2.75?7.5625*t*t:t<2/2.75?7.5625*(t-=1.5/2.75)*t+.75:t<2.5/2.75?7.5625*(t-=2.25/2.75)*t+.9375:7.5625*(t-=2.625/2.75)*t+.984375}}),N.add({name:"poly",fc:function(t){return function(e){return Math.pow(e,t)}}}),N.add({name:"elastic",fc:function(t,e){t=t||1;var i=(e=e||.45)/(2*Math.PI)*Math.asin(1/t);return function(s){return 1+t*Math.pow(2,-10*s)*Math.sin((s-i)*(2*Math.PI)/e)}}}),N.add({name:"back",fc:function(t){return t=void 0!==t?t:1.70158,function(e){return e*e*((t+1)*e-t)}}}),u.prototype.tween=function(t,e,i){let s;if(s="object"==typeof t&&null!==t?t:"number"==typeof t&&"number"==typeof e?{duration:t,delay:e,append:i}:"number"==typeof t?{duration:t,delay:0,append:e}:{duration:400,delay:0,append:t},!this._tweens){this._tweens=[];var o=0;this.tick((function(t,e,i){if(!this._tweens.length)return!1;var s=o!=i;if(o=e,s)return!0;var n=this._tweens[0];if(n.tick(this,t,e,i)){n===this._tweens[0]&&this._tweens.shift();var r=n.finish();r&&this._tweens.unshift(r)}return!0}),!0)}this.touch(),s.append||(this._tweens.length=0);var n=new E(this,s);return this._tweens.push(n),n};class E{constructor(t,e={}){i(this,"_ending",[]),this._end={},this._duration=e.duration||400,this._delay=e.delay||0,this._owner=t,this._time=0}tick(t,e,i,s){if(this._time+=e,!(this._time<this._delay)){var o=this._time-this._delay;if(!this._start)for(var n in this._start={},this._end)this._start[n]=this._owner.pin(n);var r=Math.min(o/this._duration,1),h=r>=1;"function"==typeof this._easing&&(r=this._easing(r));var a=1-r;for(var n in this._end)this._owner.pin(n,this._start[n]*a+this._end[n]*r);return h}}finish(){return this._ending.forEach((t=>{try{t.call(this._owner)}catch(t){console.error(t)}})),this._next}tween(t,e){return this._next=new E(this._owner,t,e)}duration(t){return this._duration=t,this}delay(t){return this._delay=t,this}ease(t){return this._easing=N.get(t),this}done(t){return this._ending.push(t),this}hide(){return this._ending.push((function(){this.hide()})),this._hide=!0,this}remove(){return this._ending.push((function(){this.remove()})),this._remove=!0,this}pin(t,e){if("object"==typeof t)for(var i in t)O(this._owner,this._end,i,t[i]);else void 0!==e&&O(this._owner,this._end,t,e);return this}then(t){return this.done(t),this}clear(t){return this}}function O(t,e,i,s){"number"==typeof t.pin(i)?e[i]=s:"number"==typeof t.pin(i+"X")&&"number"==typeof t.pin(i+"Y")&&(e[i+"X"]=s,e[i+"Y"]=s)}r._add_shortcuts(E.prototype);const Y=[];class W extends u{constructor(){super(),i(this,"canvas",null),i(this,"dom",null),i(this,"context",null),i(this,"pixelWidth",-1),i(this,"pixelHeight",-1),i(this,"pixelRatio",1),i(this,"drawingWidth",0),i(this,"drawingHeight",0),i(this,"mounted",!1),i(this,"paused",!1),i(this,"sleep",!1),i(this,"mount",((t={})=>{if("string"==typeof t.canvas?this.canvas=document.getElementById(t.canvas):t.canvas instanceof HTMLCanvasElement?this.canvas=t.canvas:t.canvas,this.canvas||(this.canvas=document.getElementById("cutjs")||document.getElementById("stage")),!this.canvas){console.log("Creating Canvas..."),this.canvas=document.createElement("canvas"),Object.assign(this.canvas.style,{position:"absolute",display:"block",top:"0",left:"0",bottom:"0",right:"0",width:"100%",height:"100%"});let t=document.body;t.insertBefore(this.canvas,t.firstChild)}this.dom=this.canvas,this.context=this.canvas.getContext("2d"),this.devicePixelRatio=window.devicePixelRatio||1,this.backingStoreRatio=this.context.webkitBackingStorePixelRatio||this.context.mozBackingStorePixelRatio||this.context.msBackingStorePixelRatio||this.context.oBackingStorePixelRatio||this.context.backingStorePixelRatio||1,this.pixelRatio=this.devicePixelRatio/this.backingStoreRatio,this.mounted=!0,Y.push(this),this.requestFrame(this.onFrame)})),i(this,"frameRequested",!1),i(this,"requestFrame",(()=>{this.frameRequested||(this.frameRequested=!0,requestAnimationFrame(this.onFrame))})),i(this,"lastTime",0),i(this,"_mo_touch",null),i(this,"onFrame",(t=>{if(this.frameRequested=!1,!this.mounted)return;this.requestFrame();const e=this.canvas.clientWidth,i=this.canvas.clientHeight;this.pixelWidth===e&&this.pixelHeight===i||(this.pixelWidth=e,this.pixelHeight=i,this.drawingWidth=e*this.pixelRatio,this.drawingHeight=i*this.pixelRatio,this.canvas.width===this.drawingWidth&&this.canvas.height===this.drawingHeight||(this.canvas.width=this.drawingWidth,this.canvas.height=this.drawingHeight,console.log("Resize: ["+this.drawingWidth+", "+this.drawingHeight+"] = "+this.pixelRatio+" x ["+this.pixelWidth+", "+this.pixelHeight+"]"),this.viewport({width:this.drawingWidth,height:this.drawingHeight,ratio:this.pixelRatio})));let o=this.lastTime||t,n=t-o;if(!this.mounted||this.paused||this.sleep)return;this.lastTime=t;let r=this._tick(n,t,o);this._mo_touch!=this._ts_touch?(this._mo_touch=this._ts_touch,this.sleep=!1,this.drawingWidth>0&&this.drawingHeight>0&&(this.context.setTransform(1,0,0,1,0,0),this.context.clearRect(0,0,this.drawingWidth,this.drawingHeight),this.render(this.context))):this.sleep=!r,s.fps=n?1e3/n:0})),this.label("Root")}resume(){return(this.sleep||this.paused)&&this.requestFrame(),this.paused=!1,this.sleep=!1,this.publish("resume"),this}pause(){return this.paused||this.publish("pause"),this.paused=!0,this}touch(){return(this.sleep||this.paused)&&this.requestFrame(),this.sleep=!1,u.prototype.touch()}unmount(){var t;this.mounted=!1;let e=Y.indexOf(this);return e>=0&&Y.splice(e,1),null==(t=this.mouse)||t.unmount(),this}background(t){return this.dom.style.backgroundColor=t,this}viewport(t,e,i){if(void 0===t)return Object.assign({},this._viewport);if("object"==typeof t){const s=t;t=s.width,e=s.height,i=s.ratio}this._viewport={width:t,height:e,ratio:i||1},this.viewbox();let s=Object.assign({},this._viewport);return this.visit({start:function(t){if(!t._flag("viewport"))return!0;t.publish("viewport",[s])}}),this}viewbox(t,e,i){return"number"==typeof t&&"number"==typeof e?this._viewbox={width:t,height:e,mode:i}:"object"==typeof t&&null!==t&&(this._viewbox={...t}),this.rescale(),this}camera(t){return this._camera=t,this.rescale(),this}rescale(){let t=this._viewbox,e=this._viewport,i=this._camera;if(e&&t){const s=e.width,o=e.height,n=/^(in|out|in-pad|out-crop)$/.test(t.mode)?t.mode:"in-pad",r=t.width,h=t.height;this.pin({width:r,height:h}),this.scaleTo(s,o,n);const a=t.x||0,m=t.y||0,c=(null==i?void 0:i.a)||1,l=(null==i?void 0:i.e)||0,_=(null==i?void 0:i.f)||0,u=this.pin("scaleX"),d=this.pin("scaleY");this.pin("scaleX",u*c),this.pin("scaleY",d*c),this.pin("offsetX",l-a*u*c),this.pin("offsetY",_-m*d*c)}else e&&this.pin({width:e.width,height:e.height});return this}}const J=function(t){var e=new X;return t&&e.texture(t),e};function X(){X._super.call(this),this.label("Sprite"),this._textures=[],this._image=null}X._super=u,X.prototype=Object.create(X._super.prototype),X.prototype.texture=function(t){return this._image=S(t).one(),this.pin("width",this._image?this._image.width:0),this.pin("height",this._image?this._image.height:0),this._textures[0]=this._image.pipe(),this._textures.length=1,this},X.prototype.tile=function(t){return this._repeat(!1,t),this},X.prototype.stretch=function(t){return this._repeat(!0,t),this},X.prototype._repeat=function(t,e){var i=this;function s(t,e,s,o,n,r,h,a,m){var c=i._textures.length>t?i._textures[t]:i._textures[t]=i._image.pipe();c.src(e,s,o,n),c.dest(r,h,a,m)}this.untick(this._repeatTicker),this.tick(this._repeatTicker=function(){if(this._mo_stretch!=this._pin._ts_transform){this._mo_stretch=this._pin._ts_transform;var i=this.pin("width"),o=this.pin("height");this._textures.length=function(t,e,i,s,o,n){var r=t.width,h=t.height,a=t.left,m=t.right,c=t.top,l=t.bottom;r=r-(a="number"==typeof a&&a==a?a:0)-(m="number"==typeof m&&m==m?m:0),h=h-(c="number"==typeof c&&c==c?c:0)-(l="number"==typeof l&&l==l?l:0),o||(e=Math.max(e-a-m,0),i=Math.max(i-c-l,0));var _=0;c>0&&a>0&&n(_++,0,0,a,c,0,0,a,c);l>0&&a>0&&n(_++,0,h+c,a,l,0,i+c,a,l);c>0&&m>0&&n(_++,r+a,0,m,c,e+a,0,m,c);l>0&&m>0&&n(_++,r+a,h+c,m,l,e+a,i+c,m,l);if(s)c>0&&n(_++,a,0,r,c,a,0,e,c),l>0&&n(_++,a,h+c,r,l,a,i+c,e,l),a>0&&n(_++,0,c,a,h,0,c,a,i),m>0&&n(_++,r+a,c,m,h,e+a,c,m,i),n(_++,a,c,r,h,a,c,e,i);else for(var u,d=a,p=e;p>0;){u=Math.min(r,p),p-=r;for(var y,x=c,f=i;f>0;)y=Math.min(h,f),f-=h,n(_++,a,c,u,y,d,x,u,y),p<=0&&(a&&n(_++,0,c,a,y,0,x,a,y),m&&n(_++,r+a,c,m,y,d+u,x,m,y)),x+=y;c&&n(_++,a,0,u,c,d,0,u,c),l&&n(_++,a,h+c,u,l,d,x,u,l),d+=u}return _}(this._image,i,o,t,e,s)}})},X.prototype.image=X.prototype.texture;const H=J,K=X;Z._super=u,Z.prototype=Object.create(Z._super.prototype);function Z(){Z._super.call(this),this.label("Anim"),this._textures=[],this._fps=15,this._ft=1e3/this._fps,this._time=-1,this._repeat=0,this._index=0,this._frames=[];var t=0;this.tick((function(e,i,s){if(!(this._time<0||this._frames.length<=1)){var o=t!=s;if(t=i,o)return!0;if(this._time+=e,this._time<this._ft)return!0;var n=this._time/this._ft|0;return this._time-=n*this._ft,this.moveFrame(n),!(this._repeat>0&&(this._repeat-=n)<=0)||(this.stop(),this._callback&&this._callback(),!1)}}),!1)}Z.prototype.fps=function(t){return void 0===t?this._fps:(this._fps=t>0?t:15,this._ft=1e3/this._fps,this)},Z.prototype.setFrames=function(t,e,i){return this.frames(t,e,i)},Z.prototype.frames=function(t){return this._index=0,this._frames=S(t).array(),this.touch(),this},Z.prototype.length=function(){return this._frames?this._frames.length:0},Z.prototype.gotoFrame=function(t,e){return this._index=0|g.wrap(t,this._frames.length),e=e||!this._textures[0],this._textures[0]=this._frames[this._index],e&&(this.pin("width",this._textures[0].width),this.pin("height",this._textures[0].height)),this.touch(),this},Z.prototype.moveFrame=function(t){return this.gotoFrame(this._index+t)},Z.prototype.repeat=function(t,e){return this._repeat=t*this._frames.length-1,this._callback=e,this.play(),this},Z.prototype.play=function(t){return void 0!==t?(this.gotoFrame(t),this._time=0):this._time<0&&(this._time=0),this.touch(),this},Z.prototype.stop=function(t){return this._time=-1,void 0!==t&&this.gotoFrame(t),this};function U(){U._super.call(this),this.label("String"),this._textures=[]}U._super=u,U.prototype=Object.create(U._super.prototype),U.prototype.setFont=function(t,e,i){return this.frames(t,e,i)},U.prototype.frames=function(t){return this._textures=[],"string"==typeof t?(t=S(t),this._item=function(e){return t.one(e)}):"object"==typeof t?this._item=function(e){return t[e]}:"function"==typeof t&&(this._item=t),this},U.prototype.setValue=function(t,e,i){return this.value(t,e,i)},U.prototype.value=function(t){if(void 0===t)return this._value;if(this._value===t)return this;this._value=t,null===t?t="":"string"==typeof t||Array.isArray(t)||(t=t.toString()),this._spacing=this._spacing||0;for(var e=0,i=0,s=0;s<t.length;s++){var o=this._textures[s]=this._item(t[s]);e+=s>0?this._spacing:0,o.dest(e,0),e+=o.width,i=Math.max(i,o.height)}return this.pin("width",e),this.pin("height",i),this._textures.length=t.length,this};u.prototype.row=function(t){return this.align("row",t),this};u.prototype.column=function(t){return this.align("column",t),this},u.prototype.align=function(t,e){return this._padding=this._padding||0,this._spacing=this._spacing||0,this.untick(this._layoutTiker),this.tick(this._layoutTiker=function(){if(this._mo_seq!=this._ts_touch){this._mo_seq=this._ts_touch;var i=this._mo_seqAlign!=this._ts_children;this._mo_seqAlign=this._ts_children;for(var s,o=0,n=0,r=this.first(!0),h=!0;s=r;){r=s.next(!0),s.matrix(!0);var a=s.pin("boxWidth"),m=s.pin("boxHeight");"column"==t?(!h&&(n+=this._spacing),s.pin("offsetY")!=n&&s.pin("offsetY",n),o=Math.max(o,a),n+=m,i&&s.pin("alignX",e)):"row"==t&&(!h&&(o+=this._spacing),s.pin("offsetX")!=o&&s.pin("offsetX",o),o+=a,n=Math.max(n,m),i&&s.pin("alignY",e)),h=!1}o+=2*this._padding,n+=2*this._padding,this.pin("width")!=o&&this.pin("width",o),this.pin("height")!=n&&this.pin("height",n)}}),this};u.prototype.box=function(){return this._padding=this._padding||0,this.untick(this._layoutTiker),this.tick(this._layoutTiker=function(){if(this._mo_box!=this._ts_touch){this._mo_box=this._ts_touch;for(var t,e=0,i=0,s=this.first(!0);t=s;){s=t.next(!0),t.matrix(!0);var o=t.pin("boxWidth"),n=t.pin("boxHeight");e=Math.max(e,o),i=Math.max(i,n)}e+=2*this._padding,i+=2*this._padding,this.pin("width")!=e&&this.pin("width",e),this.pin("height")!=i&&this.pin("height",i)}}),this};u.prototype.layer=function(){return this.untick(this._layoutTiker),this.tick(this._layoutTiker=function(){var t=this.parent();if(t){var e=t.pin("width");this.pin("width")!=e&&this.pin("width",e);var i=t.pin("height");this.pin("height")!=i&&this.pin("height",i)}},!0),this},u.prototype.padding=function(t){return this._padding=t,this},u.prototype.spacing=function(t){return this._spacing=t,this};const G=Object.freeze(Object.defineProperty({__proto__:null,Anim:Z,Atlas:V,Image:K,Math:g,Matrix:o,Mouse:z,Node:u,Pin:r,Root:W,Sprite:X,Str:U,Texture:b,Tween:E,anim:function(t,e){var i=new Z;return i.frames(t).gotoFrame(0),e&&i.fps(e),i},atlas:async function(t){var e=v(t.draw)?t:new V(t);t.name&&(C[t.name]=e),M.push(e),P(t,"imagePath"),P(t,"imageRatio");var i,s=t.imagePath,o=t.imageRatio||1;if("string"==typeof t.image?s=t.image:A(t.image)&&(s=t.image.src||t.image.url,o=t.image.ratio||o),s){const t=await(i=s,console.log("Loading image: "+i),new Promise((function(t,e){const s=new Image;s.onload=function(){console.log("Image loaded: "+i),t(s)},s.onerror=function(t){console.log("Loading failed: "+i),e(t)},s.src=i})));e.src(t,o)}return e},box:function(){return _().box().label("Box")},canvas:function(t,e,i){"string"==typeof t?"object"==typeof e||("function"==typeof e&&(i=e),e={}):("function"==typeof t&&(i=t),e={},t="2d");var s=document.createElement("canvas"),o=s.getContext(t,e),n=new b(s);return n.context=function(){return o},n.size=function(t,e,i){return i=i||1,s.width=t*i,s.height=e*i,this.src(s,i),this},n.canvas=function(t){return"function"==typeof t?t.call(this,o):void 0===t&&"function"==typeof i&&i.call(this,o),this},"function"==typeof i&&i.call(n,o),n},column:function(t){return _().column(t).label("Row")},create:_,image:H,layer:function(){return _().layer().label("Layer")},math:g,memoizeDraw:function(t,e=(()=>null)){const i="undefined"!=typeof window&&window.devicePixelRatio||1;let s,o=0,n=Stage.canvas(),r=Stage.sprite(),h=!0;return r.tick((function(){let a=this._parent.matrix();if(h&&(h=!1,!(a=T)))return;T=a;let m=Math.max(Math.abs(a.a),Math.abs(a.b)),c=o/m;if(0===o||c>1.25||c<.8){const h=e();s!==h&&(o=m,t(2.5*m/i,n,r),r.texture(n),r.__timestamp=Date.now())}}),!1),r},mount:function(t={}){let e=new W;return e.mount(t),e.mouse=(new z).mount(e,e.dom),e},pause:function(){for(let t=Y.length-1;t>=0;t--)Y[t].pause()},resume:function(){for(let t=Y.length-1;t>=0;t--)Y[t].resume()},row:function(t){return _().row(t).label("Row")},sprite:J,string:function(t){return(new U).frames(t)},texture:S},Symbol.toStringTag,{value:"Module"})),Q=function(t,e){null==t&&(t={});const i=Object.assign({},t);for(const s in e)e.hasOwnProperty(s)&&void 0===t[s]&&(i[s]=e[s]);if("function"==typeof Object.getOwnPropertySymbols){const s=Object.getOwnPropertySymbols(e);for(let o=0;o<s.length;o++){const n=s[o];e.propertyIsEnumerable(n)&&void 0===t[n]&&(i[n]=e[n])}}return i},$=Object.assign(Object.create(Math),{EPSILON:1e-9,isFinite:function(t){return"number"==typeof t&&isFinite(t)&&!isNaN(t)},assert:function(t){},nextPowerOfTwo:function(t){return t|=t>>1,t|=t>>2,t|=t>>4,t|=t>>8,(t|=t>>16)+1},isPowerOfTwo:function(t){return t>0&&0==(t&t-1)},mod:function(t,e,i){return void 0===e?(i=1,e=0):void 0===i&&(i=e,e=0),i>e?(t=(t-e)%(i-e))+(t<0?i:e):(t=(t-i)%(e-i))+(t<=0?e:i)},clamp:function(t,e,i){return t<e?e:t>i?i:t},random:function(t,e){return void 0===t?(e=1,t=0):void 0===e&&(e=t,t=0),t===e?t:Math.random()*(e-t)+t}});class tt{constructor(t,e){void 0===t?(this.x=0,this.y=0):"object"==typeof t?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e)}_serialize(){return{x:this.x,y:this.y}}static _deserialize(t){const e=Object.create(tt.prototype);return e.x=t.x,e.y=t.y,e}static zero(){const t=Object.create(tt.prototype);return t.x=0,t.y=0,t}static neo(t,e){const i=Object.create(tt.prototype);return i.x=t,i.y=e,i}static clone(t){return tt.neo(t.x,t.y)}toString(){return JSON.stringify(this)}static isValid(t){return null!=t&&($.isFinite(t.x)&&$.isFinite(t.y))}static assert(t){}clone(){return tt.clone(this)}setZero(){return this.x=0,this.y=0,this}set(t,e){return"object"==typeof t?(this.x=t.x,this.y=t.y):(this.x=t,this.y=e),this}setNum(t,e){return this.x=t,this.y=e,this}setVec2(t){return this.x=t.x,this.y=t.y,this}wSet(t,e,i,s){return void 0!==i||void 0!==s?this.setCombine(t,e,i,s):this.setMul(t,e)}setCombine(t,e,i,s){const o=t*e.x+i*s.x,n=t*e.y+i*s.y;return this.x=o,this.y=n,this}setMul(t,e){const i=t*e.x,s=t*e.y;return this.x=i,this.y=s,this}add(t){return this.x+=t.x,this.y+=t.y,this}wAdd(t,e,i,s){return void 0!==i||void 0!==s?this.addCombine(t,e,i,s):this.addMul(t,e)}addCombine(t,e,i,s){const o=t*e.x+i*s.x,n=t*e.y+i*s.y;return this.x+=o,this.y+=n,this}addMul(t,e){const i=t*e.x,s=t*e.y;return this.x+=i,this.y+=s,this}wSub(t,e,i,s){return void 0!==i||void 0!==s?this.subCombine(t,e,i,s):this.subMul(t,e)}subCombine(t,e,i,s){const o=t*e.x+i*s.x,n=t*e.y+i*s.y;return this.x-=o,this.y-=n,this}subMul(t,e){const i=t*e.x,s=t*e.y;return this.x-=i,this.y-=s,this}sub(t){return this.x-=t.x,this.y-=t.y,this}mul(t){return this.x*=t,this.y*=t,this}length(){return tt.lengthOf(this)}lengthSquared(){return tt.lengthSquared(this)}normalize(){const t=this.length();if(t<$.EPSILON)return 0;const e=1/t;return this.x*=e,this.y*=e,t}static lengthOf(t){return $.sqrt(t.x*t.x+t.y*t.y)}static lengthSquared(t){return t.x*t.x+t.y*t.y}static distance(t,e){const i=t.x-e.x,s=t.y-e.y;return $.sqrt(i*i+s*s)}static distanceSquared(t,e){const i=t.x-e.x,s=t.y-e.y;return i*i+s*s}static areEqual(t,e){return t===e||"object"==typeof e&&null!==e&&t.x===e.x&&t.y===e.y}static skew(t){return tt.neo(-t.y,t.x)}static dot(t,e){return t.x*e.x+t.y*e.y}static cross(t,e){return"number"==typeof e?tt.neo(e*t.y,-e*t.x):"number"==typeof t?tt.neo(-t*e.y,t*e.x):t.x*e.y-t.y*e.x}static crossVec2Vec2(t,e){return t.x*e.y-t.y*e.x}static crossVec2Num(t,e){return tt.neo(e*t.y,-e*t.x)}static crossNumVec2(t,e){return tt.neo(-t*e.y,t*e.x)}static addCross(t,e,i){return"number"==typeof i?tt.neo(i*e.y+t.x,-i*e.x+t.y):"number"==typeof e?tt.neo(-e*i.y+t.x,e*i.x+t.y):void 0}static addCrossVec2Num(t,e,i){return tt.neo(i*e.y+t.x,-i*e.x+t.y)}static addCrossNumVec2(t,e,i){return tt.neo(-e*i.y+t.x,e*i.x+t.y)}static add(t,e){return tt.neo(t.x+e.x,t.y+e.y)}static wAdd(t,e,i,s){return void 0!==i||void 0!==s?tt.combine(t,e,i,s):tt.mulNumVec2(t,e)}static combine(t,e,i,s){return tt.zero().setCombine(t,e,i,s)}static sub(t,e){return tt.neo(t.x-e.x,t.y-e.y)}static mul(t,e){return"object"==typeof t?tt.neo(t.x*e,t.y*e):"object"==typeof e?tt.neo(t*e.x,t*e.y):void 0}static mulVec2Num(t,e){return tt.neo(t.x*e,t.y*e)}static mulNumVec2(t,e){return tt.neo(t*e.x,t*e.y)}neg(){return this.x=-this.x,this.y=-this.y,this}static neg(t){return tt.neo(-t.x,-t.y)}static abs(t){return tt.neo($.abs(t.x),$.abs(t.y))}static mid(t,e){return tt.neo(.5*(t.x+e.x),.5*(t.y+e.y))}static upper(t,e){return tt.neo($.max(t.x,e.x),$.max(t.y,e.y))}static lower(t,e){return tt.neo($.min(t.x,e.x),$.min(t.y,e.y))}clamp(t){const e=this.x*this.x+this.y*this.y;if(e>t*t){const i=t/$.sqrt(e);this.x*=i,this.y*=i}return this}static clamp(t,e){const i=tt.neo(t.x,t.y);return i.clamp(e),i}static scaleFn(t,e){return function(i){return tt.neo(i.x*t,i.y*e)}}static translateFn(t,e){return function(i){return tt.neo(i.x+t,i.y+e)}}}class et{constructor(t,e){this.lowerBound=tt.zero(),this.upperBound=tt.zero(),"object"==typeof t&&this.lowerBound.setVec2(t),"object"==typeof e?this.upperBound.setVec2(e):"object"==typeof t&&this.upperBound.setVec2(t)}isValid(){return et.isValid(this)}static isValid(t){return null!=t&&(tt.isValid(t.lowerBound)&&tt.isValid(t.upperBound)&&tt.sub(t.upperBound,t.lowerBound).lengthSquared()>=0)}static assert(t){}getCenter(){return tt.neo(.5*(this.lowerBound.x+this.upperBound.x),.5*(this.lowerBound.y+this.upperBound.y))}getExtents(){return tt.neo(.5*(this.upperBound.x-this.lowerBound.x),.5*(this.upperBound.y-this.lowerBound.y))}getPerimeter(){return 2*(this.upperBound.x-this.lowerBound.x+this.upperBound.y-this.lowerBound.y)}combine(t,e){e=e||this;const i=t.lowerBound,s=t.upperBound,o=e.lowerBound,n=e.upperBound,r=$.min(i.x,o.x),h=$.min(i.y,o.y),a=$.max(n.x,s.x),m=$.max(n.y,s.y);this.lowerBound.setNum(r,h),this.upperBound.setNum(a,m)}combinePoints(t,e){this.lowerBound.setNum($.min(t.x,e.x),$.min(t.y,e.y)),this.upperBound.setNum($.max(t.x,e.x),$.max(t.y,e.y))}set(t){this.lowerBound.setNum(t.lowerBound.x,t.lowerBound.y),this.upperBound.setNum(t.upperBound.x,t.upperBound.y)}contains(t){let e=!0;return e=e&&this.lowerBound.x<=t.lowerBound.x,e=e&&this.lowerBound.y<=t.lowerBound.y,e=e&&t.upperBound.x<=this.upperBound.x,e=e&&t.upperBound.y<=this.upperBound.y,e}extend(t){return et.extend(this,t),this}static extend(t,e){return t.lowerBound.x-=e,t.lowerBound.y-=e,t.upperBound.x+=e,t.upperBound.y+=e,t}static testOverlap(t,e){const i=e.lowerBound.x-t.upperBound.x,s=t.lowerBound.x-e.upperBound.x,o=e.lowerBound.y-t.upperBound.y,n=t.lowerBound.y-e.upperBound.y;return!(i>0||o>0||s>0||n>0)}static areEqual(t,e){return tt.areEqual(t.lowerBound,e.lowerBound)&&tt.areEqual(t.upperBound,e.upperBound)}static diff(t,e){const i=$.max(0,$.min(t.upperBound.x,e.upperBound.x)-$.max(e.lowerBound.x,t.lowerBound.x)),s=$.max(0,$.min(t.upperBound.y,e.upperBound.y)-$.max(e.lowerBound.y,t.lowerBound.y));return(t.upperBound.x-t.lowerBound.x)*(t.upperBound.y-t.lowerBound.y)+(e.upperBound.x-e.lowerBound.x)*(e.upperBound.y-e.lowerBound.y)-i*s}rayCast(t,e){let i=-1/0,s=1/0;const o=e.p1,n=tt.sub(e.p2,e.p1),r=tt.abs(n),h=tt.zero();for(let t="x";null!==t;t="x"===t?"y":null)if(r.x<$.EPSILON){if(o[t]<this.lowerBound[t]||this.upperBound[t]<o[t])return!1}else{const e=1/n[t];let r=(this.lowerBound[t]-o[t])*e,a=(this.upperBound[t]-o[t])*e,m=-1;if(r>a){const t=r;r=a,a=t,m=1}if(r>i&&(h.setZero(),h[t]=m,i=r),s=$.min(s,a),i>s)return!1}return!(i<0||e.maxFraction<i)&&(t.fraction=i,t.normal=h,!0)}toString(){return JSON.stringify(this)}static combinePoints(t,e,i){return t.lowerBound.x=$.min(e.x,i.x),t.lowerBound.y=$.min(e.y,i.y),t.upperBound.x=$.max(e.x,i.x),t.upperBound.y=$.max(e.y,i.y),t}static combinedPerimeter(t,e){const i=$.min(t.lowerBound.x,e.lowerBound.x),s=$.min(t.lowerBound.y,e.lowerBound.y);return 2*($.max(t.upperBound.x,e.upperBound.x)-i+$.max(t.upperBound.y,e.upperBound.y)-s)}}class it{static get polygonRadius(){return 2*it.linearSlop}}it.lengthUnitsPerMeter=1,it.maxManifoldPoints=2,it.maxPolygonVertices=12,it.aabbExtension=.1,it.aabbMultiplier=2,it.linearSlop=.005,it.angularSlop=2/180*Math.PI,it.maxSubSteps=8,it.maxTOIContacts=32,it.maxTOIIterations=20,it.maxDistnceIterations=20,it.velocityThreshold=1,it.maxLinearCorrection=.2,it.maxAngularCorrection=8/180*Math.PI,it.maxTranslation=2,it.maxRotation=.5*Math.PI,it.baumgarte=.2,it.toiBaugarte=.75,it.timeToSleep=.5,it.linearSleepTolerance=.01,it.angularSleepTolerance=2/180*Math.PI;class st{static get maxManifoldPoints(){return it.maxManifoldPoints}static get maxPolygonVertices(){return it.maxPolygonVertices}static get aabbExtension(){return it.aabbExtension*it.lengthUnitsPerMeter}static get aabbMultiplier(){return it.aabbMultiplier}static get linearSlop(){return it.linearSlop*it.lengthUnitsPerMeter}static get linearSlopSquared(){return it.linearSlop*it.lengthUnitsPerMeter*it.linearSlop*it.lengthUnitsPerMeter}static get angularSlop(){return it.angularSlop}static get polygonRadius(){return 2*it.linearSlop}static get maxSubSteps(){return it.maxSubSteps}static get maxTOIContacts(){return it.maxTOIContacts}static get maxTOIIterations(){return it.maxTOIIterations}static get maxDistnceIterations(){return it.maxDistnceIterations}static get velocityThreshold(){return it.velocityThreshold*it.lengthUnitsPerMeter}static get maxLinearCorrection(){return it.maxLinearCorrection*it.lengthUnitsPerMeter}static get maxAngularCorrection(){return it.maxAngularCorrection}static get maxTranslation(){return it.maxTranslation*it.lengthUnitsPerMeter}static get maxTranslationSquared(){return it.maxTranslation*it.lengthUnitsPerMeter*it.maxTranslation*it.lengthUnitsPerMeter}static get maxRotation(){return it.maxRotation}static get maxRotationSquared(){return it.maxRotation*it.maxRotation}static get baumgarte(){return it.baumgarte}static get toiBaugarte(){return it.toiBaugarte}static get timeToSleep(){return it.timeToSleep}static get linearSleepTolerance(){return it.linearSleepTolerance*it.lengthUnitsPerMeter}static get linearSleepToleranceSqr(){return it.linearSleepTolerance*it.lengthUnitsPerMeter*it.linearSleepTolerance*it.lengthUnitsPerMeter}static get angularSleepTolerance(){return it.angularSleepTolerance}static get angularSleepToleranceSqr(){return it.angularSleepTolerance*it.angularSleepTolerance}}class ot{constructor(t){this._list=[],this._max=1/0,this._hasCreateFn=!1,this._createCount=0,this._hasAllocateFn=!1,this._allocateCount=0,this._hasReleaseFn=!1,this._releaseCount=0,this._hasDisposeFn=!1,this._disposeCount=0,this._list=[],this._max=t.max||this._max,this._createFn=t.create,this._hasCreateFn="function"==typeof this._createFn,this._allocateFn=t.allocate,this._hasAllocateFn="function"==typeof this._allocateFn,this._releaseFn=t.release,this._hasReleaseFn="function"==typeof this._releaseFn,this._disposeFn=t.dispose,this._hasDisposeFn="function"==typeof this._disposeFn}max(t){return"number"==typeof t?(this._max=t,this):this._max}size(){return this._list.length}allocate(){let t;return this._list.length>0?t=this._list.shift():(this._createCount++,t=this._hasCreateFn?this._createFn():{}),this._allocateCount++,this._hasAllocateFn&&this._allocateFn(t),t}release(t){this._list.length<this._max?(this._releaseCount++,this._hasReleaseFn&&this._releaseFn(t),this._list.push(t)):(this._disposeCount++,this._hasDisposeFn&&(t=this._disposeFn(t)))}toString(){return" +"+this._createCount+" >"+this._allocateCount+" <"+this._releaseCount+" -"+this._disposeCount+" ="+this._list.length+"/"+this._max}}class nt{constructor(t){this.aabb=new et,this.userData=null,this.parent=null,this.child1=null,this.child2=null,this.height=-1,this.id=t}toString(){return this.id+": "+this.userData}isLeaf(){return null==this.child1}}const rt=new ot({create:()=>new nt,release(t){t.userData=null,t.parent=null,t.child1=null,t.child2=null,t.height=-1,t.id=void 0}});class ht{constructor(){this.inputPool=new ot({create:()=>({}),release(t){}}),this.stackPool=new ot({create:()=>[],release(t){t.length=0}}),this.iteratorPool=new ot({create:()=>new at,release(t){t.close()}}),this.m_root=null,this.m_nodes={},this.m_lastProxyId=0}getUserData(t){return this.m_nodes[t].userData}getFatAABB(t){return this.m_nodes[t].aabb}allocateNode(){const t=rt.allocate();return t.id=++this.m_lastProxyId,this.m_nodes[t.id]=t,t}freeNode(t){delete this.m_nodes[t.id],rt.release(t)}createProxy(t,e){const i=this.allocateNode();return i.aabb.set(t),et.extend(i.aabb,st.aabbExtension),i.userData=e,i.height=0,this.insertLeaf(i),i.id}destroyProxy(t){const e=this.m_nodes[t];this.removeLeaf(e),this.freeNode(e)}moveProxy(t,e,i){const s=this.m_nodes[t];return!s.aabb.contains(e)&&(this.removeLeaf(s),s.aabb.set(e),e=s.aabb,et.extend(e,st.aabbExtension),i.x<0?e.lowerBound.x+=i.x*st.aabbMultiplier:e.upperBound.x+=i.x*st.aabbMultiplier,i.y<0?e.lowerBound.y+=i.y*st.aabbMultiplier:e.upperBound.y+=i.y*st.aabbMultiplier,this.insertLeaf(s),!0)}insertLeaf(t){if(null==this.m_root)return this.m_root=t,void(this.m_root.parent=null);const e=t.aabb;let i=this.m_root;for(;!i.isLeaf();){const t=i.child1,s=i.child2,o=i.aabb.getPerimeter(),n=et.combinedPerimeter(i.aabb,e),r=2*n,h=2*(n-o);let a=et.combinedPerimeter(e,t.aabb)+h;if(!t.isLeaf()){a-=t.aabb.getPerimeter()}let m=et.combinedPerimeter(e,s.aabb)+h;if(!s.isLeaf()){m-=s.aabb.getPerimeter()}if(r<a&&r<m)break;i=a<m?t:s}const s=i,o=s.parent,n=this.allocateNode();for(n.parent=o,n.userData=null,n.aabb.combine(e,s.aabb),n.height=s.height+1,null!=o?(o.child1===s?o.child1=n:o.child2=n,n.child1=s,n.child2=t,s.parent=n,t.parent=n):(n.child1=s,n.child2=t,s.parent=n,t.parent=n,this.m_root=n),i=t.parent;null!=i;){i=this.balance(i);const t=i.child1,e=i.child2;i.height=1+Math.max(t.height,e.height),i.aabb.combine(t.aabb,e.aabb),i=i.parent}}removeLeaf(t){if(t===this.m_root)return void(this.m_root=null);const e=t.parent,i=e.parent;let s;if(s=e.child1===t?e.child2:e.child1,null!=i){i.child1===e?i.child1=s:i.child2=s,s.parent=i,this.freeNode(e);let t=i;for(;null!=t;){t=this.balance(t);const e=t.child1,i=t.child2;t.aabb.combine(e.aabb,i.aabb),t.height=1+Math.max(e.height,i.height),t=t.parent}}else this.m_root=s,s.parent=null,this.freeNode(e)}balance(t){const e=t;if(e.isLeaf()||e.height<2)return t;const i=e.child1,s=e.child2,o=s.height-i.height;if(o>1){const o=s.child1,n=s.child2;return s.child1=e,s.parent=e.parent,e.parent=s,null!=s.parent?s.parent.child1===t?s.parent.child1=s:s.parent.child2=s:this.m_root=s,o.height>n.height?(s.child2=o,e.child2=n,n.parent=e,e.aabb.combine(i.aabb,n.aabb),s.aabb.combine(e.aabb,o.aabb),e.height=1+Math.max(i.height,n.height),s.height=1+Math.max(e.height,o.height)):(s.child2=n,e.child2=o,o.parent=e,e.aabb.combine(i.aabb,o.aabb),s.aabb.combine(e.aabb,n.aabb),e.height=1+Math.max(i.height,o.height),s.height=1+Math.max(e.height,n.height)),s}if(o<-1){const t=i.child1,o=i.child2;return i.child1=e,i.parent=e.parent,e.parent=i,null!=i.parent?i.parent.child1===e?i.parent.child1=i:i.parent.child2=i:this.m_root=i,t.height>o.height?(i.child2=t,e.child1=o,o.parent=e,e.aabb.combine(s.aabb,o.aabb),i.aabb.combine(e.aabb,t.aabb),e.height=1+Math.max(s.height,o.height),i.height=1+Math.max(e.height,t.height)):(i.child2=o,e.child1=t,t.parent=e,e.aabb.combine(s.aabb,t.aabb),i.aabb.combine(e.aabb,o.aabb),e.height=1+Math.max(s.height,t.height),i.height=1+Math.max(e.height,o.height)),i}return e}getHeight(){return null==this.m_root?0:this.m_root.height}getAreaRatio(){if(null==this.m_root)return 0;const t=this.m_root.aabb.getPerimeter();let e,i=0;const s=this.iteratorPool.allocate().preorder(this.m_root);for(;e=s.next();)e.height<0||(i+=e.aabb.getPerimeter());return this.iteratorPool.release(s),i/t}computeHeight(t){let e;if(e=void 0!==t?this.m_nodes[t]:this.m_root,e.isLeaf())return 0;const i=this.computeHeight(e.child1.id),s=this.computeHeight(e.child2.id);return 1+Math.max(i,s)}validateStructure(t){if(null==t)return;this.m_root;const e=t.child1,i=t.child2;t.isLeaf()||(this.validateStructure(e),this.validateStructure(i))}validateMetrics(t){if(null==t)return;const e=t.child1,i=t.child2;if(t.isLeaf())return;e.height,i.height;(new et).combine(e.aabb,i.aabb),this.validateMetrics(e),this.validateMetrics(i)}validate(){}getMaxBalance(){let t,e=0;const i=this.iteratorPool.allocate().preorder(this.m_root);for(;t=i.next();){if(t.height<=1)continue;const i=Math.abs(t.child2.height-t.child1.height);e=Math.max(e,i)}return this.iteratorPool.release(i),e}rebuildBottomUp(){const t=[];let e,i=0;const s=this.iteratorPool.allocate().preorder(this.m_root);for(;e=s.next();)e.height<0||(e.isLeaf()?(e.parent=null,t[i]=e,++i):this.freeNode(e));for(this.iteratorPool.release(s);i>1;){let e=1/0,s=-1,o=-1;for(let n=0;n<i;++n){const r=t[n].aabb;for(let h=n+1;h<i;++h){const i=t[h].aabb,a=et.combinedPerimeter(r,i);a<e&&(s=n,o=h,e=a)}}const n=t[s],r=t[o],h=this.allocateNode();h.child1=n,h.child2=r,h.height=1+Math.max(n.height,r.height),h.aabb.combine(n.aabb,r.aabb),h.parent=null,n.parent=h,r.parent=h,t[o]=t[i-1],t[s]=h,--i}this.m_root=t[0]}shiftOrigin(t){let e;const i=this.iteratorPool.allocate().preorder(this.m_root);for(;e=i.next();){const i=e.aabb;i.lowerBound.x-=t.x,i.lowerBound.y-=t.y,i.upperBound.x-=t.x,i.upperBound.y-=t.y}this.iteratorPool.release(i)}query(t,e){const i=this.stackPool.allocate();for(i.push(this.m_root);i.length>0;){const s=i.pop();if(null!=s&&et.testOverlap(s.aabb,t))if(s.isLeaf()){if(!1===e(s.id))return}else i.push(s.child1),i.push(s.child2)}this.stackPool.release(i)}rayCast(t,e){const i=t.p1,s=t.p2,o=tt.sub(s,i);o.normalize();const n=tt.crossNumVec2(1,o),r=tt.abs(n);let h=t.maxFraction;const a=new et;let m=tt.combine(1-h,i,h,s);a.combinePoints(i,m);const c=this.stackPool.allocate(),l=this.inputPool.allocate();for(c.push(this.m_root);c.length>0;){const o=c.pop();if(null==o)continue;if(!1===et.testOverlap(o.aabb,a))continue;const _=o.aabb.getCenter(),u=o.aabb.getExtents();if(!(Math.abs(tt.dot(n,tt.sub(i,_)))-tt.dot(r,u)>0))if(o.isLeaf()){l.p1=tt.clone(t.p1),l.p2=tt.clone(t.p2),l.maxFraction=h;const n=e(l,o.id);if(0===n)return;n>0&&(h=n,m=tt.combine(1-h,i,h,s),a.combinePoints(i,m))}else c.push(o.child1),c.push(o.child2)}this.stackPool.release(c),this.inputPool.release(l)}}class at{constructor(){this.parents=[],this.states=[]}preorder(t){return this.parents.length=0,this.parents.push(t),this.states.length=0,this.states.push(0),this}next(){for(;this.parents.length>0;){const t=this.parents.length-1,e=this.parents[t];if(0===this.states[t])return this.states[t]=1,e;if(1===this.states[t]&&(this.states[t]=2,e.child1))return this.parents.push(e.child1),this.states.push(1),e.child1;if(2===this.states[t]&&(this.states[t]=3,e.child2))return this.parents.push(e.child2),this.states.push(1),e.child2;this.parents.pop(),this.states.pop()}}close(){this.parents.length=0}}class mt{constructor(){this.m_tree=new ht,this.m_moveBuffer=[],this.query=(t,e)=>{this.m_tree.query(t,e)},this.queryCallback=t=>{if(t===this.m_queryProxyId)return!0;const e=Math.min(t,this.m_queryProxyId),i=Math.max(t,this.m_queryProxyId),s=this.m_tree.getUserData(e),o=this.m_tree.getUserData(i);return this.m_callback(s,o),!0}}getUserData(t){return this.m_tree.getUserData(t)}testOverlap(t,e){const i=this.m_tree.getFatAABB(t),s=this.m_tree.getFatAABB(e);return et.testOverlap(i,s)}getFatAABB(t){return this.m_tree.getFatAABB(t)}getProxyCount(){return this.m_moveBuffer.length}getTreeHeight(){return this.m_tree.getHeight()}getTreeBalance(){return this.m_tree.getMaxBalance()}getTreeQuality(){return this.m_tree.getAreaRatio()}rayCast(t,e){this.m_tree.rayCast(t,e)}shiftOrigin(t){this.m_tree.shiftOrigin(t)}createProxy(t,e){const i=this.m_tree.createProxy(t,e);return this.bufferMove(i),i}destroyProxy(t){this.unbufferMove(t),this.m_tree.destroyProxy(t)}moveProxy(t,e,i){this.m_tree.moveProxy(t,e,i)&&this.bufferMove(t)}touchProxy(t){this.bufferMove(t)}bufferMove(t){this.m_moveBuffer.push(t)}unbufferMove(t){for(let e=0;e<this.m_moveBuffer.length;++e)this.m_moveBuffer[e]===t&&(this.m_moveBuffer[e]=null)}updatePairs(t){for(this.m_callback=t;this.m_moveBuffer.length>0;){if(this.m_queryProxyId=this.m_moveBuffer.pop(),null===this.m_queryProxyId)continue;const t=this.m_tree.getFatAABB(this.m_queryProxyId);this.m_tree.query(t,this.queryCallback)}}}function ct(t,e){return{x:t,y:e}}function lt(t,e,i){return t.x=e,t.y=i,t}function _t(t,e){return t.x=e.x,t.y=e.y,t}function ut(t){return t.x=0,t.y=0,t}function dt(t){return t.x=-t.x,t.y=-t.y,t}function pt(t,e){return t.x+=e.x,t.y+=e.y,t}function yt(t,e){return t.x-=e.x,t.y-=e.y,t}function xt(t,e,i){return t.x=e.x-i.x,t.y=e.y-i.y,t}function ft(t,e){return t.x*=e,t.y*=e,t}function gt(t,e,i){return t.x=e*i.x,t.y=e*i.y,t}function vt(t,e,i){return t.x+=e*i.x,t.y+=e*i.y,t}function At(t,e,i){return t.x-=e*i.x,t.y-=e*i.y,t}function bt(t,e,i,s,o){return t.x=e*i.x+s*o.x,t.y=e*i.y+s*o.y,t}function Bt(t){const e=Math.sqrt(t.x*t.x+t.y*t.y);if(e>0){const i=1/e;t.x*=i,t.y*=i}return t}function wt(t,e,i){const s=i*e.y,o=-i*e.x;return t.x=s,t.y=o,t}function Ct(t,e,i){const s=-e*i.y,o=e*i.x;return t.x=s,t.y=o,t}function Mt(t,e){return t.x*e.y-t.y*e.x}function Vt(t,e){return t.x*e.x+t.y*e.y}function It(t){return t.x*t.x+t.y*t.y}function St(t,e){const i=t.x-e.x,s=t.y-e.y;return Math.sqrt(i*i+s*s)}function Pt(t,e){const i=t.x-e.x,s=t.y-e.y;return i*i+s*s}function Tt(t,e,i){return t.x=e.c*i.x-e.s*i.y,t.y=e.s*i.x+e.c*i.y,t}function zt(t,e,i){const s=e.c*i.x+e.s*i.y,o=-e.s*i.x+e.c*i.y;return t.x=s,t.y=o,t}function Ft(t,e,i){return{p:ct(t,e),q:(s=i,{s:Math.sin(s),c:Math.cos(s)})};var s}function kt(t,e){return t.p.x=e.p.x,t.p.y=e.p.y,t.q.s=e.q.s,t.q.c=e.q.c,t}function Lt(t,e,i){const s=e.q.c*i.x-e.q.s*i.y+e.p.x,o=e.q.s*i.x+e.q.c*i.y+e.p.y;return t.x=s,t.y=o,t}function qt(t,e,i){const s=i.x-e.p.x,o=i.y-e.p.y,n=e.q.c*s+e.q.s*o,r=-e.q.s*s+e.q.c*o;return t.x=n,t.y=r,t}function Dt(t,e,i,s){const o=e.q.c*s.x-e.q.s*s.y+e.p.x,n=e.q.s*s.x+e.q.c*s.y+e.p.y,r=o-i.p.x,h=n-i.p.y,a=i.q.c*r+i.q.s*h,m=-i.q.s*r+i.q.c*h;return t.x=a,t.y=m,t}function jt(t,e,i){const s=e.q.c*i.q.c+e.q.s*i.q.s,o=e.q.c*i.q.s-e.q.s*i.q.c,n=e.q.c*(i.p.x-e.p.x)+e.q.s*(i.p.y-e.p.y),r=-e.q.s*(i.p.x-e.p.x)+e.q.c*(i.p.y-e.p.y);return t.q.c=s,t.q.s=o,t.p.x=n,t.p.y=r,t}class Rt{constructor(t){"number"==typeof t?this.setAngle(t):"object"==typeof t?this.setRot(t):this.setIdentity()}static neo(t){const e=Object.create(Rt.prototype);return e.setAngle(t),e}static clone(t){const e=Object.create(Rt.prototype);return e.s=t.s,e.c=t.c,e}static identity(){const t=Object.create(Rt.prototype);return t.s=0,t.c=1,t}static isValid(t){return null!=t&&($.isFinite(t.s)&&$.isFinite(t.c))}static assert(t){}setIdentity(){this.s=0,this.c=1}set(t){"object"==typeof t?(this.s=t.s,this.c=t.c):(this.s=$.sin(t),this.c=$.cos(t))}setRot(t){this.s=t.s,this.c=t.c}setAngle(t){this.s=$.sin(t),this.c=$.cos(t)}getAngle(){return $.atan2(this.s,this.c)}getXAxis(){return tt.neo(this.c,this.s)}getYAxis(){return tt.neo(-this.s,this.c)}static mul(t,e){if("c"in e&&"s"in e){const i=Rt.identity();return i.s=t.s*e.c+t.c*e.s,i.c=t.c*e.c-t.s*e.s,i}if("x"in e&&"y"in e)return tt.neo(t.c*e.x-t.s*e.y,t.s*e.x+t.c*e.y)}static mulRot(t,e){const i=Rt.identity();return i.s=t.s*e.c+t.c*e.s,i.c=t.c*e.c-t.s*e.s,i}static mulVec2(t,e){return tt.neo(t.c*e.x-t.s*e.y,t.s*e.x+t.c*e.y)}static mulSub(t,e,i){const s=t.c*(e.x-i.x)-t.s*(e.y-i.y),o=t.s*(e.x-i.x)+t.c*(e.y-i.y);return tt.neo(s,o)}static mulT(t,e){if("c"in e&&"s"in e){const i=Rt.identity();return i.s=t.c*e.s-t.s*e.c,i.c=t.c*e.c+t.s*e.s,i}if("x"in e&&"y"in e)return tt.neo(t.c*e.x+t.s*e.y,-t.s*e.x+t.c*e.y)}static mulTRot(t,e){const i=Rt.identity();return i.s=t.c*e.s-t.s*e.c,i.c=t.c*e.c+t.s*e.s,i}static mulTVec2(t,e){return tt.neo(t.c*e.x+t.s*e.y,-t.s*e.x+t.c*e.y)}}const Nt=ct(0,0);class Et{constructor(){this.localCenter=tt.zero(),this.c=tt.zero(),this.a=0,this.alpha0=0,this.c0=tt.zero(),this.a0=0}recycle(){ut(this.localCenter),ut(this.c),this.a=0,this.alpha0=0,ut(this.c0),this.a0=0}setTransform(t){Lt(Nt,t,this.localCenter),_t(this.c,Nt),_t(this.c0,Nt),this.a=this.a0=$.atan2(t.q.s,t.q.c)}setLocalCenter(t,e){_t(this.localCenter,t),Lt(Nt,e,this.localCenter),_t(this.c,Nt),_t(this.c0,Nt)}getTransform(t,e=0){!function(t,e){t.c=Math.cos(e),t.s=Math.sin(e)}(t.q,(1-e)*this.a0+e*this.a),bt(t.p,1-e,this.c0,e,this.c),yt(t.p,Tt(Nt,t.q,this.localCenter))}advance(t){const e=(t-this.alpha0)/(1-this.alpha0);bt(this.c0,e,this.c,1-e,this.c0),this.a0=e*this.a+(1-e)*this.a0,this.alpha0=t}forward(){this.a0=this.a,_t(this.c0,this.c)}normalize(){const t=$.mod(this.a0,-$.PI,+$.PI);this.a-=this.a0-t,this.a0=t}set(t){_t(this.localCenter,t.localCenter),_t(this.c,t.c),this.a=t.a,this.alpha0=t.alpha0,_t(this.c0,t.c0),this.a0=t.a0}}class Ot{constructor(t,e){this.p=tt.zero(),this.q=Rt.identity(),void 0!==t&&this.p.setVec2(t),void 0!==e&&this.q.setAngle(e)}static clone(t){const e=Object.create(Ot.prototype);return e.p=tt.clone(t.p),e.q=Rt.clone(t.q),e}static neo(t,e){const i=Object.create(Ot.prototype);return i.p=tt.clone(t),i.q=Rt.clone(e),i}static identity(){const t=Object.create(Ot.prototype);return t.p=tt.zero(),t.q=Rt.identity(),t}setIdentity(){this.p.setZero(),this.q.setIdentity()}set(t,e){void 0===e?(this.p.set(t.p),this.q.set(t.q)):(this.p.set(t),this.q.set(e))}setNum(t,e){this.p.setVec2(t),this.q.setAngle(e)}setTransform(t){this.p.setVec2(t.p),this.q.setRot(t.q)}static isValid(t){return null!=t&&(tt.isValid(t.p)&&Rt.isValid(t.q))}static assert(t){}static mul(t,e){if(Array.isArray(e)){const i=[];for(let s=0;s<e.length;s++)i[s]=Ot.mul(t,e[s]);return i}return"x"in e&&"y"in e?Ot.mulVec2(t,e):"p"in e&&"q"in e?Ot.mulXf(t,e):void 0}static mulAll(t,e){const i=[];for(let s=0;s<e.length;s++)i[s]=Ot.mul(t,e[s]);return i}static mulFn(t){return function(e){return Ot.mul(t,e)}}static mulVec2(t,e){const i=t.q.c*e.x-t.q.s*e.y+t.p.x,s=t.q.s*e.x+t.q.c*e.y+t.p.y;return tt.neo(i,s)}static mulXf(t,e){const i=Ot.identity();return i.q=Rt.mulRot(t.q,e.q),i.p=tt.add(Rt.mulVec2(t.q,e.p),t.p),i}static mulT(t,e){return"x"in e&&"y"in e?Ot.mulTVec2(t,e):"p"in e&&"q"in e?Ot.mulTXf(t,e):void 0}static mulTVec2(t,e){const i=e.x-t.p.x,s=e.y-t.p.y,o=t.q.c*i+t.q.s*s,n=-t.q.s*i+t.q.c*s;return tt.neo(o,n)}static mulTXf(t,e){const i=Ot.identity();return i.q.setRot(Rt.mulTRot(t.q,e.q)),i.p.setVec2(Rt.mulTVec2(t.q,tt.sub(e.p,t.p))),i}}class Yt{constructor(){this.v=tt.zero(),this.w=0}}class Wt{constructor(){this.c=tt.zero(),this.a=0}getTransform(t,e){return t.q.c=Math.cos(this.a),t.q.s=Math.sin(this.a),t.p.x=this.c.x-(t.q.c*e.x-t.q.s*e.y),t.p.y=this.c.y-(t.q.s*e.x+t.q.c*e.y),t}}function Jt(t,e,i,s){return t.q.c=Math.cos(s),t.q.s=Math.sin(s),t.p.x=i.x-(t.q.c*e.x-t.q.s*e.y),t.p.y=i.y-(t.q.s*e.x+t.q.c*e.y),t}class Xt{static isValid(t){return null!=t&&("string"==typeof t.m_type&&"number"==typeof t.m_radius)}}const Ht=new et,Kt=new et,Zt=ct(0,0),Ut={userData:null,friction:.2,restitution:0,density:0,isSensor:!1,filterGroupIndex:0,filterCategoryBits:1,filterMaskBits:65535};class Gt{constructor(t,e){this.aabb=new et,this.fixture=t,this.childIndex=e,this.proxyId}}class Qt{constructor(t,e,i){e.shape?(i=e,e=e.shape):"number"==typeof i&&(i={density:i}),i=Q(i,Ut),this.m_body=t,this.m_friction=i.friction,this.m_restitution=i.restitution,this.m_density=i.density,this.m_isSensor=i.isSensor,this.m_filterGroupIndex=i.filterGroupIndex,this.m_filterCategoryBits=i.filterCategoryBits,this.m_filterMaskBits=i.filterMaskBits,this.m_shape=e,this.m_next=null,this.m_proxies=[];const s=this.m_shape.getChildCount();for(let t=0;t<s;++t)this.m_proxies[t]=new Gt(this,t);this.m_userData=i.userData}_reset(){const t=this.getBody(),e=t.m_world.m_broadPhase;this.destroyProxies(e),this.m_shape._reset&&this.m_shape._reset();const i=this.m_shape.getChildCount();for(let t=0;t<i;++t)this.m_proxies[t]=new Gt(this,t);this.createProxies(e,t.m_xf),t.resetMassData()}_serialize(){return{friction:this.m_friction,restitution:this.m_restitution,density:this.m_density,isSensor:this.m_isSensor,filterGroupIndex:this.m_filterGroupIndex,filterCategoryBits:this.m_filterCategoryBits,filterMaskBits:this.m_filterMaskBits,shape:this.m_shape}}static _deserialize(t,e,i){const s=i(Xt,t.shape);return s&&new Qt(e,s,t)}getType(){return this.m_shape.m_type}getShape(){return this.m_shape}isSensor(){return this.m_isSensor}setSensor(t){t!=this.m_isSensor&&(this.m_body.setAwake(!0),this.m_isSensor=t)}getUserData(){return this.m_userData}setUserData(t){this.m_userData=t}getBody(){return this.m_body}getNext(){return this.m_next}getDensity(){return this.m_density}setDensity(t){this.m_density=t}getFriction(){return this.m_friction}setFriction(t){this.m_friction=t}getRestitution(){return this.m_restitution}setRestitution(t){this.m_restitution=t}testPoint(t){return this.m_shape.testPoint(this.m_body.getTransform(),t)}rayCast(t,e,i){return this.m_shape.rayCast(t,e,this.m_body.getTransform(),i)}getMassData(t){this.m_shape.computeMass(t,this.m_density)}getAABB(t){return this.m_proxies[t].aabb}createProxies(t,e){const i=this.m_shape.getChildCount();for(let s=0;s<i;++s){const i=this.m_proxies[s];this.m_shape.computeAABB(i.aabb,e,s),i.proxyId=t.createProxy(i.aabb,i)}}destroyProxies(t){for(let e=0;e<this.m_proxies.length;++e){const i=this.m_proxies[e];t.destroyProxy(i.proxyId),i.proxyId=null,i.fixture=null}this.m_proxies.length=0}synchronize(t,e,i){for(let s=0;s<this.m_proxies.length;++s){const o=this.m_proxies[s];this.m_shape.computeAABB(Ht,e,o.childIndex),this.m_shape.computeAABB(Kt,i,o.childIndex),o.aabb.combine(Ht,Kt),xt(Zt,i.p,e.p),t.moveProxy(o.proxyId,o.aabb,Zt)}}setFilterData(t){this.m_filterGroupIndex=t.groupIndex,this.m_filterCategoryBits=t.categoryBits,this.m_filterMaskBits=t.maskBits,this.refilter()}getFilterGroupIndex(){return this.m_filterGroupIndex}setFilterGroupIndex(t){this.m_filterGroupIndex=t}getFilterCategoryBits(){return this.m_filterCategoryBits}setFilterCategoryBits(t){this.m_filterCategoryBits=t}getFilterMaskBits(){return this.m_filterMaskBits}setFilterMaskBits(t){this.m_filterMaskBits=t}refilter(){if(null==this.m_body)return;let t=this.m_body.getContactList();for(;t;){const e=t.contact,i=e.getFixtureA(),s=e.getFixtureB();i!=this&&s!=this||e.flagForFiltering(),t=t.next}const e=this.m_body.getWorld();if(null==e)return;const i=e.m_broadPhase;for(let t=0;t<this.m_proxies.length;++t)i.touchProxy(this.m_proxies[t].proxyId)}shouldCollide(t){if(t.m_filterGroupIndex===this.m_filterGroupIndex&&0!==t.m_filterGroupIndex)return t.m_filterGroupIndex>0;const e=0!=(t.m_filterMaskBits&this.m_filterCategoryBits),i=0!=(t.m_filterCategoryBits&this.m_filterMaskBits);return e&&i}}const $t="static",te="kinematic",ee="dynamic",ie=ct(0,0),se=ct(0,0),oe=ct(0,0),ne=Ft(0,0,0),re={type:$t,position:tt.zero(),angle:0,linearVelocity:tt.zero(),angularVelocity:0,linearDamping:0,angularDamping:0,fixedRotation:!1,bullet:!1,gravityScale:1,allowSleep:!0,awake:!0,active:!0,userData:null};class he{constructor(){this.mass=0,this.center=tt.zero(),this.I=0}}class ae{constructor(t,e){e=Q(e,re),this.m_world=t,this.m_awakeFlag=e.awake,this.m_autoSleepFlag=e.allowSleep,this.m_bulletFlag=e.bullet,this.m_fixedRotationFlag=e.fixedRotation,this.m_activeFlag=e.active,this.m_islandFlag=!1,this.m_toiFlag=!1,this.m_userData=e.userData,this.m_type=e.type,this.m_type==ee?(this.m_mass=1,this.m_invMass=1):(this.m_mass=0,this.m_invMass=0),this.m_I=0,this.m_invI=0,this.m_xf=Ot.identity(),this.m_xf.p.setVec2(e.position),this.m_xf.q.setAngle(e.angle),this.m_sweep=new Et,this.m_sweep.setTransform(this.m_xf),this.c_velocity=new Yt,this.c_position=new Wt,this.m_force=tt.zero(),this.m_torque=0,this.m_linearVelocity=tt.clone(e.linearVelocity),this.m_angularVelocity=e.angularVelocity,this.m_linearDamping=e.linearDamping,this.m_angularDamping=e.angularDamping,this.m_gravityScale=e.gravityScale,this.m_sleepTime=0,this.m_jointList=null,this.m_contactList=null,this.m_fixtureList=null,this.m_prev=null,this.m_next=null,this.m_destroyed=!1}_serialize(){const t=[];for(let e=this.m_fixtureList;e;e=e.m_next)t.push(e);return{type:this.m_type,bullet:this.m_bulletFlag,position:this.m_xf.p,angle:this.m_xf.q.getAngle(),linearVelocity:this.m_linearVelocity,angularVelocity:this.m_angularVelocity,fixtures:t}}static _deserialize(t,e,i){const s=new ae(e,t);if(t.fixtures)for(let e=t.fixtures.length-1;e>=0;e--){const o=i(Qt,t.fixtures[e],s);s._addFixture(o)}return s}isWorldLocked(){return!(!this.m_world||!this.m_world.isLocked())}getWorld(){return this.m_world}getNext(){return this.m_next}setUserData(t){this.m_userData=t}getUserData(){return this.m_userData}getFixtureList(){return this.m_fixtureList}getJointList(){return this.m_jointList}getContactList(){return this.m_contactList}isStatic(){return this.m_type==$t}isDynamic(){return this.m_type==ee}isKinematic(){return this.m_type==te}setStatic(){return this.setType($t),this}setDynamic(){return this.setType(ee),this}setKinematic(){return this.setType(te),this}getType(){return this.m_type}setType(t){if(1==this.isWorldLocked())return;if(this.m_type==t)return;this.m_type=t,this.resetMassData(),this.m_type==$t&&(this.m_linearVelocity.setZero(),this.m_angularVelocity=0,this.m_sweep.forward(),this.synchronizeFixtures()),this.setAwake(!0),this.m_force.setZero(),this.m_torque=0;let e=this.m_contactList;for(;e;){const t=e;e=e.next,this.m_world.destroyContact(t.contact)}this.m_contactList=null;const i=this.m_world.m_broadPhase;for(let t=this.m_fixtureList;t;t=t.m_next)for(let e=0;e<t.m_proxies.length;++e)i.touchProxy(t.m_proxies[e].proxyId)}isBullet(){return this.m_bulletFlag}setBullet(t){this.m_bulletFlag=!!t}isSleepingAllowed(){return this.m_autoSleepFlag}setSleepingAllowed(t){this.m_autoSleepFlag=!!t,0==this.m_autoSleepFlag&&this.setAwake(!0)}isAwake(){return this.m_awakeFlag}setAwake(t){t?(this.m_awakeFlag=!0,this.m_sleepTime=0):(this.m_awakeFlag=!1,this.m_sleepTime=0,this.m_linearVelocity.setZero(),this.m_angularVelocity=0,this.m_force.setZero(),this.m_torque=0)}isActive(){return this.m_activeFlag}setActive(t){if(t!=this.m_activeFlag)if(this.m_activeFlag=!!t,this.m_activeFlag){const t=this.m_world.m_broadPhase;for(let e=this.m_fixtureList;e;e=e.m_next)e.createProxies(t,this.m_xf)}else{const t=this.m_world.m_broadPhase;for(let e=this.m_fixtureList;e;e=e.m_next)e.destroyProxies(t);let e=this.m_contactList;for(;e;){const t=e;e=e.next,this.m_world.destroyContact(t.contact)}this.m_contactList=null}}isFixedRotation(){return this.m_fixedRotationFlag}setFixedRotation(t){this.m_fixedRotationFlag!=t&&(this.m_fixedRotationFlag=!!t,this.m_angularVelocity=0,this.resetMassData())}getTransform(){return this.m_xf}setTransform(t,e){if(1==this.isWorldLocked())return;this.m_xf.setNum(t,e),this.m_sweep.setTransform(this.m_xf);const i=this.m_world.m_broadPhase;for(let t=this.m_fixtureList;t;t=t.m_next)t.synchronize(i,this.m_xf,this.m_xf)}synchronizeTransform(){this.m_sweep.getTransform(this.m_xf,1)}synchronizeFixtures(){this.m_sweep.getTransform(ne,0);const t=this.m_world.m_broadPhase;for(let e=this.m_fixtureList;e;e=e.m_next)e.synchronize(t,ne,this.m_xf)}advance(t){this.m_sweep.advance(t),_t(this.m_sweep.c,this.m_sweep.c0),this.m_sweep.a=this.m_sweep.a0,this.m_sweep.getTransform(this.m_xf,1)}getPosition(){return this.m_xf.p}setPosition(t){this.setTransform(t,this.m_sweep.a)}getAngle(){return this.m_sweep.a}setAngle(t){this.setTransform(this.m_xf.p,t)}getWorldCenter(){return this.m_sweep.c}getLocalCenter(){return this.m_sweep.localCenter}getLinearVelocity(){return this.m_linearVelocity}getLinearVelocityFromWorldPoint(t){const e=tt.sub(t,this.m_sweep.c);return tt.add(this.m_linearVelocity,tt.crossNumVec2(this.m_angularVelocity,e))}getLinearVelocityFromLocalPoint(t){return this.getLinearVelocityFromWorldPoint(this.getWorldPoint(t))}setLinearVelocity(t){this.m_type!=$t&&(tt.dot(t,t)>0&&this.setAwake(!0),this.m_linearVelocity.setVec2(t))}getAngularVelocity(){return this.m_angularVelocity}setAngularVelocity(t){this.m_type!=$t&&(t*t>0&&this.setAwake(!0),this.m_angularVelocity=t)}getLinearDamping(){return this.m_linearDamping}setLinearDamping(t){this.m_linearDamping=t}getAngularDamping(){return this.m_angularDamping}setAngularDamping(t){this.m_angularDamping=t}getGravityScale(){return this.m_gravityScale}setGravityScale(t){this.m_gravityScale=t}getMass(){return this.m_mass}getInertia(){return this.m_I+this.m_mass*tt.dot(this.m_sweep.localCenter,this.m_sweep.localCenter)}getMassData(t){t.mass=this.m_mass,t.I=this.getInertia(),t.center.setVec2(this.m_sweep.localCenter)}resetMassData(){if(this.m_mass=0,this.m_invMass=0,this.m_I=0,this.m_invI=0,ut(this.m_sweep.localCenter),this.isStatic()||this.isKinematic())return _t(this.m_sweep.c0,this.m_xf.p),_t(this.m_sweep.c,this.m_xf.p),void(this.m_sweep.a0=this.m_sweep.a);ut(se);for(let t=this.m_fixtureList;t;t=t.m_next){if(0==t.m_density)continue;const e=new he;t.getMassData(e),this.m_mass+=e.mass,vt(se,e.mass,e.center),this.m_I+=e.I}this.m_mass>0?(this.m_invMass=1/this.m_mass,gt(se,this.m_invMass,se)):(this.m_mass=1,this.m_invMass=1),this.m_I>0&&0==this.m_fixedRotationFlag?(this.m_I-=this.m_mass*Vt(se,se),this.m_invI=1/this.m_I):(this.m_I=0,this.m_invI=0),_t(ie,this.m_sweep.c),this.m_sweep.setLocalCenter(se,this.m_xf),xt(oe,this.m_sweep.c,ie),Ct(this.m_linearVelocity,this.m_angularVelocity,oe)}setMassData(t){1!=this.isWorldLocked()&&this.m_type==ee&&(this.m_invMass=0,this.m_I=0,this.m_invI=0,this.m_mass=t.mass,this.m_mass<=0&&(this.m_mass=1),this.m_invMass=1/this.m_mass,t.I>0&&0==this.m_fixedRotationFlag&&(this.m_I=t.I-this.m_mass*Vt(t.center,t.center),this.m_invI=1/this.m_I),_t(ie,this.m_sweep.c),this.m_sweep.setLocalCenter(t.center,this.m_xf),xt(oe,this.m_sweep.c,ie),Ct(this.m_linearVelocity,this.m_angularVelocity,oe))}applyForce(t,e,i=!0){this.m_type==ee&&(i&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_force.add(t),this.m_torque+=tt.crossVec2Vec2(tt.sub(e,this.m_sweep.c),t)))}applyForceToCenter(t,e=!0){this.m_type==ee&&(e&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&this.m_force.add(t))}applyTorque(t,e=!0){this.m_type==ee&&(e&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_torque+=t))}applyLinearImpulse(t,e,i=!0){this.m_type==ee&&(i&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_linearVelocity.addMul(this.m_invMass,t),this.m_angularVelocity+=this.m_invI*tt.crossVec2Vec2(tt.sub(e,this.m_sweep.c),t)))}applyAngularImpulse(t,e=!0){this.m_type==ee&&(e&&0==this.m_awakeFlag&&this.setAwake(!0),this.m_awakeFlag&&(this.m_angularVelocity+=this.m_invI*t))}shouldCollide(t){if(this.m_type!=ee&&t.m_type!=ee)return!1;for(let e=this.m_jointList;e;e=e.next)if(e.other==t&&0==e.joint.m_collideConnected)return!1;return!0}_addFixture(t){if(1==this.isWorldLocked())return null;if(this.m_activeFlag){const e=this.m_world.m_broadPhase;t.createProxies(e,this.m_xf)}return t.m_next=this.m_fixtureList,this.m_fixtureList=t,t.m_density>0&&this.resetMassData(),this.m_world.m_newFixture=!0,t}createFixture(t,e){if(1==this.isWorldLocked())return null;const i=new Qt(this,t,e);return this._addFixture(i),i}destroyFixture(t){if(1==this.isWorldLocked())return;if(this.m_fixtureList===t)this.m_fixtureList=t.m_next;else{let e=this.m_fixtureList;for(;null!=e;){if(e.m_next===t){e.m_next=t.m_next;break}e=e.m_next}}let e=this.m_contactList;for(;e;){const i=e.contact;e=e.next;const s=i.getFixtureA(),o=i.getFixtureB();t!=s&&t!=o||this.m_world.destroyContact(i)}if(this.m_activeFlag){const e=this.m_world.m_broadPhase;t.destroyProxies(e)}t.m_body=null,t.m_next=null,this.m_world.publish("remove-fixture",t),this.resetMassData()}getWorldPoint(t){return Ot.mulVec2(this.m_xf,t)}getWorldVector(t){return Rt.mulVec2(this.m_xf.q,t)}getLocalPoint(t){return Ot.mulTVec2(this.m_xf,t)}getLocalVector(t){return Rt.mulTVec2(this.m_xf.q,t)}}ae.STATIC="static",ae.KINEMATIC="kinematic",ae.DYNAMIC="dynamic";class me{constructor(){this.other=null,this.joint=null,this.prev=null,this.next=null}}class ce{constructor(t,e,i){this.m_type="unknown-joint",this.m_prev=null,this.m_next=null,this.m_edgeA=new me,this.m_edgeB=new me,this.m_islandFlag=!1,e="bodyA"in t?t.bodyA:e,i="bodyB"in t?t.bodyB:i,this.m_bodyA=e,this.m_bodyB=i,this.m_collideConnected=!!t.collideConnected,this.m_userData=t.userData}isActive(){return this.m_bodyA.isActive()&&this.m_bodyB.isActive()}getType(){return this.m_type}getBodyA(){return this.m_bodyA}getBodyB(){return this.m_bodyB}getNext(){return this.m_next}getUserData(){return this.m_userData}setUserData(t){this.m_userData=t}getCollideConnected(){return this.m_collideConnected}shiftOrigin(t){}}const le={gjkCalls:0,gjkIters:0,gjkMaxIters:0,toiTime:0,toiMaxTime:0,toiCalls:0,toiIters:0,toiMaxIters:0,toiRootIters:0,toiMaxRootIters:0,toString(t){t="string"==typeof t?t:"\n";let e="";for(const i in this)"function"!=typeof this[i]&&"object"!=typeof this[i]&&(e+=i+": "+this[i]+t);return e}};var _e=function(){return Date.now()},ue=function(t){return Date.now()-t};const de=ct(0,0),pe=ct(0,0),ye=ct(0,0),xe=ct(0,0),fe=ct(0,0),ge=ct(0,0),ve=ct(0,0);le.gjkCalls=0,le.gjkIters=0,le.gjkMaxIters=0;class Ae{constructor(){this.proxyA=new Ce,this.proxyB=new Ce,this.transformA=Ot.identity(),this.transformB=Ot.identity(),this.useRadii=!1}recycle(){this.proxyA.recycle(),this.proxyB.recycle(),this.transformA.setIdentity(),this.transformB.setIdentity(),this.useRadii=!1}}class be{constructor(){this.pointA=ct(0,0),this.pointB=ct(0,0),this.distance=0,this.iterations=0}recycle(){ut(this.pointA),ut(this.pointB),this.distance=0,this.iterations=0}}class Be{constructor(){this.metric=0,this.indexA=[],this.indexB=[],this.count=0}recycle(){this.metric=0,this.indexA.length=0,this.indexB.length=0,this.count=0}}const we=function(t,e,i){++le.gjkCalls;const s=i.proxyA,o=i.proxyB,n=i.transformA,r=i.transformB;Pe.recycle(),Pe.readCache(e,s,n,o,r);const h=Pe.m_v,a=st.maxDistnceIterations,m=[],c=[];let l=0,_=0;for(;_<a;){l=Pe.m_count;for(let t=0;t<l;++t)m[t]=h[t].indexA,c[t]=h[t].indexB;if(Pe.solve(),3===Pe.m_count)break;const t=Pe.getSearchDirection();if(It(t)<$.EPSILON*$.EPSILON)break;const e=h[Pe.m_count];e.indexA=s.getSupport(zt(de,n.q,gt(de,-1,t))),Lt(e.wA,n,s.getVertex(e.indexA)),e.indexB=o.getSupport(zt(de,r.q,t)),Lt(e.wB,r,o.getVertex(e.indexB)),xt(e.w,e.wB,e.wA),++_,++le.gjkIters;let i=!1;for(let t=0;t<l;++t)if(e.indexA===m[t]&&e.indexB===c[t]){i=!0;break}if(i)break;++Pe.m_count}if(le.gjkMaxIters=$.max(le.gjkMaxIters,_),Pe.getWitnessPoints(t.pointA,t.pointB),t.distance=St(t.pointA,t.pointB),t.iterations=_,Pe.writeCache(e),i.useRadii){const e=s.m_radius,i=o.m_radius;if(t.distance>e+i&&t.distance>$.EPSILON)t.distance-=e+i,xt(pe,t.pointB,t.pointA),Bt(pe),vt(t.pointA,e,pe),At(t.pointB,i,pe);else{const e=xt(de,t.pointA,t.pointB);_t(t.pointA,e),_t(t.pointB,e),t.distance=0}}};class Ce{constructor(){this.m_vertices=[],this.m_count=0,this.m_radius=0}recycle(){this.m_vertices.length=0,this.m_count=0,this.m_radius=0}getVertexCount(){return this.m_count}getVertex(t){return this.m_vertices[t]}getSupport(t){let e=-1,i=-1/0;for(let s=0;s<this.m_count;++s){const o=Vt(this.m_vertices[s],t);o>i&&(e=s,i=o)}return e}getSupportVertex(t){return this.m_vertices[this.getSupport(t)]}set(t,e){t.computeDistanceProxy(this,e)}setVertices(t,e,i){this.m_vertices=t,this.m_count=e,this.m_radius=i}}class Me{constructor(){this.wA=ct(0,0),this.indexA=0,this.wB=ct(0,0),this.indexB=0,this.w=ct(0,0),this.a=0}recycle(){this.indexA=0,this.indexB=0,ut(this.wA),ut(this.wB),ut(this.w),this.a=0}set(t){this.indexA=t.indexA,this.indexB=t.indexB,_t(this.wA,t.wA),_t(this.wB,t.wB),_t(this.w,t.w),this.a=t.a}}const Ve=ct(0,0),Ie=ct(0,0);class Se{constructor(){this.m_v1=new Me,this.m_v2=new Me,this.m_v3=new Me,this.m_v=[this.m_v1,this.m_v2,this.m_v3]}recycle(){this.m_v1.recycle(),this.m_v2.recycle(),this.m_v3.recycle(),this.m_count=0}toString(){return 3===this.m_count?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y,this.m_v2.a,this.m_v2.wA.x,this.m_v2.wA.y,this.m_v2.wB.x,this.m_v2.wB.y,this.m_v3.a,this.m_v3.wA.x,this.m_v3.wA.y,this.m_v3.wB.x,this.m_v3.wB.y].toString():2===this.m_count?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y,this.m_v2.a,this.m_v2.wA.x,this.m_v2.wA.y,this.m_v2.wB.x,this.m_v2.wB.y].toString():1===this.m_count?["+"+this.m_count,this.m_v1.a,this.m_v1.wA.x,this.m_v1.wA.y,this.m_v1.wB.x,this.m_v1.wB.y].toString():"+"+this.m_count}readCache(t,e,i,s,o){this.m_count=t.count;for(let n=0;n<this.m_count;++n){const r=this.m_v[n];r.indexA=t.indexA[n],r.indexB=t.indexB[n];const h=e.getVertex(r.indexA),a=s.getVertex(r.indexB);Lt(r.wA,i,h),Lt(r.wB,o,a),xt(r.w,r.wB,r.wA),r.a=0}if(this.m_count>1){const e=t.metric,i=this.getMetric();(i<.5*e||2*e<i||i<$.EPSILON)&&(this.m_count=0)}if(0===this.m_count){const t=this.m_v[0];t.indexA=0,t.indexB=0;const n=e.getVertex(0),r=s.getVertex(0);Lt(t.wA,i,n),Lt(t.wB,o,r),xt(t.w,t.wB,t.wA),t.a=1,this.m_count=1}}writeCache(t){t.metric=this.getMetric(),t.count=this.m_count;for(let e=0;e<this.m_count;++e)t.indexA[e]=this.m_v[e].indexA,t.indexB[e]=this.m_v[e].indexB}getSearchDirection(){const t=this.m_v1,e=this.m_v2;switch(this.m_v3,this.m_count){case 1:return lt(Ve,-t.w.x,-t.w.y);case 2:xt(ye,e.w,t.w);return-Mt(ye,t.w)>0?lt(Ve,-ye.y,ye.x):lt(Ve,ye.y,-ye.x);default:return ut(Ve)}}getClosestPoint(){const t=this.m_v1,e=this.m_v2;switch(this.m_v3,this.m_count){case 0:return ut(Ie);case 1:return _t(Ie,t.w);case 2:return bt(Ie,t.a,t.w,e.a,e.w);case 3:default:return ut(Ie)}}getWitnessPoints(t,e){const i=this.m_v1,s=this.m_v2,o=this.m_v3;switch(this.m_count){case 0:break;case 1:_t(t,i.wA),_t(e,i.wB);break;case 2:bt(t,i.a,i.wA,s.a,s.wA),bt(e,i.a,i.wB,s.a,s.wB);break;case 3:e.x=t.x=i.a*i.wA.x+s.a*s.wA.x+o.a*o.wA.x,e.y=t.y=i.a*i.wA.y+s.a*s.wA.y+o.a*o.wA.y}}getMetric(){switch(this.m_count){case 0:case 1:return 0;case 2:return St(this.m_v1.w,this.m_v2.w);case 3:return Mt(xt(ge,this.m_v2.w,this.m_v1.w),xt(ve,this.m_v3.w,this.m_v1.w));default:return 0}}solve(){switch(this.m_count){case 1:break;case 2:this.solve2();break;case 3:this.solve3()}}solve2(){const t=this.m_v1.w,e=this.m_v2.w;xt(ye,e,t);const i=-Vt(t,ye);if(i<=0)return this.m_v1.a=1,void(this.m_count=1);const s=Vt(e,ye);if(s<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.set(this.m_v2);const o=1/(s+i);this.m_v1.a=s*o,this.m_v2.a=i*o,this.m_count=2}solve3(){const t=this.m_v1.w,e=this.m_v2.w,i=this.m_v3.w;xt(ye,e,t);const s=Vt(t,ye),o=Vt(e,ye),n=-s;xt(xe,i,t);const r=Vt(t,xe),h=Vt(i,xe),a=-r;xt(fe,i,e);const m=Vt(e,fe),c=Vt(i,fe),l=-m,_=Mt(ye,xe),u=_*Mt(e,i),d=_*Mt(i,t),p=_*Mt(t,e);if(n<=0&&a<=0)return this.m_v1.a=1,void(this.m_count=1);if(o>0&&n>0&&p<=0){const t=1/(o+n);return this.m_v1.a=o*t,this.m_v2.a=n*t,void(this.m_count=2)}if(h>0&&a>0&&d<=0){const t=1/(h+a);return this.m_v1.a=h*t,this.m_v3.a=a*t,this.m_count=2,void this.m_v2.set(this.m_v3)}if(o<=0&&l<=0)return this.m_v2.a=1,this.m_count=1,void this.m_v1.set(this.m_v2);if(h<=0&&c<=0)return this.m_v3.a=1,this.m_count=1,void this.m_v1.set(this.m_v3);if(c>0&&l>0&&u<=0){const t=1/(c+l);return this.m_v2.a=c*t,this.m_v3.a=l*t,this.m_count=2,void this.m_v1.set(this.m_v3)}const y=1/(u+d+p);this.m_v1.a=u*y,this.m_v2.a=d*y,this.m_v3.a=p*y,this.m_count=3}}const Pe=new Se,Te=new Ae,ze=new Be,Fe=new be,ke=function(t,e,i,s,o,n){return Te.recycle(),Te.proxyA.set(t,e),Te.proxyB.set(i,s),kt(Te.transformA,o),kt(Te.transformB,n),Te.useRadii=!0,Fe.recycle(),ze.recycle(),we(Fe,ze,Te),Fe.distance<10*$.EPSILON};we.testOverlap=ke,we.Input=Ae,we.Output=be,we.Proxy=Ce,we.Cache=Be;class Le{constructor(){this.proxyA=new Ce,this.proxyB=new Ce,this.transformA=Ot.identity(),this.transformB=Ot.identity(),this.translationB=tt.zero()}recycle(){this.proxyA.recycle(),this.proxyB.recycle(),this.transformA.setIdentity(),this.transformB.setIdentity(),ut(this.translationB)}}class qe{constructor(){this.point=tt.zero(),this.normal=tt.zero(),this.lambda=1,this.iterations=0}}const De=function(t,e){t.iterations=0,t.lambda=1,t.normal.setZero(),t.point.setZero();const i=e.proxyA,s=e.proxyB,o=$.max(i.m_radius,st.polygonRadius),n=o+$.max(s.m_radius,st.polygonRadius),r=e.transformA,h=e.transformB,a=e.translationB,m=tt.zero();let c=0;const l=new Se;l.m_count=0;const _=l.m_v;let u=i.getSupport(Rt.mulTVec2(r.q,tt.neg(a))),d=Ot.mulVec2(r,i.getVertex(u)),p=s.getSupport(Rt.mulTVec2(h.q,a)),y=Ot.mulVec2(h,s.getVertex(p));const x=tt.sub(d,y),f=$.max(st.polygonRadius,n-st.polygonRadius),g=.5*st.linearSlop;let v=0;for(;v<20&&x.length()-f>g;){t.iterations+=1,u=i.getSupport(Rt.mulTVec2(r.q,tt.neg(x))),d=Ot.mulVec2(r,i.getVertex(u)),p=s.getSupport(Rt.mulTVec2(h.q,x)),y=Ot.mulVec2(h,s.getVertex(p));const e=tt.sub(d,y);x.normalize();const o=tt.dot(x,e),n=tt.dot(x,a);if(o-f>c*n){if(n<=0)return!1;if(c=(o-f)/n,c>1)return!1;m.setMul(-1,x),l.m_count=0}const g=_[l.m_count];switch(g.indexA=p,g.wA=tt.combine(1,y,c,a),g.indexB=u,g.wB=d,g.w=tt.sub(g.wB,g.wA),g.a=1,l.m_count+=1,l.m_count){case 1:break;case 2:l.solve2();break;case 3:l.solve3()}if(3==l.m_count)return!1;x.setVec2(l.getClosestPoint()),++v}if(0==v)return!1;const A=tt.zero(),b=tt.zero();return l.getWitnessPoints(b,A),x.lengthSquared()>0&&(m.setMul(-1,x),m.normalize()),t.point=tt.combine(1,A,o,m),t.normal=m,t.lambda=c,t.iterations=v,!0};class je{constructor(){this.proxyA=new Ce,this.proxyB=new Ce,this.sweepA=new Et,this.sweepB=new Et}recycle(){this.proxyA.recycle(),this.proxyB.recycle(),this.sweepA.recycle(),this.sweepB.recycle(),this.tMax=-1}}var Re;t.TOIOutputState=void 0,(Re=t.TOIOutputState||(t.TOIOutputState={}))[Re.e_unset=-1]="e_unset",Re[Re.e_unknown=0]="e_unknown",Re[Re.e_failed=1]="e_failed",Re[Re.e_overlapped=2]="e_overlapped",Re[Re.e_touching=3]="e_touching",Re[Re.e_separated=4]="e_separated";class Ne{constructor(){this.state=t.TOIOutputState.e_unset,this.t=-1}recycle(){this.state=t.TOIOutputState.e_unset,this.t=-1}}le.toiTime=0,le.toiMaxTime=0,le.toiCalls=0,le.toiIters=0,le.toiMaxIters=0,le.toiRootIters=0,le.toiMaxRootIters=0;const Ee=new Ae,Oe=new be,Ye=new Be,We=Ft(0,0,0),Je=Ft(0,0,0),Xe=ct(0,0),He=ct(0,0),Ke=ct(0,0),Ze=ct(0,0),Ue=ct(0,0),Ge=ct(0,0),Qe=ct(0,0),$e=ct(0,0),ti=function(e,i){const s=_e();++le.toiCalls,e.state=t.TOIOutputState.e_unknown,e.t=i.tMax;const o=i.proxyA,n=i.proxyB,r=i.sweepA,h=i.sweepB;r.normalize(),h.normalize();const a=i.tMax,m=o.m_radius+n.m_radius,c=$.max(st.linearSlop,m-3*st.linearSlop),l=.25*st.linearSlop;let _=0;const u=st.maxTOIIterations;let d=0;for(Ye.recycle(),Ee.proxyA.setVertices(o.m_vertices,o.m_count,o.m_radius),Ee.proxyB.setVertices(n.m_vertices,n.m_count,n.m_radius),Ee.useRadii=!1;;){if(r.getTransform(We,_),h.getTransform(Je,_),kt(Ee.transformA,We),kt(Ee.transformB,Je),we(Oe,Ye,Ee),Oe.distance<=0){e.state=t.TOIOutputState.e_overlapped,e.t=0;break}if(Oe.distance<c+l){e.state=t.TOIOutputState.e_touching,e.t=_;break}ii.initialize(Ye,o,r,n,h,_);let i=!1,s=a,m=0;for(;;){let o=ii.findMinSeparation(s);if(o>c+l){e.state=t.TOIOutputState.e_separated,e.t=a,i=!0;break}if(o>c-l){_=s;break}let n=ii.evaluate(_);if(n<c-l){e.state=t.TOIOutputState.e_failed,e.t=_,i=!0;break}if(n<=c+l){e.state=t.TOIOutputState.e_touching,e.t=_,i=!0;break}let r=0,h=_,u=s;for(;;){let t;t=1&r?h+(c-n)*(u-h)/(o-n):.5*(h+u),++r,++le.toiRootIters;const e=ii.evaluate(t);if($.abs(e-c)<l){s=t;break}if(e>c?(h=t,n=e):(u=t,o=e),50===r)break}if(le.toiMaxRootIters=$.max(le.toiMaxRootIters,r),++m,m===st.maxPolygonVertices)break}if(++d,++le.toiIters,i)break;if(d===u){e.state=t.TOIOutputState.e_failed,e.t=_;break}}le.toiMaxIters=$.max(le.toiMaxIters,d);const p=ue(s);le.toiMaxTime=$.max(le.toiMaxTime,p),le.toiTime+=p,ii.recycle()};var ei;!function(t){t[t.e_unset=-1]="e_unset",t[t.e_points=1]="e_points",t[t.e_faceA=2]="e_faceA",t[t.e_faceB=3]="e_faceB"}(ei||(ei={}));const ii=new class{constructor(){this.m_proxyA=null,this.m_proxyB=null,this.m_sweepA=null,this.m_sweepB=null,this.m_type=ei.e_unset,this.m_localPoint=ct(0,0),this.m_axis=ct(0,0),this.indexA=-1,this.indexB=-1}recycle(){this.m_proxyA=null,this.m_proxyB=null,this.m_sweepA=null,this.m_sweepB=null,this.m_type=ei.e_unset,ut(this.m_localPoint),ut(this.m_axis),this.indexA=-1,this.indexB=-1}initialize(t,e,i,s,o,n){const r=t.count;if(this.m_proxyA=e,this.m_proxyB=s,this.m_sweepA=i,this.m_sweepB=o,this.m_sweepA.getTransform(We,n),this.m_sweepB.getTransform(Je,n),1===r){this.m_type=ei.e_points;const e=this.m_proxyA.getVertex(t.indexA[0]),i=this.m_proxyB.getVertex(t.indexB[0]);Lt(He,We,e),Lt(Ke,Je,i),xt(this.m_axis,Ke,He);return function(t){const e=Math.sqrt(t.x*t.x+t.y*t.y);if(0!==e){const i=1/e;t.x*=i,t.y*=i}return e}(this.m_axis)}if(t.indexA[0]===t.indexA[1]){this.m_type=ei.e_faceB;const i=s.getVertex(t.indexB[0]),o=s.getVertex(t.indexB[1]);wt(this.m_axis,xt(Xe,o,i),1),Bt(this.m_axis),Tt(Ze,Je.q,this.m_axis),bt(this.m_localPoint,.5,i,.5,o),Lt(Ke,Je,this.m_localPoint);const n=e.getVertex(t.indexA[0]);let r=Vt(Ot.mulVec2(We,n),Ze)-Vt(Ke,Ze);return r<0&&(dt(this.m_axis),r=-r),r}{this.m_type=ei.e_faceA;const e=this.m_proxyA.getVertex(t.indexA[0]),i=this.m_proxyA.getVertex(t.indexA[1]);wt(this.m_axis,xt(Xe,i,e),1),Bt(this.m_axis),Tt(Ze,We.q,this.m_axis),bt(this.m_localPoint,.5,e,.5,i),Lt(He,We,this.m_localPoint);const s=this.m_proxyB.getVertex(t.indexB[0]);Lt(Ke,Je,s);let o=Vt(Ke,Ze)-Vt(He,Ze);return o<0&&(dt(this.m_axis),o=-o),o}}compute(t,e){switch(this.m_sweepA.getTransform(We,e),this.m_sweepB.getTransform(Je,e),this.m_type){case ei.e_points:t&&(zt(Ue,We.q,this.m_axis),zt(Ge,Je.q,gt(Xe,-1,this.m_axis)),this.indexA=this.m_proxyA.getSupport(Ue),this.indexB=this.m_proxyB.getSupport(Ge)),_t(Qe,this.m_proxyA.getVertex(this.indexA)),_t($e,this.m_proxyB.getVertex(this.indexB)),Lt(He,We,Qe),Lt(Ke,Je,$e);return Vt(Ke,this.m_axis)-Vt(He,this.m_axis);case ei.e_faceA:Tt(Ze,We.q,this.m_axis),Lt(He,We,this.m_localPoint),t&&(zt(Ge,Je.q,gt(Xe,-1,Ze)),this.indexA=-1,this.indexB=this.m_proxyB.getSupport(Ge)),_t($e,this.m_proxyB.getVertex(this.indexB)),Lt(Ke,Je,$e);return Vt(Ke,Ze)-Vt(He,Ze);case ei.e_faceB:Tt(Ze,Je.q,this.m_axis),Lt(Ke,Je,this.m_localPoint),t&&(zt(Ue,We.q,gt(Xe,-1,Ze)),this.indexB=-1,this.indexA=this.m_proxyA.getSupport(Ue)),_t(Qe,this.m_proxyA.getVertex(this.indexA)),Lt(He,We,Qe);return Vt(He,Ze)-Vt(Ke,Ze);default:return t&&(this.indexA=-1,this.indexB=-1),0}}findMinSeparation(t){return this.compute(!0,t)}evaluate(t){return this.compute(!1,t)}};ti.Input=je,ti.Output=Ne;class si{constructor(){this.dt=0,this.inv_dt=0,this.velocityIterations=0,this.positionIterations=0,this.warmStarting=!1,this.blockSolve=!0,this.inv_dt0=0,this.dtRatio=1}reset(t){this.dt>0&&(this.inv_dt0=this.inv_dt),this.dt=t,this.inv_dt=0==t?0:1/t,this.dtRatio=t*this.inv_dt0}}const oi=new si,ni=ct(0,0),ri=ct(0,0),hi=ct(0,0),ai=new je,mi=new Ne,ci=new Et,li=new Et,_i=new Et;class ui{constructor(t){this.contact=t,this.normals=[],this.tangents=[]}recycle(){this.normals.length=0,this.tangents.length=0}get normalImpulses(){const t=this.contact,e=this.normals;e.length=0;for(let i=0;i<t.v_points.length;++i)e.push(t.v_points[i].normalImpulse);return e}get tangentImpulses(){const t=this.contact,e=this.tangents;e.length=0;for(let i=0;i<t.v_points.length;++i)e.push(t.v_points[i].tangentImpulse);return e}}class di{constructor(t){this.m_world=t,this.m_stack=[],this.m_bodies=[],this.m_contacts=[],this.m_joints=[]}clear(){this.m_stack.length=0,this.m_bodies.length=0,this.m_contacts.length=0,this.m_joints.length=0}addBody(t){this.m_bodies.push(t)}addContact(t){this.m_contacts.push(t)}addJoint(t){this.m_joints.push(t)}solveWorld(t){const e=this.m_world;for(let t=e.m_bodyList;t;t=t.m_next)t.m_islandFlag=!1;for(let t=e.m_contactList;t;t=t.m_next)t.m_islandFlag=!1;for(let t=e.m_jointList;t;t=t.m_next)t.m_islandFlag=!1;const i=this.m_stack;for(let s=e.m_bodyList;s;s=s.m_next)if(!s.m_islandFlag&&0!=s.isAwake()&&0!=s.isActive()&&!s.isStatic()){for(this.clear(),i.push(s),s.m_islandFlag=!0;i.length>0;){const t=i.pop();if(this.addBody(t),t.m_awakeFlag=!0,!t.isStatic()){for(let e=t.m_contactList;e;e=e.next){const t=e.contact;if(t.m_islandFlag)continue;if(0==t.isEnabled()||0==t.isTouching())continue;const s=t.m_fixtureA.m_isSensor,o=t.m_fixtureB.m_isSensor;if(s||o)continue;this.addContact(t),t.m_islandFlag=!0;const n=e.other;n.m_islandFlag||(i.push(n),n.m_islandFlag=!0)}for(let e=t.m_jointList;e;e=e.next){if(1==e.joint.m_islandFlag)continue;const t=e.other;0!=t.isActive()&&(this.addJoint(e.joint),e.joint.m_islandFlag=!0,t.m_islandFlag||(i.push(t),t.m_islandFlag=!0))}}}this.solveIsland(t);for(let t=0;t<this.m_bodies.length;++t){const e=this.m_bodies[t];e.isStatic()&&(e.m_islandFlag=!1)}}}solveIsland(t){const e=this.m_world,i=e.m_gravity,s=e.m_allowSleep,o=t.dt;for(let t=0;t<this.m_bodies.length;++t){const e=this.m_bodies[t];_t(ni,e.m_sweep.c);const s=e.m_sweep.a;_t(ri,e.m_linearVelocity);let n=e.m_angularVelocity;_t(e.m_sweep.c0,e.m_sweep.c),e.m_sweep.a0=e.m_sweep.a,e.isDynamic()&&(vt(ri,o*e.m_gravityScale,i),vt(ri,o*e.m_invMass,e.m_force),n+=o*e.m_invI*e.m_torque,gt(ri,1/(1+o*e.m_linearDamping),ri),n*=1/(1+o*e.m_angularDamping)),_t(e.c_position.c,ni),e.c_position.a=s,_t(e.c_velocity.v,ri),e.c_velocity.w=n}for(let e=0;e<this.m_contacts.length;++e){this.m_contacts[e].initConstraint(t)}for(let e=0;e<this.m_contacts.length;++e){this.m_contacts[e].initVelocityConstraint(t)}if(t.warmStarting)for(let e=0;e<this.m_contacts.length;++e){this.m_contacts[e].warmStartConstraint(t)}for(let e=0;e<this.m_joints.length;++e){this.m_joints[e].initVelocityConstraints(t)}for(let e=0;e<t.velocityIterations;++e){for(let e=0;e<this.m_joints.length;++e){this.m_joints[e].solveVelocityConstraints(t)}for(let e=0;e<this.m_contacts.length;++e){this.m_contacts[e].solveVelocityConstraint(t)}}for(let e=0;e<this.m_contacts.length;++e){this.m_contacts[e].storeConstraintImpulses(t)}for(let t=0;t<this.m_bodies.length;++t){const e=this.m_bodies[t];_t(ni,e.c_position.c);let i=e.c_position.a;_t(ri,e.c_velocity.v);let s=e.c_velocity.w;gt(hi,o,ri);const n=It(hi);if(n>st.maxTranslationSquared){const t=st.maxTranslation/$.sqrt(n);ft(ri,t)}const r=o*s;if(r*r>st.maxRotationSquared){s*=st.maxRotation/$.abs(r)}vt(ni,o,ri),i+=o*s,_t(e.c_position.c,ni),e.c_position.a=i,_t(e.c_velocity.v,ri),e.c_velocity.w=s}let n=!1;for(let e=0;e<t.positionIterations;++e){let e=0;for(let i=0;i<this.m_contacts.length;++i){const s=this.m_contacts[i].solvePositionConstraint(t);e=$.min(e,s)}const i=e>=-3*st.linearSlop;let s=!0;for(let e=0;e<this.m_joints.length;++e){const i=this.m_joints[e].solvePositionConstraints(t);s=s&&i}if(i&&s){n=!0;break}}for(let t=0;t<this.m_bodies.length;++t){const e=this.m_bodies[t];_t(e.m_sweep.c,e.c_position.c),e.m_sweep.a=e.c_position.a,_t(e.m_linearVelocity,e.c_velocity.v),e.m_angularVelocity=e.c_velocity.w,e.synchronizeTransform()}if(this.postSolveIsland(),s){let t=1/0;const e=st.linearSleepToleranceSqr,i=st.angularSleepToleranceSqr;for(let s=0;s<this.m_bodies.length;++s){const n=this.m_bodies[s];n.isStatic()||(0==n.m_autoSleepFlag||n.m_angularVelocity*n.m_angularVelocity>i||It(n.m_linearVelocity)>e?(n.m_sleepTime=0,t=0):(n.m_sleepTime+=o,t=$.min(t,n.m_sleepTime)))}if(t>=st.timeToSleep&&n)for(let t=0;t<this.m_bodies.length;++t){this.m_bodies[t].setAwake(!1)}}}solveWorldTOI(e){const i=this.m_world;if(i.m_stepComplete){for(let t=i.m_bodyList;t;t=t.m_next)t.m_islandFlag=!1,t.m_sweep.alpha0=0;for(let t=i.m_contactList;t;t=t.m_next)t.m_toiFlag=!1,t.m_islandFlag=!1,t.m_toiCount=0,t.m_toi=1}for(;;){let s=null,o=1;for(let e=i.m_contactList;e;e=e.m_next){if(0==e.isEnabled())continue;if(e.m_toiCount>st.maxSubSteps)continue;let i=1;if(e.m_toiFlag)i=e.m_toi;else{const s=e.getFixtureA(),o=e.getFixtureB();if(s.isSensor()||o.isSensor())continue;const n=s.getBody(),r=o.getBody(),h=n.isAwake()&&!n.isStatic(),a=r.isAwake()&&!r.isStatic();if(0==h&&0==a)continue;const m=n.isBullet()||!n.isDynamic(),c=r.isBullet()||!r.isDynamic();if(0==m&&0==c)continue;let l=n.m_sweep.alpha0;n.m_sweep.alpha0<r.m_sweep.alpha0?(l=r.m_sweep.alpha0,n.m_sweep.advance(l)):r.m_sweep.alpha0<n.m_sweep.alpha0&&(l=n.m_sweep.alpha0,r.m_sweep.advance(l));const _=e.getChildIndexA(),u=e.getChildIndexB();n.m_sweep,r.m_sweep,ai.proxyA.set(s.getShape(),_),ai.proxyB.set(o.getShape(),u),ai.sweepA.set(n.m_sweep),ai.sweepB.set(r.m_sweep),ai.tMax=1,ti(mi,ai);const d=mi.t;i=mi.state==t.TOIOutputState.e_touching?$.min(l+(1-l)*d,1):1,e.m_toi=i,e.m_toiFlag=!0}i<o&&(s=e,o=i)}if(null==s||1-10*$.EPSILON<o){i.m_stepComplete=!0;break}const n=s.getFixtureA(),r=s.getFixtureB(),h=n.getBody(),a=r.getBody();if(li.set(h.m_sweep),_i.set(a.m_sweep),h.advance(o),a.advance(o),s.update(i),s.m_toiFlag=!1,++s.m_toiCount,0==s.isEnabled()||0==s.isTouching()){s.setEnabled(!1),h.m_sweep.set(li),a.m_sweep.set(_i),h.synchronizeTransform(),a.synchronizeTransform();continue}h.setAwake(!0),a.setAwake(!0),this.clear(),this.addBody(h),this.addBody(a),this.addContact(s),h.m_islandFlag=!0,a.m_islandFlag=!0,s.m_islandFlag=!0;const m=[h,a];for(let t=0;t<m.length;++t){const e=m[t];if(e.isDynamic())for(let t=e.m_contactList;t;t=t.next){const s=t.contact;if(s.m_islandFlag)continue;const n=t.other;if(n.isDynamic()&&!e.isBullet()&&!n.isBullet())continue;const r=s.m_fixtureA.m_isSensor,h=s.m_fixtureB.m_isSensor;r||h||(ci.set(n.m_sweep),0==n.m_islandFlag&&n.advance(o),s.update(i),0!=s.isEnabled()&&0!=s.isTouching()?(s.m_islandFlag=!0,this.addContact(s),n.m_islandFlag||(n.m_islandFlag=!0,n.isStatic()||n.setAwake(!0),this.addBody(n))):(n.m_sweep.set(ci),n.synchronizeTransform()))}}oi.reset((1-o)*e.dt),oi.dtRatio=1,oi.positionIterations=20,oi.velocityIterations=e.velocityIterations,oi.warmStarting=!1,this.solveIslandTOI(oi,h,a);for(let t=0;t<this.m_bodies.length;++t){const e=this.m_bodies[t];if(e.m_islandFlag=!1,e.isDynamic()){e.synchronizeFixtures();for(let t=e.m_contactList;t;t=t.next)t.contact.m_toiFlag=!1,t.contact.m_islandFlag=!1}}if(i.findNewContacts(),i.m_subStepping){i.m_stepComplete=!1;break}}}solveIslandTOI(t,e,i){for(let t=0;t<this.m_bodies.length;++t){const e=this.m_bodies[t];_t(e.c_position.c,e.m_sweep.c),e.c_position.a=e.m_sweep.a,_t(e.c_velocity.v,e.m_linearVelocity),e.c_velocity.w=e.m_angularVelocity}for(let e=0;e<this.m_contacts.length;++e){this.m_contacts[e].initConstraint(t)}for(let s=0;s<t.positionIterations;++s){let s=0;for(let o=0;o<this.m_contacts.length;++o){const n=this.m_contacts[o].solvePositionConstraintTOI(t,e,i);s=$.min(s,n)}if(s>=-1.5*st.linearSlop)break}_t(e.m_sweep.c0,e.c_position.c),e.m_sweep.a0=e.c_position.a,_t(i.m_sweep.c0,i.c_position.c),i.m_sweep.a0=i.c_position.a;for(let e=0;e<this.m_contacts.length;++e){this.m_contacts[e].initVelocityConstraint(t)}for(let e=0;e<t.velocityIterations;++e)for(let e=0;e<this.m_contacts.length;++e){this.m_contacts[e].solveVelocityConstraint(t)}const s=t.dt;for(let t=0;t<this.m_bodies.length;++t){const e=this.m_bodies[t];_t(ni,e.c_position.c);let i=e.c_position.a;_t(ri,e.c_velocity.v);let o=e.c_velocity.w;gt(hi,s,ri);const n=It(hi);if(n>st.maxTranslationSquared){const t=st.maxTranslation/$.sqrt(n);ft(ri,t)}const r=s*o;if(r*r>st.maxRotationSquared){o*=st.maxRotation/$.abs(r)}vt(ni,s,ri),i+=s*o,_t(e.c_position.c,ni),e.c_position.a=i,_t(e.c_velocity.v,ri),e.c_velocity.w=o,_t(e.m_sweep.c,ni),e.m_sweep.a=i,_t(e.m_linearVelocity,ri),e.m_angularVelocity=o,e.synchronizeTransform()}this.postSolveIsland()}postSolveIsland(){for(let t=0;t<this.m_contacts.length;++t){const e=this.m_contacts[t];this.m_world.postSolve(e,e.m_impulse)}}}di.TimeStep=si;class pi{constructor(t,e,i,s){"object"==typeof t&&null!==t?(this.ex=tt.clone(t),this.ey=tt.clone(e)):"number"==typeof t?(this.ex=tt.neo(t,i),this.ey=tt.neo(e,s)):(this.ex=tt.zero(),this.ey=tt.zero())}toString(){return JSON.stringify(this)}static isValid(t){return null!=t&&(tt.isValid(t.ex)&&tt.isValid(t.ey))}static assert(t){}set(t,e,i,s){"number"==typeof t&&"number"==typeof e&&"number"==typeof i&&"number"==typeof s?(this.ex.setNum(t,i),this.ey.setNum(e,s)):"object"==typeof t&&"object"==typeof e?(this.ex.setVec2(t),this.ey.setVec2(e)):"object"==typeof t&&(this.ex.setVec2(t.ex),this.ey.setVec2(t.ey))}setIdentity(){this.ex.x=1,this.ey.x=0,this.ex.y=0,this.ey.y=1}setZero(){this.ex.x=0,this.ey.x=0,this.ex.y=0,this.ey.y=0}getInverse(){const t=this.ex.x,e=this.ey.x,i=this.ex.y,s=this.ey.y;let o=t*s-e*i;0!==o&&(o=1/o);const n=new pi;return n.ex.x=o*s,n.ey.x=-o*e,n.ex.y=-o*i,n.ey.y=o*t,n}solve(t){const e=this.ex.x,i=this.ey.x,s=this.ex.y,o=this.ey.y;let n=e*o-i*s;0!==n&&(n=1/n);const r=tt.zero();return r.x=n*(o*t.x-i*t.y),r.y=n*(e*t.y-s*t.x),r}static mul(t,e){if(e&&"x"in e&&"y"in e){const i=t.ex.x*e.x+t.ey.x*e.y,s=t.ex.y*e.x+t.ey.y*e.y;return tt.neo(i,s)}if(e&&"ex"in e&&"ey"in e){const i=t.ex.x*e.ex.x+t.ey.x*e.ex.y,s=t.ex.x*e.ey.x+t.ey.x*e.ey.y,o=t.ex.y*e.ex.x+t.ey.y*e.ex.y,n=t.ex.y*e.ey.x+t.ey.y*e.ey.y;return new pi(i,s,o,n)}}static mulVec2(t,e){const i=t.ex.x*e.x+t.ey.x*e.y,s=t.ex.y*e.x+t.ey.y*e.y;return tt.neo(i,s)}static mulMat22(t,e){const i=t.ex.x*e.ex.x+t.ey.x*e.ex.y,s=t.ex.x*e.ey.x+t.ey.x*e.ey.y,o=t.ex.y*e.ex.x+t.ey.y*e.ex.y,n=t.ex.y*e.ey.x+t.ey.y*e.ey.y;return new pi(i,s,o,n)}static mulT(t,e){if(e&&"x"in e&&"y"in e)return tt.neo(tt.dot(e,t.ex),tt.dot(e,t.ey));if(e&&"ex"in e&&"ey"in e){const i=tt.neo(tt.dot(t.ex,e.ex),tt.dot(t.ey,e.ex)),s=tt.neo(tt.dot(t.ex,e.ey),tt.dot(t.ey,e.ey));return new pi(i,s)}}static mulTVec2(t,e){return tt.neo(tt.dot(e,t.ex),tt.dot(e,t.ey))}static mulTMat22(t,e){const i=tt.neo(tt.dot(t.ex,e.ex),tt.dot(t.ey,e.ex)),s=tt.neo(tt.dot(t.ex,e.ey),tt.dot(t.ey,e.ey));return new pi(i,s)}static abs(t){return new pi(tt.abs(t.ex),tt.abs(t.ey))}static add(t,e){return new pi(tt.add(t.ex,e.ex),tt.add(t.ey,e.ey))}}const yi=ct(0,0),xi=ct(0,0),fi=ct(0,0),gi=ct(0,0),vi=ct(0,0),Ai=ct(0,0),bi=ct(0,0),Bi=ct(0,0);var wi,Ci,Mi;t.ManifoldType=void 0,(wi=t.ManifoldType||(t.ManifoldType={}))[wi.e_unset=-1]="e_unset",wi[wi.e_circles=0]="e_circles",wi[wi.e_faceA=1]="e_faceA",wi[wi.e_faceB=2]="e_faceB",t.ContactFeatureType=void 0,(Ci=t.ContactFeatureType||(t.ContactFeatureType={}))[Ci.e_unset=-1]="e_unset",Ci[Ci.e_vertex=0]="e_vertex",Ci[Ci.e_face=1]="e_face",t.PointState=void 0,(Mi=t.PointState||(t.PointState={}))[Mi.nullState=0]="nullState",Mi[Mi.addState=1]="addState",Mi[Mi.persistState=2]="persistState",Mi[Mi.removeState=3]="removeState";class Vi{constructor(){this.v=ct(0,0),this.id=new Pi}set(t){_t(this.v,t.v),this.id.set(t.id)}recycle(){ut(this.v),this.id.recycle()}}class Ii{constructor(){this.localNormal=ct(0,0),this.localPoint=ct(0,0),this.points=[new Si,new Si],this.pointCount=0}set(t){this.type=t.type,_t(this.localNormal,t.localNormal),_t(this.localPoint,t.localPoint),this.pointCount=t.pointCount,this.points[0].set(t.points[0]),this.points[1].set(t.points[1])}recycle(){this.type=t.ManifoldType.e_unset,ut(this.localNormal),ut(this.localPoint),this.pointCount=0,this.points[0].recycle(),this.points[1].recycle()}getWorldManifold(e,i,s,o,n){if(0==this.pointCount)return e;(e=e||new Ti).pointCount=this.pointCount;const r=e.normal,h=e.points,a=e.separations;switch(this.type){case t.ManifoldType.e_circles:{lt(r,1,0);const t=this.points[0];Lt(yi,i,this.localPoint),Lt(xi,o,t.localPoint),xt(Ai,xi,yi);const e=It(Ai);if(e>$.EPSILON*$.EPSILON){gt(r,1/$.sqrt(e),Ai)}bt(gi,1,yi,s,r),bt(vi,1,xi,-n,r),bt(h[0],.5,gi,.5,vi),a[0]=Vt(xt(fi,vi,gi),r);break}case t.ManifoldType.e_faceA:Tt(r,i.q,this.localNormal),Lt(bi,i,this.localPoint);for(let t=0;t<this.pointCount;++t){const e=this.points[t];Lt(Bi,o,e.localPoint),bt(gi,1,Bi,s-Vt(xt(fi,Bi,bi),r),r),bt(vi,1,Bi,-n,r),bt(h[t],.5,gi,.5,vi),a[t]=Vt(xt(fi,vi,gi),r)}break;case t.ManifoldType.e_faceB:Tt(r,o.q,this.localNormal),Lt(bi,o,this.localPoint);for(let t=0;t<this.pointCount;++t){const e=this.points[t];Lt(Bi,i,e.localPoint),bt(vi,1,Bi,n-Vt(xt(fi,Bi,bi),r),r),bt(gi,1,Bi,-s,r),bt(h[t],.5,gi,.5,vi),a[t]=Vt(xt(fi,gi,vi),r)}dt(r)}return e}}Ii.clipSegmentToLine=Fi,Ii.ClipVertex=Vi,Ii.getPointStates=zi,Ii.PointState=t.PointState;class Si{constructor(){this.localPoint=ct(0,0),this.normalImpulse=0,this.tangentImpulse=0,this.id=new Pi}set(t){_t(this.localPoint,t.localPoint),this.normalImpulse=t.normalImpulse,this.tangentImpulse=t.tangentImpulse,this.id.set(t.id)}recycle(){ut(this.localPoint),this.normalImpulse=0,this.tangentImpulse=0,this.id.recycle()}}class Pi{constructor(){this.key=-1,this.indexA=-1,this.indexB=-1,this.typeA=t.ContactFeatureType.e_unset,this.typeB=t.ContactFeatureType.e_unset}setFeatures(t,e,i,s){this.indexA=t,this.indexB=i,this.typeA=e,this.typeB=s,this.key=this.indexA+4*this.indexB+16*this.typeA+64*this.typeB}set(t){this.indexA=t.indexA,this.indexB=t.indexB,this.typeA=t.typeA,this.typeB=t.typeB,this.key=this.indexA+4*this.indexB+16*this.typeA+64*this.typeB}swapFeatures(){const t=this.indexA,e=this.indexB,i=this.typeA,s=this.typeB;this.indexA=e,this.indexB=t,this.typeA=s,this.typeB=i,this.key=this.indexA+4*this.indexB+16*this.typeA+64*this.typeB}recycle(){this.indexA=0,this.indexB=0,this.typeA=t.ContactFeatureType.e_unset,this.typeB=t.ContactFeatureType.e_unset,this.key=-1}}class Ti{constructor(){this.normal=ct(0,0),this.points=[ct(0,0),ct(0,0)],this.separations=[0,0],this.pointCount=0}recycle(){ut(this.normal),ut(this.points[0]),ut(this.points[1]),this.separations[0]=0,this.separations[1]=0,this.pointCount=0}}function zi(e,i,s,o){for(let i=0;i<s.pointCount;++i){const n=s.points[i].id;e[i]=t.PointState.removeState;for(let s=0;s<o.pointCount;++s)if(o.points[s].id.key===n.key){e[i]=t.PointState.persistState;break}}for(let e=0;e<o.pointCount;++e){const n=o.points[e].id;i[e]=t.PointState.addState;for(let o=0;o<s.pointCount;++o)if(s.points[o].id.key===n.key){i[e]=t.PointState.persistState;break}}}function Fi(e,i,s,o,n){let r=0;const h=Vt(s,i[0].v)-o,a=Vt(s,i[1].v)-o;if(h<=0&&e[r++].set(i[0]),a<=0&&e[r++].set(i[1]),h*a<0){const s=h/(h-a);bt(e[r].v,1-s,i[0].v,s,i[1].v),e[r].id.setFeatures(n,t.ContactFeatureType.e_vertex,i[0].id.indexB,t.ContactFeatureType.e_face),++r}return r}const ki=new ot({create:()=>new ds,release(t){t.recycle()}}),Li=new Ii,qi=new Ti;class Di{constructor(t){this.prev=null,this.next=null,this.other=null,this.contact=t}recycle(){this.prev=null,this.next=null,this.other=null}}function ji(t,e){return $.sqrt(t*e)}function Ri(t,e){return t>e?t:e}const Ni=[];class Ei{constructor(){this.rA=ct(0,0),this.rB=ct(0,0),this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0}recycle(){ut(this.rA),ut(this.rB),this.normalImpulse=0,this.tangentImpulse=0,this.normalMass=0,this.tangentMass=0,this.velocityBias=0}}const Oi=ct(0,0),Yi=ct(0,0),Wi=ct(0,0),Ji=ct(0,0),Xi=ct(0,0),Hi=Ft(0,0,0),Ki=Ft(0,0,0),Zi=ct(0,0),Ui=ct(0,0),Gi=ct(0,0),Qi=ct(0,0),$i=ct(0,0),ts=ct(0,0),es=ct(0,0),is=ct(0,0),ss=ct(0,0),os=ct(0,0),ns=ct(0,0),rs=ct(0,0),hs=ct(0,0),as=ct(0,0),ms=ct(0,0),cs=ct(0,0),ls=ct(0,0),_s=ct(0,0),us=ct(0,0);class ds{constructor(){this.m_nodeA=new Di(this),this.m_nodeB=new Di(this),this.m_fixtureA=null,this.m_fixtureB=null,this.m_indexA=-1,this.m_indexB=-1,this.m_evaluateFcn=null,this.m_manifold=new Ii,this.m_prev=null,this.m_next=null,this.m_toi=1,this.m_toiCount=0,this.m_toiFlag=!1,this.m_friction=0,this.m_restitution=0,this.m_tangentSpeed=0,this.m_enabledFlag=!0,this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_impulse=new ui(this),this.v_points=[new Ei,new Ei],this.v_normal=ct(0,0),this.v_normalMass=new pi,this.v_K=new pi,this.v_pointCount=0,this.v_tangentSpeed=0,this.v_friction=0,this.v_restitution=0,this.v_invMassA=0,this.v_invMassB=0,this.v_invIA=0,this.v_invIB=0,this.p_localPoints=[ct(0,0),ct(0,0)],this.p_localNormal=ct(0,0),this.p_localPoint=ct(0,0),this.p_localCenterA=ct(0,0),this.p_localCenterB=ct(0,0),this.p_type=t.ManifoldType.e_unset,this.p_radiusA=0,this.p_radiusB=0,this.p_pointCount=0,this.p_invMassA=0,this.p_invMassB=0,this.p_invIA=0,this.p_invIB=0}initialize(t,e,i,s,o){this.m_fixtureA=t,this.m_fixtureB=i,this.m_indexA=e,this.m_indexB=s,this.m_evaluateFcn=o,this.m_friction=ji(this.m_fixtureA.m_friction,this.m_fixtureB.m_friction),this.m_restitution=Ri(this.m_fixtureA.m_restitution,this.m_fixtureB.m_restitution)}recycle(){this.m_nodeA.recycle(),this.m_nodeB.recycle(),this.m_fixtureA=null,this.m_fixtureB=null,this.m_indexA=-1,this.m_indexB=-1,this.m_evaluateFcn=null,this.m_manifold.recycle(),this.m_prev=null,this.m_next=null,this.m_toi=1,this.m_toiCount=0,this.m_toiFlag=!1,this.m_friction=0,this.m_restitution=0,this.m_tangentSpeed=0,this.m_enabledFlag=!0,this.m_islandFlag=!1,this.m_touchingFlag=!1,this.m_filterFlag=!1,this.m_bulletHitFlag=!1,this.m_impulse.recycle();for(const t of this.v_points)t.recycle();ut(this.v_normal),this.v_normalMass.setZero(),this.v_K.setZero(),this.v_pointCount=0,this.v_tangentSpeed=0,this.v_friction=0,this.v_restitution=0,this.v_invMassA=0,this.v_invMassB=0,this.v_invIA=0,this.v_invIB=0;for(const t of this.p_localPoints)ut(t);ut(this.p_localNormal),ut(this.p_localPoint),ut(this.p_localCenterA),ut(this.p_localCenterB),this.p_type=t.ManifoldType.e_unset,this.p_radiusA=0,this.p_radiusB=0,this.p_pointCount=0,this.p_invMassA=0,this.p_invMassB=0,this.p_invIA=0,this.p_invIB=0}initConstraint(t){const e=this.m_fixtureA,i=this.m_fixtureB;if(null===e||null===i)return;const s=e.m_body,o=i.m_body;if(null===s||null===o)return;const n=e.m_shape,r=i.m_shape;if(null===n||null===r)return;const h=this.m_manifold,a=h.pointCount;this.v_invMassA=s.m_invMass,this.v_invMassB=o.m_invMass,this.v_invIA=s.m_invI,this.v_invIB=o.m_invI,this.v_friction=this.m_friction,this.v_restitution=this.m_restitution,this.v_tangentSpeed=this.m_tangentSpeed,this.v_pointCount=a,this.v_K.setZero(),this.v_normalMass.setZero(),this.p_invMassA=s.m_invMass,this.p_invMassB=o.m_invMass,this.p_invIA=s.m_invI,this.p_invIB=o.m_invI,_t(this.p_localCenterA,s.m_sweep.localCenter),_t(this.p_localCenterB,o.m_sweep.localCenter),this.p_radiusA=n.m_radius,this.p_radiusB=r.m_radius,this.p_type=h.type,_t(this.p_localNormal,h.localNormal),_t(this.p_localPoint,h.localPoint),this.p_pointCount=a;for(let t=0;t<st.maxManifoldPoints;++t)this.v_points[t].recycle(),ut(this.p_localPoints[t]);for(let e=0;e<a;++e){const i=h.points[e],s=this.v_points[e];t.warmStarting&&(s.normalImpulse=t.dtRatio*i.normalImpulse,s.tangentImpulse=t.dtRatio*i.tangentImpulse),_t(this.p_localPoints[e],i.localPoint)}}getManifold(){return this.m_manifold}getWorldManifold(t){const e=this.m_fixtureA,i=this.m_fixtureB;if(null===e||null===i)return;const s=e.m_body,o=i.m_body;if(null===s||null===o)return;const n=e.m_shape,r=i.m_shape;return null!==n&&null!==r?this.m_manifold.getWorldManifold(t,s.getTransform(),n.m_radius,o.getTransform(),r.m_radius):void 0}setEnabled(t){this.m_enabledFlag=!!t}isEnabled(){return this.m_enabledFlag}isTouching(){return this.m_touchingFlag}getNext(){return this.m_next}getFixtureA(){return this.m_fixtureA}getFixtureB(){return this.m_fixtureB}getChildIndexA(){return this.m_indexA}getChildIndexB(){return this.m_indexB}flagForFiltering(){this.m_filterFlag=!0}setFriction(t){this.m_friction=t}getFriction(){return this.m_friction}resetFriction(){const t=this.m_fixtureA,e=this.m_fixtureB;null!==t&&null!==e&&(this.m_friction=ji(t.m_friction,e.m_friction))}setRestitution(t){this.m_restitution=t}getRestitution(){return this.m_restitution}resetRestitution(){const t=this.m_fixtureA,e=this.m_fixtureB;null!==t&&null!==e&&(this.m_restitution=Ri(t.m_restitution,e.m_restitution))}setTangentSpeed(t){this.m_tangentSpeed=t}getTangentSpeed(){return this.m_tangentSpeed}evaluate(t,e,i){const s=this.m_fixtureA,o=this.m_fixtureB;null!==s&&null!==o&&this.m_evaluateFcn(t,e,s,this.m_indexA,i,o,this.m_indexB)}update(t){const e=this.m_fixtureA,i=this.m_fixtureB;if(null===e||null===i)return;const s=e.m_body,o=i.m_body;if(null===s||null===o)return;const n=e.m_shape,r=i.m_shape;if(null===n||null===r)return;this.m_enabledFlag=!0;let h=!1;const a=this.m_touchingFlag,m=e.m_isSensor,c=i.m_isSensor,l=m||c,_=s.m_xf,u=o.m_xf;if(l)h=ke(n,this.m_indexA,r,this.m_indexB,_,u),this.m_manifold.pointCount=0;else{Li.recycle(),Li.set(this.m_manifold),this.m_manifold.recycle(),this.evaluate(this.m_manifold,_,u),h=this.m_manifold.pointCount>0;for(let t=0;t<this.m_manifold.pointCount;++t){const e=this.m_manifold.points[t];e.normalImpulse=0,e.tangentImpulse=0;for(let t=0;t<Li.pointCount;++t){const i=Li.points[t];if(i.id.key===e.id.key){e.normalImpulse=i.normalImpulse,e.tangentImpulse=i.tangentImpulse;break}}}h!==a&&(s.setAwake(!0),o.setAwake(!0))}this.m_touchingFlag=h;const d="object"==typeof t&&null!==t;!a&&h&&d&&t.beginContact(this),a&&!h&&d&&t.endContact(this),!l&&h&&d&&Li&&t.preSolve(this,Li)}solvePositionConstraint(t){return this._solvePositionConstraint(t,null,null)}solvePositionConstraintTOI(t,e,i){return this._solvePositionConstraint(t,e,i)}_solvePositionConstraint(e,i,s){const o=null!==i&&null!==s;let n=0;const r=this.m_fixtureA,h=this.m_fixtureB;if(null===r||null===h)return n;const a=r.m_body,m=h.m_body;if(null===a||null===m)return n;a.c_velocity,m.c_velocity;const c=a.c_position,l=m.c_position,_=this.p_localCenterA,u=this.p_localCenterB;let d=0,p=0;o&&a!==i&&a!==s||(d=this.p_invMassA,p=this.p_invIA);let y=0,x=0;o&&m!==i&&m!==s||(y=this.p_invMassB,x=this.p_invIB),_t(Oi,c.c);let f=c.a;_t(Wi,l.c);let g=l.a;for(let e=0;e<this.p_pointCount;++e){let i;switch(Jt(Hi,_,Oi,f),Jt(Ki,u,Wi,g),this.p_type){case t.ManifoldType.e_circles:Lt(Zi,Hi,this.p_localPoint),Lt(Ui,Ki,this.p_localPoints[0]),xt(is,Ui,Zi),Bt(is),bt(ss,.5,Zi,.5,Ui),i=Vt(Ui,is)-Vt(Zi,is)-this.p_radiusA-this.p_radiusB;break;case t.ManifoldType.e_faceA:Tt(is,Hi.q,this.p_localNormal),Lt(Qi,Hi,this.p_localPoint),Lt(Gi,Ki,this.p_localPoints[e]),i=Vt(Gi,is)-Vt(Qi,is)-this.p_radiusA-this.p_radiusB,_t(ss,Gi);break;case t.ManifoldType.e_faceB:Tt(is,Ki.q,this.p_localNormal),Lt(Qi,Ki,this.p_localPoint),Lt(Gi,Hi,this.p_localPoints[e]),i=Vt(Gi,is)-Vt(Qi,is)-this.p_radiusA-this.p_radiusB,_t(ss,Gi),dt(is);break;default:return n}xt($i,ss,Oi),xt(ts,ss,Wi),n=$.min(n,i);const s=o?st.toiBaugarte:st.baumgarte,r=st.linearSlop,h=st.maxLinearCorrection,a=$.clamp(s*(i+r),-h,0),m=Mt($i,is),c=Mt(ts,is),l=d+y+p*m*m+x*c*c;gt(es,l>0?-a/l:0,is),At(Oi,d,es),f-=p*Mt($i,es),vt(Wi,y,es),g+=x*Mt(ts,es)}return _t(c.c,Oi),c.a=f,_t(l.c,Wi),l.a=g,n}initVelocityConstraint(t){const e=this.m_fixtureA,i=this.m_fixtureB;if(null===e||null===i)return;const s=e.m_body,o=i.m_body;if(null===s||null===o)return;const n=s.c_velocity,r=o.c_velocity,h=s.c_position,a=o.c_position,m=this.p_radiusA,c=this.p_radiusB,l=this.m_manifold,_=this.v_invMassA,u=this.v_invMassB,d=this.v_invIA,p=this.v_invIB,y=this.p_localCenterA,x=this.p_localCenterB;_t(Oi,h.c);const f=h.a;_t(Yi,n.v);const g=n.w;_t(Wi,a.c);const v=a.a;_t(Ji,r.v);const A=r.w;Jt(Hi,y,Oi,f),Jt(Ki,x,Wi,v),qi.recycle(),l.getWorldManifold(qi,Hi,m,Ki,c),_t(this.v_normal,qi.normal);for(let t=0;t<this.v_pointCount;++t){const e=this.v_points[t],i=qi.points[t];xt(e.rA,i,Oi),xt(e.rB,i,Wi);const s=Mt(e.rA,this.v_normal),o=Mt(e.rB,this.v_normal),n=_+u+d*s*s+p*o*o;e.normalMass=n>0?1/n:0,wt(Xi,this.v_normal,1);const r=Mt(e.rA,Xi),h=Mt(e.rB,Xi),a=_+u+d*r*r+p*h*h;e.tangentMass=a>0?1/a:0,e.velocityBias=0;let m=0;m+=Vt(this.v_normal,Ji),m+=Vt(this.v_normal,Ct(us,A,e.rB)),m-=Vt(this.v_normal,Yi),m-=Vt(this.v_normal,Ct(us,g,e.rA)),m<-st.velocityThreshold&&(e.velocityBias=-this.v_restitution*m)}if(2==this.v_pointCount&&t.blockSolve){const t=this.v_points[0],e=this.v_points[1],i=Mt(t.rA,this.v_normal),s=Mt(t.rB,this.v_normal),o=Mt(e.rA,this.v_normal),n=Mt(e.rB,this.v_normal),r=_+u+d*i*i+p*s*s,h=_+u+d*o*o+p*n*n,a=_+u+d*i*o+p*s*n;if(r*r<1e3*(r*h-a*a)){this.v_K.ex.setNum(r,a),this.v_K.ey.setNum(a,h);const t=this.v_K.ex.x,e=this.v_K.ey.x,i=this.v_K.ex.y,s=this.v_K.ey.y;let o=t*s-e*i;0!==o&&(o=1/o),this.v_normalMass.ex.x=o*s,this.v_normalMass.ey.x=-o*e,this.v_normalMass.ex.y=-o*i,this.v_normalMass.ey.y=o*t}else this.v_pointCount=1}_t(h.c,Oi),h.a=f,_t(n.v,Yi),n.w=g,_t(a.c,Wi),a.a=v,_t(r.v,Ji),r.w=A}warmStartConstraint(t){const e=this.m_fixtureA,i=this.m_fixtureB;if(null===e||null===i)return;const s=e.m_body,o=i.m_body;if(null===s||null===o)return;const n=s.c_velocity,r=o.c_velocity;s.c_position,o.c_position;const h=this.v_invMassA,a=this.v_invIA,m=this.v_invMassB,c=this.v_invIB;_t(Yi,n.v);let l=n.w;_t(Ji,r.v);let _=r.w;_t(is,this.v_normal),wt(Xi,is,1);for(let t=0;t<this.v_pointCount;++t){const e=this.v_points[t];bt(es,e.normalImpulse,is,e.tangentImpulse,Xi),l-=a*Mt(e.rA,es),At(Yi,h,es),_+=c*Mt(e.rB,es),vt(Ji,m,es)}_t(n.v,Yi),n.w=l,_t(r.v,Ji),r.w=_}storeConstraintImpulses(t){const e=this.m_manifold;for(let t=0;t<this.v_pointCount;++t)e.points[t].normalImpulse=this.v_points[t].normalImpulse,e.points[t].tangentImpulse=this.v_points[t].tangentImpulse}solveVelocityConstraint(t){const e=this.m_fixtureA,i=this.m_fixtureB;if(null===e||null===i)return;const s=e.m_body,o=i.m_body;if(null===s||null===o)return;const n=s.c_velocity;s.c_position;const r=o.c_velocity;o.c_position;const h=this.v_invMassA,a=this.v_invIA,m=this.v_invMassB,c=this.v_invIB;_t(Yi,n.v);let l=n.w;_t(Ji,r.v);let _=r.w;_t(is,this.v_normal),wt(Xi,is,1);const u=this.v_friction;for(let t=0;t<this.v_pointCount;++t){const e=this.v_points[t];ut(os),pt(os,Ji),pt(os,Ct(us,_,e.rB)),yt(os,Yi),yt(os,Ct(us,l,e.rA));const i=Vt(os,Xi)-this.v_tangentSpeed;let s=e.tangentMass*-i;const o=u*e.normalImpulse,n=$.clamp(e.tangentImpulse+s,-o,o);s=n-e.tangentImpulse,e.tangentImpulse=n,gt(es,s,Xi),At(Yi,h,es),l-=a*Mt(e.rA,es),vt(Ji,m,es),_+=c*Mt(e.rB,es)}if(1==this.v_pointCount||0==t.blockSolve)for(let t=0;t<this.v_pointCount;++t){const e=this.v_points[t];ut(os),pt(os,Ji),pt(os,Ct(us,_,e.rB)),yt(os,Yi),yt(os,Ct(us,l,e.rA));const i=Vt(os,is);let s=-e.normalMass*(i-e.velocityBias);const o=$.max(e.normalImpulse+s,0);s=o-e.normalImpulse,e.normalImpulse=o,gt(es,s,is),At(Yi,h,es),l-=a*Mt(e.rA,es),vt(Ji,m,es),_+=c*Mt(e.rB,es)}else{const t=this.v_points[0],e=this.v_points[1];lt(as,t.normalImpulse,e.normalImpulse),ut(ns),pt(ns,Ji),pt(ns,Ct(us,_,t.rB)),yt(ns,Yi),yt(ns,Ct(us,l,t.rA)),ut(rs),pt(rs,Ji),pt(rs,Ct(us,_,e.rB)),yt(rs,Yi),yt(rs,Ct(us,l,e.rA));let i=Vt(ns,is),s=Vt(rs,is);for(lt(hs,i-t.velocityBias,s-e.velocityBias),hs.x-=this.v_K.ex.x*as.x+this.v_K.ey.x*as.y,hs.y-=this.v_K.ex.y*as.x+this.v_K.ey.y*as.y;;){if(ut(ms),ms.x=-(this.v_normalMass.ex.x*hs.x+this.v_normalMass.ey.x*hs.y),ms.y=-(this.v_normalMass.ex.y*hs.x+this.v_normalMass.ey.y*hs.y),ms.x>=0&&ms.y>=0){xt(cs,ms,as),gt(ls,cs.x,is),gt(_s,cs.y,is),At(Yi,h,ls),At(Yi,h,_s),l-=a*(Mt(t.rA,ls)+Mt(e.rA,_s)),vt(Ji,m,ls),vt(Ji,m,_s),_+=c*(Mt(t.rB,ls)+Mt(e.rB,_s)),t.normalImpulse=ms.x,e.normalImpulse=ms.y;break}if(ms.x=-t.normalMass*hs.x,ms.y=0,i=0,s=this.v_K.ex.y*ms.x+hs.y,ms.x>=0&&s>=0){xt(cs,ms,as),gt(ls,cs.x,is),gt(_s,cs.y,is),At(Yi,h,ls),At(Yi,h,_s),l-=a*(Mt(t.rA,ls)+Mt(e.rA,_s)),vt(Ji,m,ls),vt(Ji,m,_s),_+=c*(Mt(t.rB,ls)+Mt(e.rB,_s)),t.normalImpulse=ms.x,e.normalImpulse=ms.y;break}if(ms.x=0,ms.y=-e.normalMass*hs.y,i=this.v_K.ey.x*ms.y+hs.x,s=0,ms.y>=0&&i>=0){xt(cs,ms,as),gt(ls,cs.x,is),gt(_s,cs.y,is),At(Yi,h,ls),At(Yi,h,_s),l-=a*(Mt(t.rA,ls)+Mt(e.rA,_s)),vt(Ji,m,ls),vt(Ji,m,_s),_+=c*(Mt(t.rB,ls)+Mt(e.rB,_s)),t.normalImpulse=ms.x,e.normalImpulse=ms.y;break}if(ms.x=0,ms.y=0,i=hs.x,s=hs.y,i>=0&&s>=0){xt(cs,ms,as),gt(ls,cs.x,is),gt(_s,cs.y,is),At(Yi,h,ls),At(Yi,h,_s),l-=a*(Mt(t.rA,ls)+Mt(e.rA,_s)),vt(Ji,m,ls),vt(Ji,m,_s),_+=c*(Mt(t.rB,ls)+Mt(e.rB,_s)),t.normalImpulse=ms.x,e.normalImpulse=ms.y;break}break}}_t(n.v,Yi),n.w=l,_t(r.v,Ji),r.w=_}static addType(t,e,i){Ni[t]=Ni[t]||{},Ni[t][e]=i}static create(t,e,i,s){const o=t.m_shape.m_type,n=i.m_shape.m_type,r=ki.allocate();let h;if(h=Ni[o]&&Ni[o][n])r.initialize(t,e,i,s,h);else{if(!(h=Ni[n]&&Ni[n][o]))return null;r.initialize(i,s,t,e,h)}t=r.m_fixtureA,i=r.m_fixtureB,e=r.getChildIndexA(),s=r.getChildIndexB();const a=t.m_body,m=i.m_body;return r.m_nodeA.contact=r,r.m_nodeA.other=m,r.m_nodeA.prev=null,r.m_nodeA.next=a.m_contactList,null!=a.m_contactList&&(a.m_contactList.prev=r.m_nodeA),a.m_contactList=r.m_nodeA,r.m_nodeB.contact=r,r.m_nodeB.other=a,r.m_nodeB.prev=null,r.m_nodeB.next=m.m_contactList,null!=m.m_contactList&&(m.m_contactList.prev=r.m_nodeB),m.m_contactList=r.m_nodeB,0==t.isSensor()&&0==i.isSensor()&&(a.setAwake(!0),m.setAwake(!0)),r}static destroy(t,e){const i=t.m_fixtureA,s=t.m_fixtureB;if(null===i||null===s)return;const o=i.m_body,n=s.m_body;null!==o&&null!==n&&(t.isTouching()&&e.endContact(t),t.m_nodeA.prev&&(t.m_nodeA.prev.next=t.m_nodeA.next),t.m_nodeA.next&&(t.m_nodeA.next.prev=t.m_nodeA.prev),t.m_nodeA==o.m_contactList&&(o.m_contactList=t.m_nodeA.next),t.m_nodeB.prev&&(t.m_nodeB.prev.next=t.m_nodeB.next),t.m_nodeB.next&&(t.m_nodeB.next.prev=t.m_nodeB.prev),t.m_nodeB==n.m_contactList&&(n.m_contactList=t.m_nodeB.next),t.m_manifold.pointCount>0&&!i.m_isSensor&&!s.m_isSensor&&(o.setAwake(!0),n.setAwake(!0)),ki.release(t))}}const ps={gravity:tt.zero(),allowSleep:!0,warmStarting:!0,continuousPhysics:!0,subStepping:!1,blockSolve:!0,velocityIterations:8,positionIterations:3};class ys{constructor(t){this.s_step=new si,t&&tt.isValid(t)&&(t={gravity:t}),t=Q(t,ps),this.m_solver=new di(this),this.m_broadPhase=new mt,this.m_contactList=null,this.m_contactCount=0,this.m_bodyList=null,this.m_bodyCount=0,this.m_jointList=null,this.m_jointCount=0,this.m_stepComplete=!0,this.m_allowSleep=t.allowSleep,this.m_gravity=tt.clone(t.gravity),this.m_clearForces=!0,this.m_newFixture=!1,this.m_locked=!1,this.m_warmStarting=t.warmStarting,this.m_continuousPhysics=t.continuousPhysics,this.m_subStepping=t.subStepping,this.m_blockSolve=t.blockSolve,this.m_velocityIterations=t.velocityIterations,this.m_positionIterations=t.positionIterations,this.m_t=0}_serialize(){const t=[],e=[];for(let e=this.getBodyList();e;e=e.getNext())t.push(e);for(let t=this.getJointList();t;t=t.getNext())"function"==typeof t._serialize&&e.push(t);return{gravity:this.m_gravity,bodies:t,joints:e}}static _deserialize(t,e,i){if(!t)return new ys;const s=new ys(t.gravity);if(t.bodies)for(let e=t.bodies.length-1;e>=0;e-=1)s._addBody(i(ae,t.bodies[e],s));if(t.joints)for(let e=t.joints.length-1;e>=0;e--)s.createJoint(i(ce,t.joints[e],s));return s}getBodyList(){return this.m_bodyList}getJointList(){return this.m_jointList}getContactList(){return this.m_contactList}getBodyCount(){return this.m_bodyCount}getJointCount(){return this.m_jointCount}getContactCount(){return this.m_contactCount}setGravity(t){this.m_gravity=t}getGravity(){return this.m_gravity}isLocked(){return this.m_locked}setAllowSleeping(t){if(t!=this.m_allowSleep&&(this.m_allowSleep=t,0==this.m_allowSleep))for(let t=this.m_bodyList;t;t=t.m_next)t.setAwake(!0)}getAllowSleeping(){return this.m_allowSleep}setWarmStarting(t){this.m_warmStarting=t}getWarmStarting(){return this.m_warmStarting}setContinuousPhysics(t){this.m_continuousPhysics=t}getContinuousPhysics(){return this.m_continuousPhysics}setSubStepping(t){this.m_subStepping=t}getSubStepping(){return this.m_subStepping}setAutoClearForces(t){this.m_clearForces=t}getAutoClearForces(){return this.m_clearForces}clearForces(){for(let t=this.m_bodyList;t;t=t.getNext())t.m_force.setZero(),t.m_torque=0}queryAABB(t,e){const i=this.m_broadPhase;this.m_broadPhase.query(t,(function(t){const s=i.getUserData(t);return e(s.fixture)}))}rayCast(t,e,i){const s=this.m_broadPhase;this.m_broadPhase.rayCast({maxFraction:1,p1:t,p2:e},(function(t,e){const o=s.getUserData(e),n=o.fixture,r=o.childIndex,h={};if(n.rayCast(h,t,r)){const e=h.fraction,s=tt.add(tt.mulNumVec2(1-e,t.p1),tt.mulNumVec2(e,t.p2));return i(n,s,h.normal,e)}return t.maxFraction}))}getProxyCount(){return this.m_broadPhase.getProxyCount()}getTreeHeight(){return this.m_broadPhase.getTreeHeight()}getTreeBalance(){return this.m_broadPhase.getTreeBalance()}getTreeQuality(){return this.m_broadPhase.getTreeQuality()}shiftOrigin(t){if(!this.m_locked){for(let e=this.m_bodyList;e;e=e.m_next)e.m_xf.p.sub(t),e.m_sweep.c0.sub(t),e.m_sweep.c.sub(t);for(let e=this.m_jointList;e;e=e.m_next)e.shiftOrigin(t);this.m_broadPhase.shiftOrigin(t)}}_addBody(t){this.isLocked()||(t.m_prev=null,t.m_next=this.m_bodyList,this.m_bodyList&&(this.m_bodyList.m_prev=t),this.m_bodyList=t,++this.m_bodyCount)}createBody(t,e){if(this.isLocked())return null;let i={};t&&(tt.isValid(t)?i={position:t,angle:e}:"object"==typeof t&&(i=t));const s=new ae(this,i);return this._addBody(s),s}createDynamicBody(t,e){let i={};return t&&(tt.isValid(t)?i={position:t,angle:e}:"object"==typeof t&&(i=t)),i.type="dynamic",this.createBody(i)}createKinematicBody(t,e){let i={};return t&&(tt.isValid(t)?i={position:t,angle:e}:"object"==typeof t&&(i=t)),i.type="kinematic",this.createBody(i)}destroyBody(t){if(this.isLocked())return;if(t.m_destroyed)return!1;let e=t.m_jointList;for(;e;){const i=e;e=e.next,this.publish("remove-joint",i.joint),this.destroyJoint(i.joint),t.m_jointList=e}t.m_jointList=null;let i=t.m_contactList;for(;i;){const e=i;i=i.next,this.destroyContact(e.contact),t.m_contactList=i}t.m_contactList=null;let s=t.m_fixtureList;for(;s;){const e=s;s=s.m_next,this.publish("remove-fixture",e),e.destroyProxies(this.m_broadPhase),t.m_fixtureList=s}return t.m_fixtureList=null,t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_bodyList&&(this.m_bodyList=t.m_next),t.m_destroyed=!0,--this.m_bodyCount,this.publish("remove-body",t),!0}createJoint(t){if(this.isLocked())return null;if(t.m_prev=null,t.m_next=this.m_jointList,this.m_jointList&&(this.m_jointList.m_prev=t),this.m_jointList=t,++this.m_jointCount,t.m_edgeA.joint=t,t.m_edgeA.other=t.m_bodyB,t.m_edgeA.prev=null,t.m_edgeA.next=t.m_bodyA.m_jointList,t.m_bodyA.m_jointList&&(t.m_bodyA.m_jointList.prev=t.m_edgeA),t.m_bodyA.m_jointList=t.m_edgeA,t.m_edgeB.joint=t,t.m_edgeB.other=t.m_bodyA,t.m_edgeB.prev=null,t.m_edgeB.next=t.m_bodyB.m_jointList,t.m_bodyB.m_jointList&&(t.m_bodyB.m_jointList.prev=t.m_edgeB),t.m_bodyB.m_jointList=t.m_edgeB,0==t.m_collideConnected)for(let e=t.m_bodyB.getContactList();e;e=e.next)e.other==t.m_bodyA&&e.contact.flagForFiltering();return t}destroyJoint(t){if(this.isLocked())return;t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_jointList&&(this.m_jointList=t.m_next);const e=t.m_bodyA,i=t.m_bodyB;if(e.setAwake(!0),i.setAwake(!0),t.m_edgeA.prev&&(t.m_edgeA.prev.next=t.m_edgeA.next),t.m_edgeA.next&&(t.m_edgeA.next.prev=t.m_edgeA.prev),t.m_edgeA==e.m_jointList&&(e.m_jointList=t.m_edgeA.next),t.m_edgeA.prev=null,t.m_edgeA.next=null,t.m_edgeB.prev&&(t.m_edgeB.prev.next=t.m_edgeB.next),t.m_edgeB.next&&(t.m_edgeB.next.prev=t.m_edgeB.prev),t.m_edgeB==i.m_jointList&&(i.m_jointList=t.m_edgeB.next),t.m_edgeB.prev=null,t.m_edgeB.next=null,--this.m_jointCount,0==t.m_collideConnected){let t=i.getContactList();for(;t;)t.other==e&&t.contact.flagForFiltering(),t=t.next}this.publish("remove-joint",t)}step(t,e,i){if(this.publish("pre-step",t),(0|e)!==e&&(e=0),e=e||this.m_velocityIterations,i=i||this.m_positionIterations,this.m_newFixture&&(this.findNewContacts(),this.m_newFixture=!1),this.m_locked=!0,this.s_step.reset(t),this.s_step.velocityIterations=e,this.s_step.positionIterations=i,this.s_step.warmStarting=this.m_warmStarting,this.s_step.blockSolve=this.m_blockSolve,this.updateContacts(),this.m_stepComplete&&t>0){this.m_solver.solveWorld(this.s_step);for(let t=this.m_bodyList;t;t=t.getNext())0!=t.m_islandFlag&&(t.isStatic()||t.synchronizeFixtures());this.findNewContacts()}this.m_continuousPhysics&&t>0&&this.m_solver.solveWorldTOI(this.s_step),this.m_clearForces&&this.clearForces(),this.m_locked=!1,this.publish("post-step",t)}findNewContacts(){this.m_broadPhase.updatePairs(((t,e)=>this.createContact(t,e)))}createContact(t,e){const i=t.fixture,s=e.fixture,o=t.childIndex,n=e.childIndex,r=i.getBody(),h=s.getBody();if(r==h)return;let a=h.getContactList();for(;a;){if(a.other==r){const t=a.contact.getFixtureA(),e=a.contact.getFixtureB(),r=a.contact.getChildIndexA(),h=a.contact.getChildIndexB();if(t==i&&e==s&&r==o&&h==n)return;if(t==s&&e==i&&r==n&&h==o)return}a=a.next}if(0==h.shouldCollide(r))return;if(0==s.shouldCollide(i))return;const m=ds.create(i,o,s,n);null!=m&&(m.m_prev=null,null!=this.m_contactList&&(m.m_next=this.m_contactList,this.m_contactList.m_prev=m),this.m_contactList=m,++this.m_contactCount)}updateContacts(){let t,e=this.m_contactList;for(;t=e;){e=t.getNext();const i=t.getFixtureA(),s=t.getFixtureB(),o=t.getChildIndexA(),n=t.getChildIndexB(),r=i.getBody(),h=s.getBody();if(t.m_filterFlag){if(0==h.shouldCollide(r)){this.destroyContact(t);continue}if(0==s.shouldCollide(i)){this.destroyContact(t);continue}t.m_filterFlag=!1}const a=r.isAwake()&&!r.isStatic(),m=h.isAwake()&&!h.isStatic();if(0==a&&0==m)continue;const c=i.m_proxies[o].proxyId,l=s.m_proxies[n].proxyId;0!=this.m_broadPhase.testOverlap(c,l)?t.update(this):this.destroyContact(t)}}destroyContact(t){t.m_prev&&(t.m_prev.m_next=t.m_next),t.m_next&&(t.m_next.m_prev=t.m_prev),t==this.m_contactList&&(this.m_contactList=t.m_next),ds.destroy(t,this),--this.m_contactCount}on(t,e){return"string"!=typeof t||"function"!=typeof e||(this._listeners||(this._listeners={}),this._listeners[t]||(this._listeners[t]=[]),this._listeners[t].push(e)),this}off(t,e){if("string"!=typeof t||"function"!=typeof e)return this;const i=this._listeners&&this._listeners[t];if(!i||!i.length)return this;const s=i.indexOf(e);return s>=0&&i.splice(s,1),this}publish(t,e,i,s){const o=this._listeners&&this._listeners[t];if(!o||!o.length)return 0;for(let t=0;t<o.length;t++)o[t].call(this,e,i,s);return o.length}beginContact(t){this.publish("begin-contact",t)}endContact(t){this.publish("end-contact",t)}preSolve(t,e){this.publish("pre-solve",t,e)}postSolve(t,e){this.publish("post-solve",t,e)}}class xs{constructor(t,e,i){void 0===t?(this.x=0,this.y=0,this.z=0):"object"==typeof t?(this.x=t.x,this.y=t.y,this.z=t.z):(this.x=t,this.y=e,this.z=i)}_serialize(){return{x:this.x,y:this.y,z:this.z}}static _deserialize(t){const e=Object.create(xs.prototype);return e.x=t.x,e.y=t.y,e.z=t.z,e}static neo(t,e,i){const s=Object.create(xs.prototype);return s.x=t,s.y=e,s.z=i,s}static zero(){const t=Object.create(xs.prototype);return t.x=0,t.y=0,t.z=0,t}static clone(t){return xs.neo(t.x,t.y,t.z)}toString(){return JSON.stringify(this)}static isValid(t){return null!=t&&($.isFinite(t.x)&&$.isFinite(t.y)&&$.isFinite(t.z))}static assert(t){}setZero(){return this.x=0,this.y=0,this.z=0,this}set(t,e,i){return this.x=t,this.y=e,this.z=i,this}add(t){return this.x+=t.x,this.y+=t.y,this.z+=t.z,this}sub(t){return this.x-=t.x,this.y-=t.y,this.z-=t.z,this}mul(t){return this.x*=t,this.y*=t,this.z*=t,this}static areEqual(t,e){return t===e||"object"==typeof t&&null!==t&&"object"==typeof e&&null!==e&&t.x===e.x&&t.y===e.y&&t.z===e.z}static dot(t,e){return t.x*e.x+t.y*e.y+t.z*e.z}static cross(t,e){return new xs(t.y*e.z-t.z*e.y,t.z*e.x-t.x*e.z,t.x*e.y-t.y*e.x)}static add(t,e){return new xs(t.x+e.x,t.y+e.y,t.z+e.z)}static sub(t,e){return new xs(t.x-e.x,t.y-e.y,t.z-e.z)}static mul(t,e){return new xs(e*t.x,e*t.y,e*t.z)}neg(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this}static neg(t){return new xs(-t.x,-t.y,-t.z)}}const fs=ct(0,0),gs=ct(0,0);class vs extends Xt{constructor(t,e){super(),this.m_type=vs.TYPE,this.m_radius=st.polygonRadius,this.m_vertex1=t?tt.clone(t):tt.zero(),this.m_vertex2=e?tt.clone(e):tt.zero(),this.m_vertex0=tt.zero(),this.m_vertex3=tt.zero(),this.m_hasVertex0=!1,this.m_hasVertex3=!1}_serialize(){return{type:this.m_type,vertex1:this.m_vertex1,vertex2:this.m_vertex2,vertex0:this.m_vertex0,vertex3:this.m_vertex3,hasVertex0:this.m_hasVertex0,hasVertex3:this.m_hasVertex3}}static _deserialize(t){const e=new vs(t.vertex1,t.vertex2);return e.m_hasVertex0&&e.setPrevVertex(t.vertex0),e.m_hasVertex3&&e.setNextVertex(t.vertex3),e}_reset(){}getRadius(){return this.m_radius}getType(){return this.m_type}setNext(t){return this.setNextVertex(t)}setNextVertex(t){return t?(this.m_vertex3.setVec2(t),this.m_hasVertex3=!0):(this.m_vertex3.setZero(),this.m_hasVertex3=!1),this}getNextVertex(){return this.m_vertex3}setPrev(t){return this.setPrevVertex(t)}setPrevVertex(t){return t?(this.m_vertex0.setVec2(t),this.m_hasVertex0=!0):(this.m_vertex0.setZero(),this.m_hasVertex0=!1),this}getPrevVertex(){return this.m_vertex0}_set(t,e){return this.m_vertex1.setVec2(t),this.m_vertex2.setVec2(e),this.m_hasVertex0=!1,this.m_hasVertex3=!1,this}_clone(){const t=new vs;return t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_vertex1.setVec2(this.m_vertex1),t.m_vertex2.setVec2(this.m_vertex2),t.m_vertex0.setVec2(this.m_vertex0),t.m_vertex3.setVec2(this.m_vertex3),t.m_hasVertex0=this.m_hasVertex0,t.m_hasVertex3=this.m_hasVertex3,t}getChildCount(){return 1}testPoint(t,e){return!1}rayCast(t,e,i,s){const o=Rt.mulTVec2(i.q,tt.sub(e.p1,i.p)),n=Rt.mulTVec2(i.q,tt.sub(e.p2,i.p)),r=tt.sub(n,o),h=this.m_vertex1,a=this.m_vertex2,m=tt.sub(a,h),c=tt.neo(m.y,-m.x);c.normalize();const l=tt.dot(c,tt.sub(h,o)),_=tt.dot(c,r);if(0==_)return!1;const u=l/_;if(u<0||e.maxFraction<u)return!1;const d=tt.add(o,tt.mulNumVec2(u,r)),p=tt.sub(a,h),y=tt.dot(p,p);if(0==y)return!1;const x=tt.dot(tt.sub(d,h),p)/y;return!(x<0||1<x)&&(t.fraction=u,t.normal=l>0?Rt.mulVec2(i.q,c).neg():Rt.mulVec2(i.q,c),!0)}computeAABB(t,e,i){Lt(fs,e,this.m_vertex1),Lt(gs,e,this.m_vertex2),et.combinePoints(t,fs,gs),et.extend(t,this.m_radius)}computeMass(t,e){t.mass=0,bt(t.center,.5,this.m_vertex1,.5,this.m_vertex2),t.I=0}computeDistanceProxy(t){t.m_vertices[0]=this.m_vertex1,t.m_vertices[1]=this.m_vertex2,t.m_vertices.length=2,t.m_count=2,t.m_radius=this.m_radius}}vs.TYPE="edge";const As=vs,bs=ct(0,0),Bs=ct(0,0);class ws extends Xt{constructor(t,e){super(),this.m_type=ws.TYPE,this.m_radius=st.polygonRadius,this.m_vertices=[],this.m_count=0,this.m_prevVertex=null,this.m_nextVertex=null,this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.m_isLoop=!!e,t&&t.length&&(e?this._createLoop(t):this._createChain(t))}_serialize(){const t={type:this.m_type,vertices:this.m_vertices,isLoop:this.m_isLoop,hasPrevVertex:this.m_hasPrevVertex,hasNextVertex:this.m_hasNextVertex,prevVertex:null,nextVertex:null};return this.m_prevVertex&&(t.prevVertex=this.m_prevVertex),this.m_nextVertex&&(t.nextVertex=this.m_nextVertex),t}static _deserialize(t,e,i){const s=[];if(t.vertices)for(let e=0;e<t.vertices.length;e++)s.push(i(tt,t.vertices[e]));const o=new ws(s,t.isLoop);return t.prevVertex&&o.setPrevVertex(t.prevVertex),t.nextVertex&&o.setNextVertex(t.nextVertex),o}getType(){return this.m_type}getRadius(){return this.m_radius}_createLoop(t){if(!(t.length<3)){for(let e=1;e<t.length;++e)t[e-1],t[e];this.m_vertices=[],this.m_count=t.length+1;for(let e=0;e<t.length;++e)this.m_vertices[e]=tt.clone(t[e]);return this.m_vertices[t.length]=tt.clone(t[0]),this.m_prevVertex=this.m_vertices[this.m_count-2],this.m_nextVertex=this.m_vertices[1],this.m_hasPrevVertex=!0,this.m_hasNextVertex=!0,this}}_createChain(t){for(let e=1;e<t.length;++e)t[e-1],t[e];this.m_count=t.length;for(let e=0;e<t.length;++e)this.m_vertices[e]=tt.clone(t[e]);return this.m_hasPrevVertex=!1,this.m_hasNextVertex=!1,this.m_prevVertex=null,this.m_nextVertex=null,this}_reset(){this.m_isLoop?this._createLoop(this.m_vertices):this._createChain(this.m_vertices)}setPrevVertex(t){this.m_prevVertex=t,this.m_hasPrevVertex=!0}getPrevVertex(){return this.m_prevVertex}setNextVertex(t){this.m_nextVertex=t,this.m_hasNextVertex=!0}getNextVertex(){return this.m_nextVertex}_clone(){const t=new ws;return t._createChain(this.m_vertices),t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_prevVertex=this.m_prevVertex,t.m_nextVertex=this.m_nextVertex,t.m_hasPrevVertex=this.m_hasPrevVertex,t.m_hasNextVertex=this.m_hasNextVertex,t}getChildCount(){return this.m_count-1}getChildEdge(t,e){t.m_type=vs.TYPE,t.m_radius=this.m_radius,t.m_vertex1=this.m_vertices[e],t.m_vertex2=this.m_vertices[e+1],e>0?(t.m_vertex0=this.m_vertices[e-1],t.m_hasVertex0=!0):(t.m_vertex0=this.m_prevVertex,t.m_hasVertex0=this.m_hasPrevVertex),e<this.m_count-2?(t.m_vertex3=this.m_vertices[e+2],t.m_hasVertex3=!0):(t.m_vertex3=this.m_nextVertex,t.m_hasVertex3=this.m_hasNextVertex)}getVertex(t){return t<this.m_count?this.m_vertices[t]:this.m_vertices[0]}isLoop(){return this.m_isLoop}testPoint(t,e){return!1}rayCast(t,e,i,s){return new vs(this.getVertex(s),this.getVertex(s+1)).rayCast(t,e,i,0)}computeAABB(t,e,i){Lt(bs,e,this.getVertex(i)),Lt(Bs,e,this.getVertex(i+1)),et.combinePoints(t,bs,Bs)}computeMass(t,e){t.mass=0,ut(t.center),t.I=0}computeDistanceProxy(t,e){t.m_vertices[0]=this.getVertex(e),t.m_vertices[1]=this.getVertex(e+1),t.m_count=2,t.m_radius=this.m_radius}}ws.TYPE="chain";const Cs=ws,Ms=ct(0,0),Vs=ct(0,0),Is=ct(0,0),Ss=ct(0,0),Ps=ct(0,0),Ts=ct(0,0);class zs extends Xt{constructor(t){super(),this.m_type=zs.TYPE,this.m_radius=st.polygonRadius,this.m_centroid=tt.zero(),this.m_vertices=[],this.m_normals=[],this.m_count=0,t&&t.length&&this._set(t)}_serialize(){return{type:this.m_type,vertices:this.m_vertices}}static _deserialize(t,e,i){const s=[];if(t.vertices)for(let e=0;e<t.vertices.length;e++)s.push(i(tt,t.vertices[e]));return new zs(s)}getType(){return this.m_type}getRadius(){return this.m_radius}_clone(){const t=new zs;t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_count=this.m_count,t.m_centroid.setVec2(this.m_centroid);for(let e=0;e<this.m_count;e++)t.m_vertices.push(this.m_vertices[e].clone());for(let e=0;e<this.m_normals.length;e++)t.m_normals.push(this.m_normals[e].clone());return t}getChildCount(){return 1}_reset(){this._set(this.m_vertices)}_set(t){if(t.length<3)return void this._setAsBox(1,1);let e=$.min(t.length,st.maxPolygonVertices);const i=[];for(let s=0;s<e;++s){const e=t[s];let o=!0;for(let t=0;t<i.length;++t)if(tt.distanceSquared(e,i[t])<.25*st.linearSlopSquared){o=!1;break}o&&i.push(tt.clone(e))}if(e=i.length,e<3)return void this._setAsBox(1,1);let s=0,o=i[0].x;for(let t=1;t<e;++t){const e=i[t].x;(e>o||e===o&&i[t].y<i[s].y)&&(s=t,o=e)}const n=[];let r=0,h=s;for(;;){n[r]=h;let t=0;for(let s=1;s<e;++s){if(t===h){t=s;continue}const e=tt.sub(i[t],i[n[r]]),o=tt.sub(i[s],i[n[r]]),a=tt.crossVec2Vec2(e,o);a<0&&(t=s),0===a&&o.lengthSquared()>e.lengthSquared()&&(t=s)}if(++r,h=t,t===s)break}if(r<3)this._setAsBox(1,1);else{this.m_count=r,this.m_vertices=[];for(let t=0;t<r;++t)this.m_vertices[t]=i[n[t]];for(let t=0;t<r;++t){const e=t,i=t+1<r?t+1:0,s=tt.sub(this.m_vertices[i],this.m_vertices[e]);this.m_normals[t]=tt.crossVec2Num(s,1),this.m_normals[t].normalize()}this.m_centroid=function(t,e){const i=tt.zero();let s=0;const o=tt.zero(),n=1/3;for(let r=0;r<e;++r){const h=o,a=t[r],m=r+1<e?t[r+1]:t[0],c=tt.sub(a,h),l=tt.sub(m,h),_=.5*tt.crossVec2Vec2(c,l);s+=_,i.addMul(_*n,h),i.addMul(_*n,a),i.addMul(_*n,m)}return i.mul(1/s),i}(this.m_vertices,r)}}_setAsBox(t,e,i,s){if(this.m_vertices[0]=tt.neo(t,-e),this.m_vertices[1]=tt.neo(t,e),this.m_vertices[2]=tt.neo(-t,e),this.m_vertices[3]=tt.neo(-t,-e),this.m_normals[0]=tt.neo(1,0),this.m_normals[1]=tt.neo(0,1),this.m_normals[2]=tt.neo(-1,0),this.m_normals[3]=tt.neo(0,-1),this.m_count=4,i&&tt.isValid(i)){s=s||0,_t(this.m_centroid,i);const t=Ot.identity();t.p.setVec2(i),t.q.setAngle(s);for(let e=0;e<this.m_count;++e)this.m_vertices[e]=Ot.mulVec2(t,this.m_vertices[e]),this.m_normals[e]=Rt.mulVec2(t.q,this.m_normals[e])}}testPoint(t,e){const i=qt(Ms,t,e);for(let t=0;t<this.m_count;++t){if(Vt(this.m_normals[t],i)-Vt(this.m_normals[t],this.m_vertices[t])>0)return!1}return!0}rayCast(t,e,i,s){const o=Rt.mulTVec2(i.q,tt.sub(e.p1,i.p)),n=Rt.mulTVec2(i.q,tt.sub(e.p2,i.p)),r=tt.sub(n,o);let h=0,a=e.maxFraction,m=-1;for(let t=0;t<this.m_count;++t){const e=tt.dot(this.m_normals[t],tt.sub(this.m_vertices[t],o)),i=tt.dot(this.m_normals[t],r);if(0==i){if(e<0)return!1}else i<0&&e<h*i?(h=e/i,m=t):i>0&&e<a*i&&(a=e/i);if(a<h)return!1}return m>=0&&(t.fraction=h,t.normal=Rt.mulVec2(i.q,this.m_normals[m]),!0)}computeAABB(t,e,i){let s=1/0,o=1/0,n=-1/0,r=-1/0;for(let t=0;t<this.m_count;++t){const i=Lt(Ms,e,this.m_vertices[t]);s=$.min(s,i.x),n=$.max(n,i.x),o=$.min(o,i.y),r=$.max(r,i.y)}lt(t.lowerBound,s-this.m_radius,o-this.m_radius),lt(t.upperBound,n+this.m_radius,r+this.m_radius)}computeMass(t,e){ut(Ps);let i=0,s=0;ut(Ts);for(let t=0;t<this.m_count;++t)pt(Ts,this.m_vertices[t]);gt(Ts,1/this.m_count,Ts);const o=1/3;for(let t=0;t<this.m_count;++t){xt(Is,this.m_vertices[t],Ts),t+1<this.m_count?xt(Ss,this.m_vertices[t+1],Ts):xt(Ss,this.m_vertices[0],Ts);const e=Mt(Is,Ss),n=.5*e;i+=n,bt(Ps,1,Ps,n*o,Is),bt(Ps,1,Ps,n*o,Ss);const r=Is.x,h=Is.y,a=Ss.x,m=Ss.y;s+=.25*o*e*(r*r+a*r+a*a+(h*h+m*h+m*m))}t.mass=e*i,gt(Ps,1/i,Ps),function(t,e,i){t.x=e.x+i.x,t.y=e.x+i.y}(t.center,Ps,Ts),t.I=e*s,t.I+=t.mass*(Vt(t.center,t.center)-Vt(Ps,Ps))}validate(){for(let t=0;t<this.m_count;++t){const e=t,i=t<this.m_count-1?e+1:0,s=this.m_vertices[e];xt(Vs,this.m_vertices[i],s);for(let t=0;t<this.m_count;++t){if(t==e||t==i)continue;if(Mt(Vs,xt(Ms,this.m_vertices[t],s))<0)return!1}}return!0}computeDistanceProxy(t){for(let e=0;e<this.m_count;++e)t.m_vertices[e]=this.m_vertices[e];t.m_vertices.length=this.m_count,t.m_count=this.m_count,t.m_radius=this.m_radius}}zs.TYPE="polygon";const Fs=zs;class ks extends zs{constructor(t,e,i,s){super(),this._setAsBox(t,e,i,s)}}ks.TYPE="polygon";const Ls=ks,qs=ct(0,0);class Ds extends Xt{constructor(t,e){super(),this.m_type=Ds.TYPE,this.m_p=tt.zero(),this.m_radius=1,"object"==typeof t&&tt.isValid(t)?(this.m_p.setVec2(t),"number"==typeof e&&(this.m_radius=e)):"number"==typeof t&&(this.m_radius=t)}_serialize(){return{type:this.m_type,p:this.m_p,radius:this.m_radius}}static _deserialize(t){return new Ds(t.p,t.radius)}_reset(){}getType(){return this.m_type}getRadius(){return this.m_radius}getCenter(){return this.m_p}_clone(){const t=new Ds;return t.m_type=this.m_type,t.m_radius=this.m_radius,t.m_p=this.m_p.clone(),t}getChildCount(){return 1}testPoint(t,e){return Pt(e,Lt(qs,t,this.m_p))<=this.m_radius*this.m_radius}rayCast(t,e,i,s){const o=tt.add(i.p,Rt.mulVec2(i.q,this.m_p)),n=tt.sub(e.p1,o),r=tt.dot(n,n)-this.m_radius*this.m_radius,h=tt.sub(e.p2,e.p1),a=tt.dot(n,h),m=tt.dot(h,h),c=a*a-m*r;if(c<0||m<$.EPSILON)return!1;let l=-(a+$.sqrt(c));return 0<=l&&l<=e.maxFraction*m&&(l/=m,t.fraction=l,t.normal=tt.add(n,tt.mulNumVec2(l,h)),t.normal.normalize(),!0)}computeAABB(t,e,i){const s=Lt(qs,e,this.m_p);lt(t.lowerBound,s.x-this.m_radius,s.y-this.m_radius),lt(t.upperBound,s.x+this.m_radius,s.y+this.m_radius)}computeMass(t,e){t.mass=e*$.PI*this.m_radius*this.m_radius,_t(t.center,this.m_p),t.I=t.mass*(.5*this.m_radius*this.m_radius+It(this.m_p))}computeDistanceProxy(t){t.m_vertices[0]=this.m_p,t.m_vertices.length=1,t.m_count=1,t.m_radius=this.m_radius}}Ds.TYPE="circle";const js=Ds,Rs={frequencyHz:0,dampingRatio:0};class Ns extends ce{constructor(t,e,i,s,o){if(i&&s&&"m_type"in s&&"x"in i&&"y"in i){const t=i;i=s,s=t}super(t=Q(t,Rs),e,i),e=this.m_bodyA,i=this.m_bodyB,this.m_type=Ns.TYPE,this.m_localAnchorA=tt.clone(s?e.getLocalPoint(s):t.localAnchorA||tt.zero()),this.m_localAnchorB=tt.clone(o?i.getLocalPoint(o):t.localAnchorB||tt.zero()),this.m_length=$.isFinite(t.length)?t.length:tt.distance(e.getWorldPoint(this.m_localAnchorA),i.getWorldPoint(this.m_localAnchorB)),this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_impulse=0,this.m_gamma=0,this.m_bias=0}_serialize(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,length:this.m_length,impulse:this.m_impulse,gamma:this.m_gamma,bias:this.m_bias}}static _deserialize(t,e,i){(t=Object.assign({},t)).bodyA=i(ae,t.bodyA,e),t.bodyB=i(ae,t.bodyB,e);return new Ns(t)}_setAnchors(t){t.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.setVec2(t.localAnchorA),t.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.setVec2(t.localAnchorB),t.length>0?this.m_length=+t.length:t.length<0||(t.anchorA||t.anchorA||t.anchorA||t.anchorA)&&(this.m_length=tt.distance(this.m_bodyA.getWorldPoint(this.m_localAnchorA),this.m_bodyB.getWorldPoint(this.m_localAnchorB)))}getLocalAnchorA(){return this.m_localAnchorA}getLocalAnchorB(){return this.m_localAnchorB}setLength(t){this.m_length=t}getLength(){return this.m_length}setFrequency(t){this.m_frequencyHz=t}getFrequency(){return this.m_frequencyHz}setDampingRatio(t){this.m_dampingRatio=t}getDampingRatio(){return this.m_dampingRatio}getAnchorA(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)}getAnchorB(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)}getReactionForce(t){return tt.mulNumVec2(this.m_impulse,this.m_u).mul(t)}getReactionTorque(t){return 0}initVelocityConstraints(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyA.c_velocity.v;let o=this.m_bodyA.c_velocity.w;const n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,h=this.m_bodyB.c_velocity.v;let a=this.m_bodyB.c_velocity.w;const m=Rt.neo(i),c=Rt.neo(r);this.m_rA=Rt.mulVec2(m,tt.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=Rt.mulVec2(c,tt.sub(this.m_localAnchorB,this.m_localCenterB)),this.m_u=tt.sub(tt.add(n,this.m_rB),tt.add(e,this.m_rA));const l=this.m_u.length();l>st.linearSlop?this.m_u.mul(1/l):this.m_u.setNum(0,0);const _=tt.crossVec2Vec2(this.m_rA,this.m_u),u=tt.crossVec2Vec2(this.m_rB,this.m_u);let d=this.m_invMassA+this.m_invIA*_*_+this.m_invMassB+this.m_invIB*u*u;if(this.m_mass=0!=d?1/d:0,this.m_frequencyHz>0){const e=l-this.m_length,i=2*$.PI*this.m_frequencyHz,s=2*this.m_mass*this.m_dampingRatio*i,o=this.m_mass*i*i,n=t.dt;this.m_gamma=n*(s+n*o),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=e*n*o*this.m_gamma,d+=this.m_gamma,this.m_mass=0!=d?1/d:0}else this.m_gamma=0,this.m_bias=0;if(t.warmStarting){this.m_impulse*=t.dtRatio;const e=tt.mulNumVec2(this.m_impulse,this.m_u);s.subMul(this.m_invMassA,e),o-=this.m_invIA*tt.crossVec2Vec2(this.m_rA,e),h.addMul(this.m_invMassB,e),a+=this.m_invIB*tt.crossVec2Vec2(this.m_rB,e)}else this.m_impulse=0;this.m_bodyA.c_velocity.v.setVec2(s),this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v.setVec2(h),this.m_bodyB.c_velocity.w=a}solveVelocityConstraints(t){const e=this.m_bodyA.c_velocity.v;let i=this.m_bodyA.c_velocity.w;const s=this.m_bodyB.c_velocity.v;let o=this.m_bodyB.c_velocity.w;const n=tt.add(e,tt.crossNumVec2(i,this.m_rA)),r=tt.add(s,tt.crossNumVec2(o,this.m_rB)),h=tt.dot(this.m_u,r)-tt.dot(this.m_u,n),a=-this.m_mass*(h+this.m_bias+this.m_gamma*this.m_impulse);this.m_impulse+=a;const m=tt.mulNumVec2(a,this.m_u);e.subMul(this.m_invMassA,m),i-=this.m_invIA*tt.crossVec2Vec2(this.m_rA,m),s.addMul(this.m_invMassB,m),o+=this.m_invIB*tt.crossVec2Vec2(this.m_rB,m),this.m_bodyA.c_velocity.v.setVec2(e),this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v.setVec2(s),this.m_bodyB.c_velocity.w=o}solvePositionConstraints(t){if(this.m_frequencyHz>0)return!0;const e=this.m_bodyA.c_position.c;let i=this.m_bodyA.c_position.a;const s=this.m_bodyB.c_position.c;let o=this.m_bodyB.c_position.a;const n=Rt.neo(i),r=Rt.neo(o),h=Rt.mulSub(n,this.m_localAnchorA,this.m_localCenterA),a=Rt.mulSub(r,this.m_localAnchorB,this.m_localCenterB),m=tt.sub(tt.add(s,a),tt.add(e,h));let c=m.normalize()-this.m_length;c=$.clamp(c,-st.maxLinearCorrection,st.maxLinearCorrection);const l=-this.m_mass*c,_=tt.mulNumVec2(l,m);return e.subMul(this.m_invMassA,_),i-=this.m_invIA*tt.crossVec2Vec2(h,_),s.addMul(this.m_invMassB,_),o+=this.m_invIB*tt.crossVec2Vec2(a,_),this.m_bodyA.c_position.c.setVec2(e),this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c.setVec2(s),this.m_bodyB.c_position.a=o,$.abs(c)<st.linearSlop}}Ns.TYPE="distance-joint";const Es={maxForce:0,maxTorque:0};class Os extends ce{constructor(t,e,i,s){super(t=Q(t,Es),e,i),e=this.m_bodyA,i=this.m_bodyB,this.m_type=Os.TYPE,this.m_localAnchorA=tt.clone(s?e.getLocalPoint(s):t.localAnchorA||tt.zero()),this.m_localAnchorB=tt.clone(s?i.getLocalPoint(s):t.localAnchorB||tt.zero()),this.m_linearImpulse=tt.zero(),this.m_angularImpulse=0,this.m_maxForce=t.maxForce,this.m_maxTorque=t.maxTorque}_serialize(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,maxForce:this.m_maxForce,maxTorque:this.m_maxTorque,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB}}static _deserialize(t,e,i){(t=Object.assign({},t)).bodyA=i(ae,t.bodyA,e),t.bodyB=i(ae,t.bodyB,e);return new Os(t)}_setAnchors(t){t.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.setVec2(t.localAnchorA),t.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.setVec2(t.localAnchorB)}getLocalAnchorA(){return this.m_localAnchorA}getLocalAnchorB(){return this.m_localAnchorB}setMaxForce(t){this.m_maxForce=t}getMaxForce(){return this.m_maxForce}setMaxTorque(t){this.m_maxTorque=t}getMaxTorque(){return this.m_maxTorque}getAnchorA(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)}getAnchorB(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)}getReactionForce(t){return tt.mulNumVec2(t,this.m_linearImpulse)}getReactionTorque(t){return t*this.m_angularImpulse}initVelocityConstraints(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=this.m_bodyA.c_position.a,i=this.m_bodyA.c_velocity.v;let s=this.m_bodyA.c_velocity.w;const o=this.m_bodyB.c_position.a,n=this.m_bodyB.c_velocity.v;let r=this.m_bodyB.c_velocity.w;const h=Rt.neo(e),a=Rt.neo(o);this.m_rA=Rt.mulVec2(h,tt.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=Rt.mulVec2(a,tt.sub(this.m_localAnchorB,this.m_localCenterB));const m=this.m_invMassA,c=this.m_invMassB,l=this.m_invIA,_=this.m_invIB,u=new pi;if(u.ex.x=m+c+l*this.m_rA.y*this.m_rA.y+_*this.m_rB.y*this.m_rB.y,u.ex.y=-l*this.m_rA.x*this.m_rA.y-_*this.m_rB.x*this.m_rB.y,u.ey.x=u.ex.y,u.ey.y=m+c+l*this.m_rA.x*this.m_rA.x+_*this.m_rB.x*this.m_rB.x,this.m_linearMass=u.getInverse(),this.m_angularMass=l+_,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),t.warmStarting){this.m_linearImpulse.mul(t.dtRatio),this.m_angularImpulse*=t.dtRatio;const e=tt.neo(this.m_linearImpulse.x,this.m_linearImpulse.y);i.subMul(m,e),s-=l*(tt.crossVec2Vec2(this.m_rA,e)+this.m_angularImpulse),n.addMul(c,e),r+=_*(tt.crossVec2Vec2(this.m_rB,e)+this.m_angularImpulse)}else this.m_linearImpulse.setZero(),this.m_angularImpulse=0;this.m_bodyA.c_velocity.v=i,this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=r}solveVelocityConstraints(t){const e=this.m_bodyA.c_velocity.v;let i=this.m_bodyA.c_velocity.w;const s=this.m_bodyB.c_velocity.v;let o=this.m_bodyB.c_velocity.w;const n=this.m_invMassA,r=this.m_invMassB,h=this.m_invIA,a=this.m_invIB,m=t.dt;{const t=o-i;let e=-this.m_angularMass*t;const s=this.m_angularImpulse,n=m*this.m_maxTorque;this.m_angularImpulse=$.clamp(this.m_angularImpulse+e,-n,n),e=this.m_angularImpulse-s,i-=h*e,o+=a*e}{const t=tt.sub(tt.add(s,tt.crossNumVec2(o,this.m_rB)),tt.add(e,tt.crossNumVec2(i,this.m_rA)));let c=tt.neg(pi.mulVec2(this.m_linearMass,t));const l=this.m_linearImpulse;this.m_linearImpulse.add(c);const _=m*this.m_maxForce;this.m_linearImpulse.lengthSquared()>_*_&&(this.m_linearImpulse.normalize(),this.m_linearImpulse.mul(_)),c=tt.sub(this.m_linearImpulse,l),e.subMul(n,c),i-=h*tt.crossVec2Vec2(this.m_rA,c),s.addMul(r,c),o+=a*tt.crossVec2Vec2(this.m_rB,c)}this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=s,this.m_bodyB.c_velocity.w=o}solvePositionConstraints(t){return!0}}Os.TYPE="friction-joint";class Ys{constructor(t,e,i){"object"==typeof t&&null!==t?(this.ex=xs.clone(t),this.ey=xs.clone(e),this.ez=xs.clone(i)):(this.ex=xs.zero(),this.ey=xs.zero(),this.ez=xs.zero())}toString(){return JSON.stringify(this)}static isValid(t){return null!=t&&(xs.isValid(t.ex)&&xs.isValid(t.ey)&&xs.isValid(t.ez))}static assert(t){}setZero(){return this.ex.setZero(),this.ey.setZero(),this.ez.setZero(),this}solve33(t){let e=this.ey.y*this.ez.z-this.ey.z*this.ez.y,i=this.ey.z*this.ez.x-this.ey.x*this.ez.z,s=this.ey.x*this.ez.y-this.ey.y*this.ez.x,o=this.ex.x*e+this.ex.y*i+this.ex.z*s;0!==o&&(o=1/o);const n=new xs;return e=this.ey.y*this.ez.z-this.ey.z*this.ez.y,i=this.ey.z*this.ez.x-this.ey.x*this.ez.z,s=this.ey.x*this.ez.y-this.ey.y*this.ez.x,n.x=o*(t.x*e+t.y*i+t.z*s),e=t.y*this.ez.z-t.z*this.ez.y,i=t.z*this.ez.x-t.x*this.ez.z,s=t.x*this.ez.y-t.y*this.ez.x,n.y=o*(this.ex.x*e+this.ex.y*i+this.ex.z*s),e=this.ey.y*t.z-this.ey.z*t.y,i=this.ey.z*t.x-this.ey.x*t.z,s=this.ey.x*t.y-this.ey.y*t.x,n.z=o*(this.ex.x*e+this.ex.y*i+this.ex.z*s),n}solve22(t){const e=this.ex.x,i=this.ey.x,s=this.ex.y,o=this.ey.y;let n=e*o-i*s;0!==n&&(n=1/n);const r=tt.zero();return r.x=n*(o*t.x-i*t.y),r.y=n*(e*t.y-s*t.x),r}getInverse22(t){const e=this.ex.x,i=this.ey.x,s=this.ex.y,o=this.ey.y;let n=e*o-i*s;0!==n&&(n=1/n),t.ex.x=n*o,t.ey.x=-n*i,t.ex.z=0,t.ex.y=-n*s,t.ey.y=n*e,t.ey.z=0,t.ez.x=0,t.ez.y=0,t.ez.z=0}getSymInverse33(t){let e=xs.dot(this.ex,xs.cross(this.ey,this.ez));0!==e&&(e=1/e);const i=this.ex.x,s=this.ey.x,o=this.ez.x,n=this.ey.y,r=this.ez.y,h=this.ez.z;t.ex.x=e*(n*h-r*r),t.ex.y=e*(o*r-s*h),t.ex.z=e*(s*r-o*n),t.ey.x=t.ex.y,t.ey.y=e*(i*h-o*o),t.ey.z=e*(o*s-i*r),t.ez.x=t.ex.z,t.ez.y=t.ey.z,t.ez.z=e*(i*n-s*s)}static mul(t,e){if(e&&"z"in e&&"y"in e&&"x"in e){const i=t.ex.x*e.x+t.ey.x*e.y+t.ez.x*e.z,s=t.ex.y*e.x+t.ey.y*e.y+t.ez.y*e.z,o=t.ex.z*e.x+t.ey.z*e.y+t.ez.z*e.z;return new xs(i,s,o)}if(e&&"y"in e&&"x"in e){const i=t.ex.x*e.x+t.ey.x*e.y,s=t.ex.y*e.x+t.ey.y*e.y;return tt.neo(i,s)}}static mulVec3(t,e){const i=t.ex.x*e.x+t.ey.x*e.y+t.ez.x*e.z,s=t.ex.y*e.x+t.ey.y*e.y+t.ez.y*e.z,o=t.ex.z*e.x+t.ey.z*e.y+t.ez.z*e.z;return new xs(i,s,o)}static mulVec2(t,e){const i=t.ex.x*e.x+t.ey.x*e.y,s=t.ex.y*e.x+t.ey.y*e.y;return tt.neo(i,s)}static add(t,e){return new Ys(xs.add(t.ex,e.ex),xs.add(t.ey,e.ey),xs.add(t.ez,e.ez))}}const Ws={lowerAngle:0,upperAngle:0,maxMotorTorque:0,motorSpeed:0,enableLimit:!1,enableMotor:!1};class Js extends ce{constructor(t,e,i,s){super(t=Q(t,Ws),e,i),this.m_mass=new Ys,this.m_limitState=0,e=this.m_bodyA,i=this.m_bodyB,this.m_type=Js.TYPE,this.m_localAnchorA=tt.clone(s?e.getLocalPoint(s):t.localAnchorA||tt.zero()),this.m_localAnchorB=tt.clone(s?i.getLocalPoint(s):t.localAnchorB||tt.zero()),this.m_referenceAngle=$.isFinite(t.referenceAngle)?t.referenceAngle:i.getAngle()-e.getAngle(),this.m_impulse=new xs,this.m_motorImpulse=0,this.m_lowerAngle=t.lowerAngle,this.m_upperAngle=t.upperAngle,this.m_maxMotorTorque=t.maxMotorTorque,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor}_serialize(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,lowerAngle:this.m_lowerAngle,upperAngle:this.m_upperAngle,maxMotorTorque:this.m_maxMotorTorque,motorSpeed:this.m_motorSpeed,enableLimit:this.m_enableLimit,enableMotor:this.m_enableMotor,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,referenceAngle:this.m_referenceAngle}}static _deserialize(t,e,i){(t=Object.assign({},t)).bodyA=i(ae,t.bodyA,e),t.bodyB=i(ae,t.bodyB,e);return new Js(t)}_setAnchors(t){t.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.setVec2(t.localAnchorA),t.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.setVec2(t.localAnchorB)}getLocalAnchorA(){return this.m_localAnchorA}getLocalAnchorB(){return this.m_localAnchorB}getReferenceAngle(){return this.m_referenceAngle}getJointAngle(){const t=this.m_bodyA;return this.m_bodyB.m_sweep.a-t.m_sweep.a-this.m_referenceAngle}getJointSpeed(){const t=this.m_bodyA;return this.m_bodyB.m_angularVelocity-t.m_angularVelocity}isMotorEnabled(){return this.m_enableMotor}enableMotor(t){t!=this.m_enableMotor&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=t)}getMotorTorque(t){return t*this.m_motorImpulse}setMotorSpeed(t){t!=this.m_motorSpeed&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=t)}getMotorSpeed(){return this.m_motorSpeed}setMaxMotorTorque(t){t!=this.m_maxMotorTorque&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorTorque=t)}getMaxMotorTorque(){return this.m_maxMotorTorque}isLimitEnabled(){return this.m_enableLimit}enableLimit(t){t!=this.m_enableLimit&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)}getLowerLimit(){return this.m_lowerAngle}getUpperLimit(){return this.m_upperAngle}setLimits(t,e){t==this.m_lowerAngle&&e==this.m_upperAngle||(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_impulse.z=0,this.m_lowerAngle=t,this.m_upperAngle=e)}getAnchorA(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)}getAnchorB(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)}getReactionForce(t){return tt.neo(this.m_impulse.x,this.m_impulse.y).mul(t)}getReactionTorque(t){return t*this.m_impulse.z}initVelocityConstraints(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=this.m_bodyA.c_position.a,i=this.m_bodyA.c_velocity.v;let s=this.m_bodyA.c_velocity.w;const o=this.m_bodyB.c_position.a,n=this.m_bodyB.c_velocity.v;let r=this.m_bodyB.c_velocity.w;const h=Rt.neo(e),a=Rt.neo(o);this.m_rA=Rt.mulVec2(h,tt.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=Rt.mulVec2(a,tt.sub(this.m_localAnchorB,this.m_localCenterB));const m=this.m_invMassA,c=this.m_invMassB,l=this.m_invIA,_=this.m_invIB,u=l+_===0;if(this.m_mass.ex.x=m+c+this.m_rA.y*this.m_rA.y*l+this.m_rB.y*this.m_rB.y*_,this.m_mass.ey.x=-this.m_rA.y*this.m_rA.x*l-this.m_rB.y*this.m_rB.x*_,this.m_mass.ez.x=-this.m_rA.y*l-this.m_rB.y*_,this.m_mass.ex.y=this.m_mass.ey.x,this.m_mass.ey.y=m+c+this.m_rA.x*this.m_rA.x*l+this.m_rB.x*this.m_rB.x*_,this.m_mass.ez.y=this.m_rA.x*l+this.m_rB.x*_,this.m_mass.ex.z=this.m_mass.ez.x,this.m_mass.ey.z=this.m_mass.ez.y,this.m_mass.ez.z=l+_,this.m_motorMass=l+_,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass),(0==this.m_enableMotor||u)&&(this.m_motorImpulse=0),this.m_enableLimit&&0==u){const t=o-e-this.m_referenceAngle;$.abs(this.m_upperAngle-this.m_lowerAngle)<2*st.angularSlop?this.m_limitState=3:t<=this.m_lowerAngle?(1!=this.m_limitState&&(this.m_impulse.z=0),this.m_limitState=1):t>=this.m_upperAngle?(2!=this.m_limitState&&(this.m_impulse.z=0),this.m_limitState=2):(this.m_limitState=0,this.m_impulse.z=0)}else this.m_limitState=0;if(t.warmStarting){this.m_impulse.mul(t.dtRatio),this.m_motorImpulse*=t.dtRatio;const e=tt.neo(this.m_impulse.x,this.m_impulse.y);i.subMul(m,e),s-=l*(tt.crossVec2Vec2(this.m_rA,e)+this.m_motorImpulse+this.m_impulse.z),n.addMul(c,e),r+=_*(tt.crossVec2Vec2(this.m_rB,e)+this.m_motorImpulse+this.m_impulse.z)}else this.m_impulse.setZero(),this.m_motorImpulse=0;this.m_bodyA.c_velocity.v=i,this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=r}solveVelocityConstraints(t){const e=this.m_bodyA.c_velocity.v;let i=this.m_bodyA.c_velocity.w;const s=this.m_bodyB.c_velocity.v;let o=this.m_bodyB.c_velocity.w;const n=this.m_invMassA,r=this.m_invMassB,h=this.m_invIA,a=this.m_invIB,m=h+a===0;if(this.m_enableMotor&&3!=this.m_limitState&&0==m){const e=o-i-this.m_motorSpeed;let s=-this.m_motorMass*e;const n=this.m_motorImpulse,r=t.dt*this.m_maxMotorTorque;this.m_motorImpulse=$.clamp(this.m_motorImpulse+s,-r,r),s=this.m_motorImpulse-n,i-=h*s,o+=a*s}if(this.m_enableLimit&&0!=this.m_limitState&&0==m){const t=tt.zero();t.addCombine(1,s,1,tt.crossNumVec2(o,this.m_rB)),t.subCombine(1,e,1,tt.crossNumVec2(i,this.m_rA));const m=o-i,c=new xs(t.x,t.y,m),l=xs.neg(this.m_mass.solve33(c));if(3==this.m_limitState)this.m_impulse.add(l);else if(1==this.m_limitState){if(this.m_impulse.z+l.z<0){const e=tt.combine(-1,t,this.m_impulse.z,tt.neo(this.m_mass.ez.x,this.m_mass.ez.y)),i=this.m_mass.solve22(e);l.x=i.x,l.y=i.y,l.z=-this.m_impulse.z,this.m_impulse.x+=i.x,this.m_impulse.y+=i.y,this.m_impulse.z=0}else this.m_impulse.add(l)}else if(2==this.m_limitState){if(this.m_impulse.z+l.z>0){const e=tt.combine(-1,t,this.m_impulse.z,tt.neo(this.m_mass.ez.x,this.m_mass.ez.y)),i=this.m_mass.solve22(e);l.x=i.x,l.y=i.y,l.z=-this.m_impulse.z,this.m_impulse.x+=i.x,this.m_impulse.y+=i.y,this.m_impulse.z=0}else this.m_impulse.add(l)}const _=tt.neo(l.x,l.y);e.subMul(n,_),i-=h*(tt.crossVec2Vec2(this.m_rA,_)+l.z),s.addMul(r,_),o+=a*(tt.crossVec2Vec2(this.m_rB,_)+l.z)}else{const t=tt.zero();t.addCombine(1,s,1,tt.crossNumVec2(o,this.m_rB)),t.subCombine(1,e,1,tt.crossNumVec2(i,this.m_rA));const m=this.m_mass.solve22(tt.neg(t));this.m_impulse.x+=m.x,this.m_impulse.y+=m.y,e.subMul(n,m),i-=h*tt.crossVec2Vec2(this.m_rA,m),s.addMul(r,m),o+=a*tt.crossVec2Vec2(this.m_rB,m)}this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=s,this.m_bodyB.c_velocity.w=o}solvePositionConstraints(t){const e=this.m_bodyA.c_position.c;let i=this.m_bodyA.c_position.a;const s=this.m_bodyB.c_position.c;let o=this.m_bodyB.c_position.a;const n=Rt.neo(i),r=Rt.neo(o);let h=0,a=0;const m=this.m_invIA+this.m_invIB==0;if(this.m_enableLimit&&0!=this.m_limitState&&0==m){const t=o-i-this.m_referenceAngle;let e=0;if(3==this.m_limitState){const i=$.clamp(t-this.m_lowerAngle,-st.maxAngularCorrection,st.maxAngularCorrection);e=-this.m_motorMass*i,h=$.abs(i)}else if(1==this.m_limitState){let i=t-this.m_lowerAngle;h=-i,i=$.clamp(i+st.angularSlop,-st.maxAngularCorrection,0),e=-this.m_motorMass*i}else if(2==this.m_limitState){let i=t-this.m_upperAngle;h=i,i=$.clamp(i-st.angularSlop,0,st.maxAngularCorrection),e=-this.m_motorMass*i}i-=this.m_invIA*e,o+=this.m_invIB*e}{n.setAngle(i),r.setAngle(o);const t=Rt.mulVec2(n,tt.sub(this.m_localAnchorA,this.m_localCenterA)),h=Rt.mulVec2(r,tt.sub(this.m_localAnchorB,this.m_localCenterB)),m=tt.zero();m.addCombine(1,s,1,h),m.subCombine(1,e,1,t),a=m.length();const c=this.m_invMassA,l=this.m_invMassB,_=this.m_invIA,u=this.m_invIB,d=new pi;d.ex.x=c+l+_*t.y*t.y+u*h.y*h.y,d.ex.y=-_*t.x*t.y-u*h.x*h.y,d.ey.x=d.ex.y,d.ey.y=c+l+_*t.x*t.x+u*h.x*h.x;const p=tt.neg(d.solve(m));e.subMul(c,p),i-=_*tt.crossVec2Vec2(t,p),s.addMul(l,p),o+=u*tt.crossVec2Vec2(h,p)}return this.m_bodyA.c_position.c.setVec2(e),this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c.setVec2(s),this.m_bodyB.c_position.a=o,a<=st.linearSlop&&h<=st.angularSlop}}Js.TYPE="revolute-joint";const Xs={enableLimit:!1,lowerTranslation:0,upperTranslation:0,enableMotor:!1,maxMotorForce:0,motorSpeed:0};class Hs extends ce{constructor(t,e,i,s,o){super(t=Q(t,Xs),e,i),e=this.m_bodyA,i=this.m_bodyB,this.m_type=Hs.TYPE,this.m_localAnchorA=tt.clone(s?e.getLocalPoint(s):t.localAnchorA||tt.zero()),this.m_localAnchorB=tt.clone(s?i.getLocalPoint(s):t.localAnchorB||tt.zero()),this.m_localXAxisA=tt.clone(o?e.getLocalVector(o):t.localAxisA||tt.neo(1,0)),this.m_localXAxisA.normalize(),this.m_localYAxisA=tt.crossNumVec2(1,this.m_localXAxisA),this.m_referenceAngle=$.isFinite(t.referenceAngle)?t.referenceAngle:i.getAngle()-e.getAngle(),this.m_impulse=new xs,this.m_motorMass=0,this.m_motorImpulse=0,this.m_lowerTranslation=t.lowerTranslation,this.m_upperTranslation=t.upperTranslation,this.m_maxMotorForce=t.maxMotorForce,this.m_motorSpeed=t.motorSpeed,this.m_enableLimit=t.enableLimit,this.m_enableMotor=t.enableMotor,this.m_limitState=0,this.m_axis=tt.zero(),this.m_perp=tt.zero(),this.m_K=new Ys}_serialize(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,lowerTranslation:this.m_lowerTranslation,upperTranslation:this.m_upperTranslation,maxMotorForce:this.m_maxMotorForce,motorSpeed:this.m_motorSpeed,enableLimit:this.m_enableLimit,enableMotor:this.m_enableMotor,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,localAxisA:this.m_localXAxisA,referenceAngle:this.m_referenceAngle}}static _deserialize(t,e,i){(t=Object.assign({},t)).bodyA=i(ae,t.bodyA,e),t.bodyB=i(ae,t.bodyB,e),t.localAxisA=tt.clone(t.localAxisA);return new Hs(t)}_setAnchors(t){t.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.setVec2(t.localAnchorA),t.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.setVec2(t.localAnchorB),t.localAxisA&&(this.m_localXAxisA.setVec2(t.localAxisA),this.m_localYAxisA.setVec2(tt.crossNumVec2(1,t.localAxisA)))}getLocalAnchorA(){return this.m_localAnchorA}getLocalAnchorB(){return this.m_localAnchorB}getLocalAxisA(){return this.m_localXAxisA}getReferenceAngle(){return this.m_referenceAngle}getJointTranslation(){const t=this.m_bodyA.getWorldPoint(this.m_localAnchorA),e=this.m_bodyB.getWorldPoint(this.m_localAnchorB),i=tt.sub(e,t),s=this.m_bodyA.getWorldVector(this.m_localXAxisA);return tt.dot(i,s)}getJointSpeed(){const t=this.m_bodyA,e=this.m_bodyB,i=Rt.mulVec2(t.m_xf.q,tt.sub(this.m_localAnchorA,t.m_sweep.localCenter)),s=Rt.mulVec2(e.m_xf.q,tt.sub(this.m_localAnchorB,e.m_sweep.localCenter)),o=tt.add(t.m_sweep.c,i),n=tt.add(e.m_sweep.c,s),r=tt.sub(n,o),h=Rt.mulVec2(t.m_xf.q,this.m_localXAxisA),a=t.m_linearVelocity,m=e.m_linearVelocity,c=t.m_angularVelocity,l=e.m_angularVelocity;return tt.dot(r,tt.crossNumVec2(c,h))+tt.dot(h,tt.sub(tt.addCrossNumVec2(m,l,s),tt.addCrossNumVec2(a,c,i)))}isLimitEnabled(){return this.m_enableLimit}enableLimit(t){t!=this.m_enableLimit&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableLimit=t,this.m_impulse.z=0)}getLowerLimit(){return this.m_lowerTranslation}getUpperLimit(){return this.m_upperTranslation}setLimits(t,e){t==this.m_lowerTranslation&&e==this.m_upperTranslation||(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_lowerTranslation=t,this.m_upperTranslation=e,this.m_impulse.z=0)}isMotorEnabled(){return this.m_enableMotor}enableMotor(t){t!=this.m_enableMotor&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=t)}setMotorSpeed(t){t!=this.m_motorSpeed&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=t)}setMaxMotorForce(t){t!=this.m_maxMotorForce&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorForce=t)}getMaxMotorForce(){return this.m_maxMotorForce}getMotorSpeed(){return this.m_motorSpeed}getMotorForce(t){return t*this.m_motorImpulse}getAnchorA(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)}getAnchorB(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)}getReactionForce(t){return tt.combine(this.m_impulse.x,this.m_perp,this.m_motorImpulse+this.m_impulse.z,this.m_axis).mul(t)}getReactionTorque(t){return t*this.m_impulse.y}initVelocityConstraints(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyA.c_velocity.v;let o=this.m_bodyA.c_velocity.w;const n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,h=this.m_bodyB.c_velocity.v;let a=this.m_bodyB.c_velocity.w;const m=Rt.neo(i),c=Rt.neo(r),l=Rt.mulVec2(m,tt.sub(this.m_localAnchorA,this.m_localCenterA)),_=Rt.mulVec2(c,tt.sub(this.m_localAnchorB,this.m_localCenterB)),u=tt.zero();u.addCombine(1,n,1,_),u.subCombine(1,e,1,l);const d=this.m_invMassA,p=this.m_invMassB,y=this.m_invIA,x=this.m_invIB;this.m_axis=Rt.mulVec2(m,this.m_localXAxisA),this.m_a1=tt.crossVec2Vec2(tt.add(u,l),this.m_axis),this.m_a2=tt.crossVec2Vec2(_,this.m_axis),this.m_motorMass=d+p+y*this.m_a1*this.m_a1+x*this.m_a2*this.m_a2,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass);{this.m_perp=Rt.mulVec2(m,this.m_localYAxisA),this.m_s1=tt.crossVec2Vec2(tt.add(u,l),this.m_perp),this.m_s2=tt.crossVec2Vec2(_,this.m_perp),tt.crossVec2Vec2(l,this.m_perp);const t=d+p+y*this.m_s1*this.m_s1+x*this.m_s2*this.m_s2,e=y*this.m_s1+x*this.m_s2,i=y*this.m_s1*this.m_a1+x*this.m_s2*this.m_a2;let s=y+x;0==s&&(s=1);const o=y*this.m_a1+x*this.m_a2,n=d+p+y*this.m_a1*this.m_a1+x*this.m_a2*this.m_a2;this.m_K.ex.set(t,e,i),this.m_K.ey.set(e,s,o),this.m_K.ez.set(i,o,n)}if(this.m_enableLimit){const t=tt.dot(this.m_axis,u);$.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*st.linearSlop?this.m_limitState=3:t<=this.m_lowerTranslation?1!=this.m_limitState&&(this.m_limitState=1,this.m_impulse.z=0):t>=this.m_upperTranslation?2!=this.m_limitState&&(this.m_limitState=2,this.m_impulse.z=0):(this.m_limitState=0,this.m_impulse.z=0)}else this.m_limitState=0,this.m_impulse.z=0;if(0==this.m_enableMotor&&(this.m_motorImpulse=0),t.warmStarting){this.m_impulse.mul(t.dtRatio),this.m_motorImpulse*=t.dtRatio;const e=tt.combine(this.m_impulse.x,this.m_perp,this.m_motorImpulse+this.m_impulse.z,this.m_axis),i=this.m_impulse.x*this.m_s1+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a1,n=this.m_impulse.x*this.m_s2+this.m_impulse.y+(this.m_motorImpulse+this.m_impulse.z)*this.m_a2;s.subMul(d,e),o-=y*i,h.addMul(p,e),a+=x*n}else this.m_impulse.setZero(),this.m_motorImpulse=0;this.m_bodyA.c_velocity.v.setVec2(s),this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v.setVec2(h),this.m_bodyB.c_velocity.w=a}solveVelocityConstraints(t){const e=this.m_bodyA.c_velocity.v;let i=this.m_bodyA.c_velocity.w;const s=this.m_bodyB.c_velocity.v;let o=this.m_bodyB.c_velocity.w;const n=this.m_invMassA,r=this.m_invMassB,h=this.m_invIA,a=this.m_invIB;if(this.m_enableMotor&&3!=this.m_limitState){const m=tt.dot(this.m_axis,tt.sub(s,e))+this.m_a2*o-this.m_a1*i;let c=this.m_motorMass*(this.m_motorSpeed-m);const l=this.m_motorImpulse,_=t.dt*this.m_maxMotorForce;this.m_motorImpulse=$.clamp(this.m_motorImpulse+c,-_,_),c=this.m_motorImpulse-l;const u=tt.mulNumVec2(c,this.m_axis),d=c*this.m_a1,p=c*this.m_a2;e.subMul(n,u),i-=h*d,s.addMul(r,u),o+=a*p}const m=tt.zero();if(m.x+=tt.dot(this.m_perp,s)+this.m_s2*o,m.x-=tt.dot(this.m_perp,e)+this.m_s1*i,m.y=o-i,this.m_enableLimit&&0!=this.m_limitState){let t=0;t+=tt.dot(this.m_axis,s)+this.m_a2*o,t-=tt.dot(this.m_axis,e)+this.m_a1*i;const c=new xs(m.x,m.y,t),l=xs.clone(this.m_impulse);let _=this.m_K.solve33(xs.neg(c));this.m_impulse.add(_),1==this.m_limitState?this.m_impulse.z=$.max(this.m_impulse.z,0):2==this.m_limitState&&(this.m_impulse.z=$.min(this.m_impulse.z,0));const u=tt.combine(-1,m,-(this.m_impulse.z-l.z),tt.neo(this.m_K.ez.x,this.m_K.ez.y)),d=tt.add(this.m_K.solve22(u),tt.neo(l.x,l.y));this.m_impulse.x=d.x,this.m_impulse.y=d.y,_=xs.sub(this.m_impulse,l);const p=tt.combine(_.x,this.m_perp,_.z,this.m_axis),y=_.x*this.m_s1+_.y+_.z*this.m_a1,x=_.x*this.m_s2+_.y+_.z*this.m_a2;e.subMul(n,p),i-=h*y,s.addMul(r,p),o+=a*x}else{const t=this.m_K.solve22(tt.neg(m));this.m_impulse.x+=t.x,this.m_impulse.y+=t.y;const c=tt.mulNumVec2(t.x,this.m_perp),l=t.x*this.m_s1+t.y,_=t.x*this.m_s2+t.y;e.subMul(n,c),i-=h*l,s.addMul(r,c),o+=a*_}this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=s,this.m_bodyB.c_velocity.w=o}solvePositionConstraints(t){const e=this.m_bodyA.c_position.c;let i=this.m_bodyA.c_position.a;const s=this.m_bodyB.c_position.c;let o=this.m_bodyB.c_position.a;const n=Rt.neo(i),r=Rt.neo(o),h=this.m_invMassA,a=this.m_invMassB,m=this.m_invIA,c=this.m_invIB,l=Rt.mulVec2(n,tt.sub(this.m_localAnchorA,this.m_localCenterA)),_=Rt.mulVec2(r,tt.sub(this.m_localAnchorB,this.m_localCenterB)),u=tt.sub(tt.add(s,_),tt.add(e,l)),d=Rt.mulVec2(n,this.m_localXAxisA),p=tt.crossVec2Vec2(tt.add(u,l),d),y=tt.crossVec2Vec2(_,d),x=Rt.mulVec2(n,this.m_localYAxisA),f=tt.crossVec2Vec2(tt.add(u,l),x),g=tt.crossVec2Vec2(_,x);let v=new xs;const A=tt.zero();A.x=tt.dot(x,u),A.y=o-i-this.m_referenceAngle;let b=$.abs(A.x);const B=$.abs(A.y),w=st.linearSlop,C=st.maxLinearCorrection;let M=!1,V=0;if(this.m_enableLimit){const t=tt.dot(d,u);$.abs(this.m_upperTranslation-this.m_lowerTranslation)<2*w?(V=$.clamp(t,-C,C),b=$.max(b,$.abs(t)),M=!0):t<=this.m_lowerTranslation?(V=$.clamp(t-this.m_lowerTranslation+w,-C,0),b=$.max(b,this.m_lowerTranslation-t),M=!0):t>=this.m_upperTranslation&&(V=$.clamp(t-this.m_upperTranslation-w,0,C),b=$.max(b,t-this.m_upperTranslation),M=!0)}if(M){const t=h+a+m*f*f+c*g*g,e=m*f+c*g,i=m*f*p+c*g*y;let s=m+c;0==s&&(s=1);const o=m*p+c*y,n=h+a+m*p*p+c*y*y,r=new Ys;r.ex.set(t,e,i),r.ey.set(e,s,o),r.ez.set(i,o,n);const l=new xs;l.x=A.x,l.y=A.y,l.z=V,v=r.solve33(xs.neg(l))}else{const t=h+a+m*f*f+c*g*g,e=m*f+c*g;let i=m+c;0==i&&(i=1);const s=new pi;s.ex.setNum(t,e),s.ey.setNum(e,i);const o=s.solve(tt.neg(A));v.x=o.x,v.y=o.y,v.z=0}const I=tt.combine(v.x,x,v.z,d),S=v.x*f+v.y+v.z*p,P=v.x*g+v.y+v.z*y;return e.subMul(h,I),i-=m*S,s.addMul(a,I),o+=c*P,this.m_bodyA.c_position.c=e,this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c=s,this.m_bodyB.c_position.a=o,b<=st.linearSlop&&B<=st.angularSlop}}Hs.TYPE="prismatic-joint";const Ks={ratio:1};class Zs extends ce{constructor(t,e,i,s,o,n){let r,h;super(t=Q(t,Ks),e,i),e=this.m_bodyA,i=this.m_bodyB,this.m_type=Zs.TYPE,this.m_joint1=s||t.joint1,this.m_joint2=o||t.joint2,this.m_ratio=$.isFinite(n)?n:t.ratio,this.m_type1=this.m_joint1.getType(),this.m_type2=this.m_joint2.getType(),this.m_bodyC=this.m_joint1.getBodyA(),this.m_bodyA=this.m_joint1.getBodyB();const a=this.m_bodyA.m_xf,m=this.m_bodyA.m_sweep.a,c=this.m_bodyC.m_xf,l=this.m_bodyC.m_sweep.a;if(this.m_type1===Js.TYPE){const t=this.m_joint1;this.m_localAnchorC=t.m_localAnchorA,this.m_localAnchorA=t.m_localAnchorB,this.m_referenceAngleA=t.m_referenceAngle,this.m_localAxisC=tt.zero(),r=m-l-this.m_referenceAngleA}else{const t=this.m_joint1;this.m_localAnchorC=t.m_localAnchorA,this.m_localAnchorA=t.m_localAnchorB,this.m_referenceAngleA=t.m_referenceAngle,this.m_localAxisC=t.m_localXAxisA;const e=this.m_localAnchorC,i=Rt.mulTVec2(c.q,tt.add(Rt.mulVec2(a.q,this.m_localAnchorA),tt.sub(a.p,c.p)));r=tt.dot(i,this.m_localAxisC)-tt.dot(e,this.m_localAxisC)}this.m_bodyD=this.m_joint2.getBodyA(),this.m_bodyB=this.m_joint2.getBodyB();const _=this.m_bodyB.m_xf,u=this.m_bodyB.m_sweep.a,d=this.m_bodyD.m_xf,p=this.m_bodyD.m_sweep.a;if(this.m_type2===Js.TYPE){const t=this.m_joint2;this.m_localAnchorD=t.m_localAnchorA,this.m_localAnchorB=t.m_localAnchorB,this.m_referenceAngleB=t.m_referenceAngle,this.m_localAxisD=tt.zero(),h=u-p-this.m_referenceAngleB}else{const t=this.m_joint2;this.m_localAnchorD=t.m_localAnchorA,this.m_localAnchorB=t.m_localAnchorB,this.m_referenceAngleB=t.m_referenceAngle,this.m_localAxisD=t.m_localXAxisA;const e=this.m_localAnchorD,i=Rt.mulTVec2(d.q,tt.add(Rt.mulVec2(_.q,this.m_localAnchorB),tt.sub(_.p,d.p)));h=tt.dot(i,this.m_localAxisD)-tt.dot(e,this.m_localAxisD)}this.m_constant=r+this.m_ratio*h,this.m_impulse=0}_serialize(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,joint1:this.m_joint1,joint2:this.m_joint2,ratio:this.m_ratio}}static _deserialize(t,e,i){(t=Object.assign({},t)).bodyA=i(ae,t.bodyA,e),t.bodyB=i(ae,t.bodyB,e),t.joint1=i(ce,t.joint1,e),t.joint2=i(ce,t.joint2,e);return new Zs(t)}getJoint1(){return this.m_joint1}getJoint2(){return this.m_joint2}setRatio(t){this.m_ratio=t}getRatio(){return this.m_ratio}getAnchorA(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)}getAnchorB(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)}getReactionForce(t){return tt.mulNumVec2(this.m_impulse,this.m_JvAC).mul(t)}getReactionTorque(t){return t*(this.m_impulse*this.m_JwA)}initVelocityConstraints(t){this.m_lcA=this.m_bodyA.m_sweep.localCenter,this.m_lcB=this.m_bodyB.m_sweep.localCenter,this.m_lcC=this.m_bodyC.m_sweep.localCenter,this.m_lcD=this.m_bodyD.m_sweep.localCenter,this.m_mA=this.m_bodyA.m_invMass,this.m_mB=this.m_bodyB.m_invMass,this.m_mC=this.m_bodyC.m_invMass,this.m_mD=this.m_bodyD.m_invMass,this.m_iA=this.m_bodyA.m_invI,this.m_iB=this.m_bodyB.m_invI,this.m_iC=this.m_bodyC.m_invI,this.m_iD=this.m_bodyD.m_invI;const e=this.m_bodyA.c_position.a,i=this.m_bodyA.c_velocity.v;let s=this.m_bodyA.c_velocity.w;const o=this.m_bodyB.c_position.a,n=this.m_bodyB.c_velocity.v;let r=this.m_bodyB.c_velocity.w;const h=this.m_bodyC.c_position.a,a=this.m_bodyC.c_velocity.v;let m=this.m_bodyC.c_velocity.w;const c=this.m_bodyD.c_position.a,l=this.m_bodyD.c_velocity.v;let _=this.m_bodyD.c_velocity.w;const u=Rt.neo(e),d=Rt.neo(o),p=Rt.neo(h),y=Rt.neo(c);if(this.m_mass=0,this.m_type1==Js.TYPE)this.m_JvAC=tt.zero(),this.m_JwA=1,this.m_JwC=1,this.m_mass+=this.m_iA+this.m_iC;else{const t=Rt.mulVec2(p,this.m_localAxisC),e=Rt.mulSub(p,this.m_localAnchorC,this.m_lcC),i=Rt.mulSub(u,this.m_localAnchorA,this.m_lcA);this.m_JvAC=t,this.m_JwC=tt.crossVec2Vec2(e,t),this.m_JwA=tt.crossVec2Vec2(i,t),this.m_mass+=this.m_mC+this.m_mA+this.m_iC*this.m_JwC*this.m_JwC+this.m_iA*this.m_JwA*this.m_JwA}if(this.m_type2==Js.TYPE)this.m_JvBD=tt.zero(),this.m_JwB=this.m_ratio,this.m_JwD=this.m_ratio,this.m_mass+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD);else{const t=Rt.mulVec2(y,this.m_localAxisD),e=Rt.mulSub(y,this.m_localAnchorD,this.m_lcD),i=Rt.mulSub(d,this.m_localAnchorB,this.m_lcB);this.m_JvBD=tt.mulNumVec2(this.m_ratio,t),this.m_JwD=this.m_ratio*tt.crossVec2Vec2(e,t),this.m_JwB=this.m_ratio*tt.crossVec2Vec2(i,t),this.m_mass+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*this.m_JwD*this.m_JwD+this.m_iB*this.m_JwB*this.m_JwB}this.m_mass=this.m_mass>0?1/this.m_mass:0,t.warmStarting?(i.addMul(this.m_mA*this.m_impulse,this.m_JvAC),s+=this.m_iA*this.m_impulse*this.m_JwA,n.addMul(this.m_mB*this.m_impulse,this.m_JvBD),r+=this.m_iB*this.m_impulse*this.m_JwB,a.subMul(this.m_mC*this.m_impulse,this.m_JvAC),m-=this.m_iC*this.m_impulse*this.m_JwC,l.subMul(this.m_mD*this.m_impulse,this.m_JvBD),_-=this.m_iD*this.m_impulse*this.m_JwD):this.m_impulse=0,this.m_bodyA.c_velocity.v.setVec2(i),this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v.setVec2(n),this.m_bodyB.c_velocity.w=r,this.m_bodyC.c_velocity.v.setVec2(a),this.m_bodyC.c_velocity.w=m,this.m_bodyD.c_velocity.v.setVec2(l),this.m_bodyD.c_velocity.w=_}solveVelocityConstraints(t){const e=this.m_bodyA.c_velocity.v;let i=this.m_bodyA.c_velocity.w;const s=this.m_bodyB.c_velocity.v;let o=this.m_bodyB.c_velocity.w;const n=this.m_bodyC.c_velocity.v;let r=this.m_bodyC.c_velocity.w;const h=this.m_bodyD.c_velocity.v;let a=this.m_bodyD.c_velocity.w,m=tt.dot(this.m_JvAC,e)-tt.dot(this.m_JvAC,n)+tt.dot(this.m_JvBD,s)-tt.dot(this.m_JvBD,h);m+=this.m_JwA*i-this.m_JwC*r+(this.m_JwB*o-this.m_JwD*a);const c=-this.m_mass*m;this.m_impulse+=c,e.addMul(this.m_mA*c,this.m_JvAC),i+=this.m_iA*c*this.m_JwA,s.addMul(this.m_mB*c,this.m_JvBD),o+=this.m_iB*c*this.m_JwB,n.subMul(this.m_mC*c,this.m_JvAC),r-=this.m_iC*c*this.m_JwC,h.subMul(this.m_mD*c,this.m_JvBD),a-=this.m_iD*c*this.m_JwD,this.m_bodyA.c_velocity.v.setVec2(e),this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v.setVec2(s),this.m_bodyB.c_velocity.w=o,this.m_bodyC.c_velocity.v.setVec2(n),this.m_bodyC.c_velocity.w=r,this.m_bodyD.c_velocity.v.setVec2(h),this.m_bodyD.c_velocity.w=a}solvePositionConstraints(t){const e=this.m_bodyA.c_position.c;let i=this.m_bodyA.c_position.a;const s=this.m_bodyB.c_position.c;let o=this.m_bodyB.c_position.a;const n=this.m_bodyC.c_position.c;let r=this.m_bodyC.c_position.a;const h=this.m_bodyD.c_position.c;let a=this.m_bodyD.c_position.a;const m=Rt.neo(i),c=Rt.neo(o),l=Rt.neo(r),_=Rt.neo(a);let u,d,p,y,x,f,g,v,A=0;if(this.m_type1==Js.TYPE)p=tt.zero(),x=1,g=1,A+=this.m_iA+this.m_iC,u=i-r-this.m_referenceAngleA;else{const t=Rt.mulVec2(l,this.m_localAxisC),i=Rt.mulSub(l,this.m_localAnchorC,this.m_lcC),s=Rt.mulSub(m,this.m_localAnchorA,this.m_lcA);p=t,g=tt.crossVec2Vec2(i,t),x=tt.crossVec2Vec2(s,t),A+=this.m_mC+this.m_mA+this.m_iC*g*g+this.m_iA*x*x;const o=tt.sub(this.m_localAnchorC,this.m_lcC),r=Rt.mulTVec2(l,tt.add(s,tt.sub(e,n)));u=tt.dot(tt.sub(r,o),this.m_localAxisC)}if(this.m_type2==Js.TYPE)y=tt.zero(),f=this.m_ratio,v=this.m_ratio,A+=this.m_ratio*this.m_ratio*(this.m_iB+this.m_iD),d=o-a-this.m_referenceAngleB;else{const t=Rt.mulVec2(_,this.m_localAxisD),e=Rt.mulSub(_,this.m_localAnchorD,this.m_lcD),i=Rt.mulSub(c,this.m_localAnchorB,this.m_lcB);y=tt.mulNumVec2(this.m_ratio,t),v=this.m_ratio*tt.crossVec2Vec2(e,t),f=this.m_ratio*tt.crossVec2Vec2(i,t),A+=this.m_ratio*this.m_ratio*(this.m_mD+this.m_mB)+this.m_iD*v*v+this.m_iB*f*f;const o=tt.sub(this.m_localAnchorD,this.m_lcD),n=Rt.mulTVec2(_,tt.add(i,tt.sub(s,h)));d=tt.dot(n,this.m_localAxisD)-tt.dot(o,this.m_localAxisD)}const b=u+this.m_ratio*d-this.m_constant;let B=0;return A>0&&(B=-b/A),e.addMul(this.m_mA*B,p),i+=this.m_iA*B*x,s.addMul(this.m_mB*B,y),o+=this.m_iB*B*f,n.subMul(this.m_mC*B,p),r-=this.m_iC*B*g,h.subMul(this.m_mD*B,y),a-=this.m_iD*B*v,this.m_bodyA.c_position.c.setVec2(e),this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c.setVec2(s),this.m_bodyB.c_position.a=o,this.m_bodyC.c_position.c.setVec2(n),this.m_bodyC.c_position.a=r,this.m_bodyD.c_position.c.setVec2(h),this.m_bodyD.c_position.a=a,0<st.linearSlop}}Zs.TYPE="gear-joint";const Us={maxForce:1,maxTorque:1,correctionFactor:.3};class Gs extends ce{constructor(t,e,i){super(t=Q(t,Us),e,i),e=this.m_bodyA,i=this.m_bodyB,this.m_type=Gs.TYPE,this.m_linearOffset=$.isFinite(t.linearOffset)?t.linearOffset:e.getLocalPoint(i.getPosition()),this.m_angularOffset=$.isFinite(t.angularOffset)?t.angularOffset:i.getAngle()-e.getAngle(),this.m_linearImpulse=tt.zero(),this.m_angularImpulse=0,this.m_maxForce=t.maxForce,this.m_maxTorque=t.maxTorque,this.m_correctionFactor=t.correctionFactor}_serialize(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,maxForce:this.m_maxForce,maxTorque:this.m_maxTorque,correctionFactor:this.m_correctionFactor,linearOffset:this.m_linearOffset,angularOffset:this.m_angularOffset}}static _deserialize(t,e,i){(t=Object.assign({},t)).bodyA=i(ae,t.bodyA,e),t.bodyB=i(ae,t.bodyB,e);return new Gs(t)}_setAnchors(t){}setMaxForce(t){this.m_maxForce=t}getMaxForce(){return this.m_maxForce}setMaxTorque(t){this.m_maxTorque=t}getMaxTorque(){return this.m_maxTorque}setCorrectionFactor(t){this.m_correctionFactor=t}getCorrectionFactor(){return this.m_correctionFactor}setLinearOffset(t){t.x==this.m_linearOffset.x&&t.y==this.m_linearOffset.y||(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_linearOffset=t)}getLinearOffset(){return this.m_linearOffset}setAngularOffset(t){t!=this.m_angularOffset&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_angularOffset=t)}getAngularOffset(){return this.m_angularOffset}getAnchorA(){return this.m_bodyA.getPosition()}getAnchorB(){return this.m_bodyB.getPosition()}getReactionForce(t){return tt.mulNumVec2(t,this.m_linearImpulse)}getReactionTorque(t){return t*this.m_angularImpulse}initVelocityConstraints(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyA.c_velocity.v;let o=this.m_bodyA.c_velocity.w;const n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,h=this.m_bodyB.c_velocity.v;let a=this.m_bodyB.c_velocity.w;const m=Rt.neo(i),c=Rt.neo(r);this.m_rA=Rt.mulVec2(m,tt.sub(this.m_linearOffset,this.m_localCenterA)),this.m_rB=Rt.mulVec2(c,tt.neg(this.m_localCenterB));const l=this.m_invMassA,_=this.m_invMassB,u=this.m_invIA,d=this.m_invIB,p=new pi;if(p.ex.x=l+_+u*this.m_rA.y*this.m_rA.y+d*this.m_rB.y*this.m_rB.y,p.ex.y=-u*this.m_rA.x*this.m_rA.y-d*this.m_rB.x*this.m_rB.y,p.ey.x=p.ex.y,p.ey.y=l+_+u*this.m_rA.x*this.m_rA.x+d*this.m_rB.x*this.m_rB.x,this.m_linearMass=p.getInverse(),this.m_angularMass=u+d,this.m_angularMass>0&&(this.m_angularMass=1/this.m_angularMass),this.m_linearError=tt.zero(),this.m_linearError.addCombine(1,n,1,this.m_rB),this.m_linearError.subCombine(1,e,1,this.m_rA),this.m_angularError=r-i-this.m_angularOffset,t.warmStarting){this.m_linearImpulse.mul(t.dtRatio),this.m_angularImpulse*=t.dtRatio;const e=tt.neo(this.m_linearImpulse.x,this.m_linearImpulse.y);s.subMul(l,e),o-=u*(tt.crossVec2Vec2(this.m_rA,e)+this.m_angularImpulse),h.addMul(_,e),a+=d*(tt.crossVec2Vec2(this.m_rB,e)+this.m_angularImpulse)}else this.m_linearImpulse.setZero(),this.m_angularImpulse=0;this.m_bodyA.c_velocity.v=s,this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v=h,this.m_bodyB.c_velocity.w=a}solveVelocityConstraints(t){const e=this.m_bodyA.c_velocity.v;let i=this.m_bodyA.c_velocity.w;const s=this.m_bodyB.c_velocity.v;let o=this.m_bodyB.c_velocity.w;const n=this.m_invMassA,r=this.m_invMassB,h=this.m_invIA,a=this.m_invIB,m=t.dt,c=t.inv_dt;{const t=o-i+c*this.m_correctionFactor*this.m_angularError;let e=-this.m_angularMass*t;const s=this.m_angularImpulse,n=m*this.m_maxTorque;this.m_angularImpulse=$.clamp(this.m_angularImpulse+e,-n,n),e=this.m_angularImpulse-s,i-=h*e,o+=a*e}{const t=tt.zero();t.addCombine(1,s,1,tt.crossNumVec2(o,this.m_rB)),t.subCombine(1,e,1,tt.crossNumVec2(i,this.m_rA)),t.addMul(c*this.m_correctionFactor,this.m_linearError);let l=tt.neg(pi.mulVec2(this.m_linearMass,t));const _=tt.clone(this.m_linearImpulse);this.m_linearImpulse.add(l);const u=m*this.m_maxForce;this.m_linearImpulse.clamp(u),l=tt.sub(this.m_linearImpulse,_),e.subMul(n,l),i-=h*tt.crossVec2Vec2(this.m_rA,l),s.addMul(r,l),o+=a*tt.crossVec2Vec2(this.m_rB,l)}this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=s,this.m_bodyB.c_velocity.w=o}solvePositionConstraints(t){return!0}}Gs.TYPE="motor-joint";const Qs={maxForce:0,frequencyHz:5,dampingRatio:.7};class $s extends ce{constructor(t,e,i,s){super(t=Q(t,Qs),e,i),e=this.m_bodyA,i=this.m_bodyB,this.m_type=$s.TYPE,tt.isValid(s)?this.m_targetA=tt.clone(s):tt.isValid(t.target)?this.m_targetA=tt.clone(t.target):this.m_targetA=tt.zero(),this.m_localAnchorB=Ot.mulTVec2(i.getTransform(),this.m_targetA),this.m_maxForce=t.maxForce,this.m_impulse=tt.zero(),this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_beta=0,this.m_gamma=0,this.m_rB=tt.zero(),this.m_localCenterB=tt.zero(),this.m_invMassB=0,this.m_invIB=0,this.m_mass=new pi,this.m_C=tt.zero()}_serialize(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,target:this.m_targetA,maxForce:this.m_maxForce,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,_localAnchorB:this.m_localAnchorB}}static _deserialize(t,e,i){(t=Object.assign({},t)).bodyA=i(ae,t.bodyA,e),t.bodyB=i(ae,t.bodyB,e),t.target=tt.clone(t.target);const s=new $s(t);return t._localAnchorB&&(s.m_localAnchorB=t._localAnchorB),s}setTarget(t){tt.areEqual(t,this.m_targetA)||(this.m_bodyB.setAwake(!0),this.m_targetA=tt.clone(t))}getTarget(){return this.m_targetA}setMaxForce(t){this.m_maxForce=t}getMaxForce(){return this.m_maxForce}setFrequency(t){this.m_frequencyHz=t}getFrequency(){return this.m_frequencyHz}setDampingRatio(t){this.m_dampingRatio=t}getDampingRatio(){return this.m_dampingRatio}getAnchorA(){return tt.clone(this.m_targetA)}getAnchorB(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)}getReactionForce(t){return tt.mulNumVec2(t,this.m_impulse)}getReactionTorque(t){return 0*t}shiftOrigin(t){this.m_targetA.sub(t)}initVelocityConstraints(t){this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIB=this.m_bodyB.m_invI;const e=this.m_bodyB.c_position,i=this.m_bodyB.c_velocity,s=e.c,o=e.a,n=i.v;let r=i.w;const h=Rt.neo(o),a=this.m_bodyB.getMass(),m=2*$.PI*this.m_frequencyHz,c=2*a*this.m_dampingRatio*m,l=a*(m*m),_=t.dt;this.m_gamma=_*(c+_*l),0!=this.m_gamma&&(this.m_gamma=1/this.m_gamma),this.m_beta=_*l*this.m_gamma,this.m_rB=Rt.mulVec2(h,tt.sub(this.m_localAnchorB,this.m_localCenterB));const u=new pi;u.ex.x=this.m_invMassB+this.m_invIB*this.m_rB.y*this.m_rB.y+this.m_gamma,u.ex.y=-this.m_invIB*this.m_rB.x*this.m_rB.y,u.ey.x=u.ex.y,u.ey.y=this.m_invMassB+this.m_invIB*this.m_rB.x*this.m_rB.x+this.m_gamma,this.m_mass=u.getInverse(),this.m_C.setVec2(s),this.m_C.addCombine(1,this.m_rB,-1,this.m_targetA),this.m_C.mul(this.m_beta),r*=.98,t.warmStarting?(this.m_impulse.mul(t.dtRatio),n.addMul(this.m_invMassB,this.m_impulse),r+=this.m_invIB*tt.crossVec2Vec2(this.m_rB,this.m_impulse)):this.m_impulse.setZero(),i.v.setVec2(n),i.w=r}solveVelocityConstraints(t){const e=this.m_bodyB.c_velocity,i=tt.clone(e.v);let s=e.w;const o=tt.crossNumVec2(s,this.m_rB);o.add(i),o.addCombine(1,this.m_C,this.m_gamma,this.m_impulse),o.neg();let n=pi.mulVec2(this.m_mass,o);const r=tt.clone(this.m_impulse);this.m_impulse.add(n);const h=t.dt*this.m_maxForce;this.m_impulse.clamp(h),n=tt.sub(this.m_impulse,r),i.addMul(this.m_invMassB,n),s+=this.m_invIB*tt.crossVec2Vec2(this.m_rB,n),e.v.setVec2(i),e.w=s}solvePositionConstraints(t){return!0}}$s.TYPE="mouse-joint";const to={collideConnected:!0};class eo extends ce{constructor(t,e,i,s,o,n,r,h){super(t=Q(t,to),e,i),e=this.m_bodyA,i=this.m_bodyB,this.m_type=eo.TYPE,this.m_groundAnchorA=s||(t.groundAnchorA||tt.neo(-1,1)),this.m_groundAnchorB=o||(t.groundAnchorB||tt.neo(1,1)),this.m_localAnchorA=n?e.getLocalPoint(n):t.localAnchorA||tt.neo(-1,0),this.m_localAnchorB=r?i.getLocalPoint(r):t.localAnchorB||tt.neo(1,0),this.m_lengthA=$.isFinite(t.lengthA)?t.lengthA:tt.distance(n,s),this.m_lengthB=$.isFinite(t.lengthB)?t.lengthB:tt.distance(r,o),this.m_ratio=$.isFinite(h)?h:t.ratio,this.m_constant=this.m_lengthA+this.m_ratio*this.m_lengthB,this.m_impulse=0}_serialize(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,groundAnchorA:this.m_groundAnchorA,groundAnchorB:this.m_groundAnchorB,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,lengthA:this.m_lengthA,lengthB:this.m_lengthB,ratio:this.m_ratio}}static _deserialize(t,e,i){(t=Object.assign({},t)).bodyA=i(ae,t.bodyA,e),t.bodyB=i(ae,t.bodyB,e);return new eo(t)}getGroundAnchorA(){return this.m_groundAnchorA}getGroundAnchorB(){return this.m_groundAnchorB}getLengthA(){return this.m_lengthA}getLengthB(){return this.m_lengthB}getRatio(){return this.m_ratio}getCurrentLengthA(){const t=this.m_bodyA.getWorldPoint(this.m_localAnchorA),e=this.m_groundAnchorA;return tt.distance(t,e)}getCurrentLengthB(){const t=this.m_bodyB.getWorldPoint(this.m_localAnchorB),e=this.m_groundAnchorB;return tt.distance(t,e)}shiftOrigin(t){this.m_groundAnchorA.sub(t),this.m_groundAnchorB.sub(t)}getAnchorA(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)}getAnchorB(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)}getReactionForce(t){return tt.mulNumVec2(this.m_impulse,this.m_uB).mul(t)}getReactionTorque(t){return 0}initVelocityConstraints(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyA.c_velocity.v;let o=this.m_bodyA.c_velocity.w;const n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,h=this.m_bodyB.c_velocity.v;let a=this.m_bodyB.c_velocity.w;const m=Rt.neo(i),c=Rt.neo(r);this.m_rA=Rt.mulVec2(m,tt.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=Rt.mulVec2(c,tt.sub(this.m_localAnchorB,this.m_localCenterB)),this.m_uA=tt.sub(tt.add(e,this.m_rA),this.m_groundAnchorA),this.m_uB=tt.sub(tt.add(n,this.m_rB),this.m_groundAnchorB);const l=this.m_uA.length(),_=this.m_uB.length();l>10*st.linearSlop?this.m_uA.mul(1/l):this.m_uA.setZero(),_>10*st.linearSlop?this.m_uB.mul(1/_):this.m_uB.setZero();const u=tt.crossVec2Vec2(this.m_rA,this.m_uA),d=tt.crossVec2Vec2(this.m_rB,this.m_uB),p=this.m_invMassA+this.m_invIA*u*u,y=this.m_invMassB+this.m_invIB*d*d;if(this.m_mass=p+this.m_ratio*this.m_ratio*y,this.m_mass>0&&(this.m_mass=1/this.m_mass),t.warmStarting){this.m_impulse*=t.dtRatio;const e=tt.mulNumVec2(-this.m_impulse,this.m_uA),i=tt.mulNumVec2(-this.m_ratio*this.m_impulse,this.m_uB);s.addMul(this.m_invMassA,e),o+=this.m_invIA*tt.crossVec2Vec2(this.m_rA,e),h.addMul(this.m_invMassB,i),a+=this.m_invIB*tt.crossVec2Vec2(this.m_rB,i)}else this.m_impulse=0;this.m_bodyA.c_velocity.v=s,this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v=h,this.m_bodyB.c_velocity.w=a}solveVelocityConstraints(t){const e=this.m_bodyA.c_velocity.v;let i=this.m_bodyA.c_velocity.w;const s=this.m_bodyB.c_velocity.v;let o=this.m_bodyB.c_velocity.w;const n=tt.add(e,tt.crossNumVec2(i,this.m_rA)),r=tt.add(s,tt.crossNumVec2(o,this.m_rB)),h=-tt.dot(this.m_uA,n)-this.m_ratio*tt.dot(this.m_uB,r),a=-this.m_mass*h;this.m_impulse+=a;const m=tt.mulNumVec2(-a,this.m_uA),c=tt.mulNumVec2(-this.m_ratio*a,this.m_uB);e.addMul(this.m_invMassA,m),i+=this.m_invIA*tt.crossVec2Vec2(this.m_rA,m),s.addMul(this.m_invMassB,c),o+=this.m_invIB*tt.crossVec2Vec2(this.m_rB,c),this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=s,this.m_bodyB.c_velocity.w=o}solvePositionConstraints(t){const e=this.m_bodyA.c_position.c;let i=this.m_bodyA.c_position.a;const s=this.m_bodyB.c_position.c;let o=this.m_bodyB.c_position.a;const n=Rt.neo(i),r=Rt.neo(o),h=Rt.mulVec2(n,tt.sub(this.m_localAnchorA,this.m_localCenterA)),a=Rt.mulVec2(r,tt.sub(this.m_localAnchorB,this.m_localCenterB)),m=tt.sub(tt.add(e,this.m_rA),this.m_groundAnchorA),c=tt.sub(tt.add(s,this.m_rB),this.m_groundAnchorB),l=m.length(),_=c.length();l>10*st.linearSlop?m.mul(1/l):m.setZero(),_>10*st.linearSlop?c.mul(1/_):c.setZero();const u=tt.crossVec2Vec2(h,m),d=tt.crossVec2Vec2(a,c),p=this.m_invMassA+this.m_invIA*u*u,y=this.m_invMassB+this.m_invIB*d*d;let x=p+this.m_ratio*this.m_ratio*y;x>0&&(x=1/x);const f=this.m_constant-l-this.m_ratio*_,g=$.abs(f),v=-x*f,A=tt.mulNumVec2(-v,m),b=tt.mulNumVec2(-this.m_ratio*v,c);return e.addMul(this.m_invMassA,A),i+=this.m_invIA*tt.crossVec2Vec2(h,A),s.addMul(this.m_invMassB,b),o+=this.m_invIB*tt.crossVec2Vec2(a,b),this.m_bodyA.c_position.c=e,this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c=s,this.m_bodyB.c_position.a=o,g<st.linearSlop}}eo.TYPE="pulley-joint";const io={maxLength:0};class so extends ce{constructor(t,e,i,s){super(t=Q(t,io),e,i),e=this.m_bodyA,i=this.m_bodyB,this.m_type=so.TYPE,this.m_localAnchorA=s?e.getLocalPoint(s):t.localAnchorA||tt.neo(-1,0),this.m_localAnchorB=s?i.getLocalPoint(s):t.localAnchorB||tt.neo(1,0),this.m_maxLength=t.maxLength,this.m_mass=0,this.m_impulse=0,this.m_length=0,this.m_state=0}_serialize(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,maxLength:this.m_maxLength}}static _deserialize(t,e,i){(t=Object.assign({},t)).bodyA=i(ae,t.bodyA,e),t.bodyB=i(ae,t.bodyB,e);return new so(t)}getLocalAnchorA(){return this.m_localAnchorA}getLocalAnchorB(){return this.m_localAnchorB}setMaxLength(t){this.m_maxLength=t}getMaxLength(){return this.m_maxLength}getLimitState(){return this.m_state}getAnchorA(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)}getAnchorB(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)}getReactionForce(t){return tt.mulNumVec2(this.m_impulse,this.m_u).mul(t)}getReactionTorque(t){return 0}initVelocityConstraints(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=this.m_bodyA.c_position.c,i=this.m_bodyA.c_position.a,s=this.m_bodyA.c_velocity.v;let o=this.m_bodyA.c_velocity.w;const n=this.m_bodyB.c_position.c,r=this.m_bodyB.c_position.a,h=this.m_bodyB.c_velocity.v;let a=this.m_bodyB.c_velocity.w;const m=Rt.neo(i),c=Rt.neo(r);this.m_rA=Rt.mulSub(m,this.m_localAnchorA,this.m_localCenterA),this.m_rB=Rt.mulSub(c,this.m_localAnchorB,this.m_localCenterB),this.m_u=tt.zero(),this.m_u.addCombine(1,n,1,this.m_rB),this.m_u.subCombine(1,e,1,this.m_rA),this.m_length=this.m_u.length();const l=this.m_length-this.m_maxLength;if(this.m_state=l>0?2:0,!(this.m_length>st.linearSlop))return this.m_u.setZero(),this.m_mass=0,void(this.m_impulse=0);this.m_u.mul(1/this.m_length);const _=tt.crossVec2Vec2(this.m_rA,this.m_u),u=tt.crossVec2Vec2(this.m_rB,this.m_u),d=this.m_invMassA+this.m_invIA*_*_+this.m_invMassB+this.m_invIB*u*u;if(this.m_mass=0!=d?1/d:0,t.warmStarting){this.m_impulse*=t.dtRatio;const e=tt.mulNumVec2(this.m_impulse,this.m_u);s.subMul(this.m_invMassA,e),o-=this.m_invIA*tt.crossVec2Vec2(this.m_rA,e),h.addMul(this.m_invMassB,e),a+=this.m_invIB*tt.crossVec2Vec2(this.m_rB,e)}else this.m_impulse=0;this.m_bodyA.c_velocity.v.setVec2(s),this.m_bodyA.c_velocity.w=o,this.m_bodyB.c_velocity.v.setVec2(h),this.m_bodyB.c_velocity.w=a}solveVelocityConstraints(t){const e=this.m_bodyA.c_velocity.v;let i=this.m_bodyA.c_velocity.w;const s=this.m_bodyB.c_velocity.v;let o=this.m_bodyB.c_velocity.w;const n=tt.addCrossNumVec2(e,i,this.m_rA),r=tt.addCrossNumVec2(s,o,this.m_rB),h=this.m_length-this.m_maxLength;let a=tt.dot(this.m_u,tt.sub(r,n));h<0&&(a+=t.inv_dt*h);let m=-this.m_mass*a;const c=this.m_impulse;this.m_impulse=$.min(0,this.m_impulse+m),m=this.m_impulse-c;const l=tt.mulNumVec2(m,this.m_u);e.subMul(this.m_invMassA,l),i-=this.m_invIA*tt.crossVec2Vec2(this.m_rA,l),s.addMul(this.m_invMassB,l),o+=this.m_invIB*tt.crossVec2Vec2(this.m_rB,l),this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=s,this.m_bodyB.c_velocity.w=o}solvePositionConstraints(t){const e=this.m_bodyA.c_position.c;let i=this.m_bodyA.c_position.a;const s=this.m_bodyB.c_position.c;let o=this.m_bodyB.c_position.a;const n=Rt.neo(i),r=Rt.neo(o),h=Rt.mulSub(n,this.m_localAnchorA,this.m_localCenterA),a=Rt.mulSub(r,this.m_localAnchorB,this.m_localCenterB),m=tt.zero();m.addCombine(1,s,1,a),m.subCombine(1,e,1,h);const c=m.normalize();let l=c-this.m_maxLength;l=$.clamp(l,0,st.maxLinearCorrection);const _=-this.m_mass*l,u=tt.mulNumVec2(_,m);return e.subMul(this.m_invMassA,u),i-=this.m_invIA*tt.crossVec2Vec2(h,u),s.addMul(this.m_invMassB,u),o+=this.m_invIB*tt.crossVec2Vec2(a,u),this.m_bodyA.c_position.c.setVec2(e),this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c.setVec2(s),this.m_bodyB.c_position.a=o,c-this.m_maxLength<st.linearSlop}}so.TYPE="rope-joint";const oo={frequencyHz:0,dampingRatio:0};class no extends ce{constructor(t,e,i,s){super(t=Q(t,oo),e,i),e=this.m_bodyA,i=this.m_bodyB,this.m_type=no.TYPE,this.m_localAnchorA=tt.clone(s?e.getLocalPoint(s):t.localAnchorA||tt.zero()),this.m_localAnchorB=tt.clone(s?i.getLocalPoint(s):t.localAnchorB||tt.zero()),this.m_referenceAngle=$.isFinite(t.referenceAngle)?t.referenceAngle:i.getAngle()-e.getAngle(),this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_impulse=new xs,this.m_bias=0,this.m_gamma=0,this.m_rA,this.m_rB,this.m_localCenterA,this.m_localCenterB,this.m_invMassA,this.m_invMassB,this.m_invIA,this.m_invIB,this.m_mass=new Ys}_serialize(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,referenceAngle:this.m_referenceAngle}}static _deserialize(t,e,i){(t=Object.assign({},t)).bodyA=i(ae,t.bodyA,e),t.bodyB=i(ae,t.bodyB,e);return new no(t)}_setAnchors(t){t.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.setVec2(t.localAnchorA),t.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.setVec2(t.localAnchorB)}getLocalAnchorA(){return this.m_localAnchorA}getLocalAnchorB(){return this.m_localAnchorB}getReferenceAngle(){return this.m_referenceAngle}setFrequency(t){this.m_frequencyHz=t}getFrequency(){return this.m_frequencyHz}setDampingRatio(t){this.m_dampingRatio=t}getDampingRatio(){return this.m_dampingRatio}getAnchorA(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)}getAnchorB(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)}getReactionForce(t){return tt.neo(this.m_impulse.x,this.m_impulse.y).mul(t)}getReactionTorque(t){return t*this.m_impulse.z}initVelocityConstraints(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=this.m_bodyA.c_position.a,i=this.m_bodyA.c_velocity.v;let s=this.m_bodyA.c_velocity.w;const o=this.m_bodyB.c_position.a,n=this.m_bodyB.c_velocity.v;let r=this.m_bodyB.c_velocity.w;const h=Rt.neo(e),a=Rt.neo(o);this.m_rA=Rt.mulVec2(h,tt.sub(this.m_localAnchorA,this.m_localCenterA)),this.m_rB=Rt.mulVec2(a,tt.sub(this.m_localAnchorB,this.m_localCenterB));const m=this.m_invMassA,c=this.m_invMassB,l=this.m_invIA,_=this.m_invIB,u=new Ys;if(u.ex.x=m+c+this.m_rA.y*this.m_rA.y*l+this.m_rB.y*this.m_rB.y*_,u.ey.x=-this.m_rA.y*this.m_rA.x*l-this.m_rB.y*this.m_rB.x*_,u.ez.x=-this.m_rA.y*l-this.m_rB.y*_,u.ex.y=u.ey.x,u.ey.y=m+c+this.m_rA.x*this.m_rA.x*l+this.m_rB.x*this.m_rB.x*_,u.ez.y=this.m_rA.x*l+this.m_rB.x*_,u.ex.z=u.ez.x,u.ey.z=u.ez.y,u.ez.z=l+_,this.m_frequencyHz>0){u.getInverse22(this.m_mass);let i=l+_;const s=i>0?1/i:0,n=o-e-this.m_referenceAngle,r=2*$.PI*this.m_frequencyHz,h=2*s*this.m_dampingRatio*r,a=s*r*r,m=t.dt;this.m_gamma=m*(h+m*a),this.m_gamma=0!=this.m_gamma?1/this.m_gamma:0,this.m_bias=n*m*a*this.m_gamma,i+=this.m_gamma,this.m_mass.ez.z=0!=i?1/i:0}else 0==u.ez.z?(u.getInverse22(this.m_mass),this.m_gamma=0,this.m_bias=0):(u.getSymInverse33(this.m_mass),this.m_gamma=0,this.m_bias=0);if(t.warmStarting){this.m_impulse.mul(t.dtRatio);const e=tt.neo(this.m_impulse.x,this.m_impulse.y);i.subMul(m,e),s-=l*(tt.crossVec2Vec2(this.m_rA,e)+this.m_impulse.z),n.addMul(c,e),r+=_*(tt.crossVec2Vec2(this.m_rB,e)+this.m_impulse.z)}else this.m_impulse.setZero();this.m_bodyA.c_velocity.v=i,this.m_bodyA.c_velocity.w=s,this.m_bodyB.c_velocity.v=n,this.m_bodyB.c_velocity.w=r}solveVelocityConstraints(t){const e=this.m_bodyA.c_velocity.v;let i=this.m_bodyA.c_velocity.w;const s=this.m_bodyB.c_velocity.v;let o=this.m_bodyB.c_velocity.w;const n=this.m_invMassA,r=this.m_invMassB,h=this.m_invIA,a=this.m_invIB;if(this.m_frequencyHz>0){const t=o-i,m=-this.m_mass.ez.z*(t+this.m_bias+this.m_gamma*this.m_impulse.z);this.m_impulse.z+=m,i-=h*m,o+=a*m;const c=tt.zero();c.addCombine(1,s,1,tt.crossNumVec2(o,this.m_rB)),c.subCombine(1,e,1,tt.crossNumVec2(i,this.m_rA));const l=tt.neg(Ys.mulVec2(this.m_mass,c));this.m_impulse.x+=l.x,this.m_impulse.y+=l.y;const _=tt.clone(l);e.subMul(n,_),i-=h*tt.crossVec2Vec2(this.m_rA,_),s.addMul(r,_),o+=a*tt.crossVec2Vec2(this.m_rB,_)}else{const t=tt.zero();t.addCombine(1,s,1,tt.crossNumVec2(o,this.m_rB)),t.subCombine(1,e,1,tt.crossNumVec2(i,this.m_rA));const m=o-i,c=new xs(t.x,t.y,m),l=xs.neg(Ys.mulVec3(this.m_mass,c));this.m_impulse.add(l);const _=tt.neo(l.x,l.y);e.subMul(n,_),i-=h*(tt.crossVec2Vec2(this.m_rA,_)+l.z),s.addMul(r,_),o+=a*(tt.crossVec2Vec2(this.m_rB,_)+l.z)}this.m_bodyA.c_velocity.v=e,this.m_bodyA.c_velocity.w=i,this.m_bodyB.c_velocity.v=s,this.m_bodyB.c_velocity.w=o}solvePositionConstraints(t){const e=this.m_bodyA.c_position.c;let i=this.m_bodyA.c_position.a;const s=this.m_bodyB.c_position.c;let o=this.m_bodyB.c_position.a;const n=Rt.neo(i),r=Rt.neo(o),h=this.m_invMassA,a=this.m_invMassB,m=this.m_invIA,c=this.m_invIB,l=Rt.mulVec2(n,tt.sub(this.m_localAnchorA,this.m_localCenterA)),_=Rt.mulVec2(r,tt.sub(this.m_localAnchorB,this.m_localCenterB));let u,d;const p=new Ys;if(p.ex.x=h+a+l.y*l.y*m+_.y*_.y*c,p.ey.x=-l.y*l.x*m-_.y*_.x*c,p.ez.x=-l.y*m-_.y*c,p.ex.y=p.ey.x,p.ey.y=h+a+l.x*l.x*m+_.x*_.x*c,p.ez.y=l.x*m+_.x*c,p.ex.z=p.ez.x,p.ey.z=p.ez.y,p.ez.z=m+c,this.m_frequencyHz>0){const t=tt.zero();t.addCombine(1,s,1,_),t.subCombine(1,e,1,l),u=t.length(),d=0;const n=tt.neg(p.solve22(t));e.subMul(h,n),i-=m*tt.crossVec2Vec2(l,n),s.addMul(a,n),o+=c*tt.crossVec2Vec2(_,n)}else{const t=tt.zero();t.addCombine(1,s,1,_),t.subCombine(1,e,1,l);const n=o-i-this.m_referenceAngle;u=t.length(),d=$.abs(n);const r=new xs(t.x,t.y,n);let y=new xs;if(p.ez.z>0)y=xs.neg(p.solve33(r));else{const e=tt.neg(p.solve22(t));y.set(e.x,e.y,0)}const x=tt.neo(y.x,y.y);e.subMul(h,x),i-=m*(tt.crossVec2Vec2(l,x)+y.z),s.addMul(a,x),o+=c*(tt.crossVec2Vec2(_,x)+y.z)}return this.m_bodyA.c_position.c=e,this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c=s,this.m_bodyB.c_position.a=o,u<=st.linearSlop&&d<=st.angularSlop}}no.TYPE="weld-joint";const ro={enableMotor:!1,maxMotorTorque:0,motorSpeed:0,frequencyHz:2,dampingRatio:.7};class ho extends ce{constructor(t,e,i,s,o){super(t=Q(t,ro),e,i),this.m_ax=tt.zero(),this.m_ay=tt.zero(),e=this.m_bodyA,i=this.m_bodyB,this.m_type=ho.TYPE,this.m_localAnchorA=tt.clone(s?e.getLocalPoint(s):t.localAnchorA||tt.zero()),this.m_localAnchorB=tt.clone(s?i.getLocalPoint(s):t.localAnchorB||tt.zero()),this.m_localXAxisA=tt.clone(o?e.getLocalVector(o):t.localAxisA||t.localAxis||tt.neo(1,0)),this.m_localYAxisA=tt.crossNumVec2(1,this.m_localXAxisA),this.m_mass=0,this.m_impulse=0,this.m_motorMass=0,this.m_motorImpulse=0,this.m_springMass=0,this.m_springImpulse=0,this.m_maxMotorTorque=t.maxMotorTorque,this.m_motorSpeed=t.motorSpeed,this.m_enableMotor=t.enableMotor,this.m_frequencyHz=t.frequencyHz,this.m_dampingRatio=t.dampingRatio,this.m_bias=0,this.m_gamma=0}_serialize(){return{type:this.m_type,bodyA:this.m_bodyA,bodyB:this.m_bodyB,collideConnected:this.m_collideConnected,enableMotor:this.m_enableMotor,maxMotorTorque:this.m_maxMotorTorque,motorSpeed:this.m_motorSpeed,frequencyHz:this.m_frequencyHz,dampingRatio:this.m_dampingRatio,localAnchorA:this.m_localAnchorA,localAnchorB:this.m_localAnchorB,localAxisA:this.m_localXAxisA}}static _deserialize(t,e,i){(t=Object.assign({},t)).bodyA=i(ae,t.bodyA,e),t.bodyB=i(ae,t.bodyB,e);return new ho(t)}_setAnchors(t){t.anchorA?this.m_localAnchorA.setVec2(this.m_bodyA.getLocalPoint(t.anchorA)):t.localAnchorA&&this.m_localAnchorA.setVec2(t.localAnchorA),t.anchorB?this.m_localAnchorB.setVec2(this.m_bodyB.getLocalPoint(t.anchorB)):t.localAnchorB&&this.m_localAnchorB.setVec2(t.localAnchorB),t.localAxisA&&(this.m_localXAxisA.setVec2(t.localAxisA),this.m_localYAxisA.setVec2(tt.crossNumVec2(1,t.localAxisA)))}getLocalAnchorA(){return this.m_localAnchorA}getLocalAnchorB(){return this.m_localAnchorB}getLocalAxisA(){return this.m_localXAxisA}getJointTranslation(){const t=this.m_bodyA,e=this.m_bodyB,i=t.getWorldPoint(this.m_localAnchorA),s=e.getWorldPoint(this.m_localAnchorB),o=tt.sub(s,i),n=t.getWorldVector(this.m_localXAxisA);return tt.dot(o,n)}getJointSpeed(){const t=this.m_bodyA.m_angularVelocity;return this.m_bodyB.m_angularVelocity-t}isMotorEnabled(){return this.m_enableMotor}enableMotor(t){t!=this.m_enableMotor&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_enableMotor=t)}setMotorSpeed(t){t!=this.m_motorSpeed&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_motorSpeed=t)}getMotorSpeed(){return this.m_motorSpeed}setMaxMotorTorque(t){t!=this.m_maxMotorTorque&&(this.m_bodyA.setAwake(!0),this.m_bodyB.setAwake(!0),this.m_maxMotorTorque=t)}getMaxMotorTorque(){return this.m_maxMotorTorque}getMotorTorque(t){return t*this.m_motorImpulse}setSpringFrequencyHz(t){this.m_frequencyHz=t}getSpringFrequencyHz(){return this.m_frequencyHz}setSpringDampingRatio(t){this.m_dampingRatio=t}getSpringDampingRatio(){return this.m_dampingRatio}getAnchorA(){return this.m_bodyA.getWorldPoint(this.m_localAnchorA)}getAnchorB(){return this.m_bodyB.getWorldPoint(this.m_localAnchorB)}getReactionForce(t){return tt.combine(this.m_impulse,this.m_ay,this.m_springImpulse,this.m_ax).mul(t)}getReactionTorque(t){return t*this.m_motorImpulse}initVelocityConstraints(t){this.m_localCenterA=this.m_bodyA.m_sweep.localCenter,this.m_localCenterB=this.m_bodyB.m_sweep.localCenter,this.m_invMassA=this.m_bodyA.m_invMass,this.m_invMassB=this.m_bodyB.m_invMass,this.m_invIA=this.m_bodyA.m_invI,this.m_invIB=this.m_bodyB.m_invI;const e=this.m_invMassA,i=this.m_invMassB,s=this.m_invIA,o=this.m_invIB,n=this.m_bodyA.c_position.c,r=this.m_bodyA.c_position.a,h=this.m_bodyA.c_velocity.v;let a=this.m_bodyA.c_velocity.w;const m=this.m_bodyB.c_position.c,c=this.m_bodyB.c_position.a,l=this.m_bodyB.c_velocity.v;let _=this.m_bodyB.c_velocity.w;const u=Rt.neo(r),d=Rt.neo(c),p=Rt.mulVec2(u,tt.sub(this.m_localAnchorA,this.m_localCenterA)),y=Rt.mulVec2(d,tt.sub(this.m_localAnchorB,this.m_localCenterB)),x=tt.zero();if(x.addCombine(1,m,1,y),x.subCombine(1,n,1,p),this.m_ay=Rt.mulVec2(u,this.m_localYAxisA),this.m_sAy=tt.crossVec2Vec2(tt.add(x,p),this.m_ay),this.m_sBy=tt.crossVec2Vec2(y,this.m_ay),this.m_mass=e+i+s*this.m_sAy*this.m_sAy+o*this.m_sBy*this.m_sBy,this.m_mass>0&&(this.m_mass=1/this.m_mass),this.m_springMass=0,this.m_bias=0,this.m_gamma=0,this.m_frequencyHz>0){this.m_ax=Rt.mulVec2(u,this.m_localXAxisA),this.m_sAx=tt.crossVec2Vec2(tt.add(x,p),this.m_ax),this.m_sBx=tt.crossVec2Vec2(y,this.m_ax);const n=e+i+s*this.m_sAx*this.m_sAx+o*this.m_sBx*this.m_sBx;if(n>0){this.m_springMass=1/n;const e=tt.dot(x,this.m_ax),i=2*$.PI*this.m_frequencyHz,s=2*this.m_springMass*this.m_dampingRatio*i,o=this.m_springMass*i*i,r=t.dt;this.m_gamma=r*(s+r*o),this.m_gamma>0&&(this.m_gamma=1/this.m_gamma),this.m_bias=e*r*o*this.m_gamma,this.m_springMass=n+this.m_gamma,this.m_springMass>0&&(this.m_springMass=1/this.m_springMass)}}else this.m_springImpulse=0;if(this.m_enableMotor?(this.m_motorMass=s+o,this.m_motorMass>0&&(this.m_motorMass=1/this.m_motorMass)):(this.m_motorMass=0,this.m_motorImpulse=0),t.warmStarting){this.m_impulse*=t.dtRatio,this.m_springImpulse*=t.dtRatio,this.m_motorImpulse*=t.dtRatio;const e=tt.combine(this.m_impulse,this.m_ay,this.m_springImpulse,this.m_ax),i=this.m_impulse*this.m_sAy+this.m_springImpulse*this.m_sAx+this.m_motorImpulse,s=this.m_impulse*this.m_sBy+this.m_springImpulse*this.m_sBx+this.m_motorImpulse;h.subMul(this.m_invMassA,e),a-=this.m_invIA*i,l.addMul(this.m_invMassB,e),_+=this.m_invIB*s}else this.m_impulse=0,this.m_springImpulse=0,this.m_motorImpulse=0;this.m_bodyA.c_velocity.v.setVec2(h),this.m_bodyA.c_velocity.w=a,this.m_bodyB.c_velocity.v.setVec2(l),this.m_bodyB.c_velocity.w=_}solveVelocityConstraints(t){const e=this.m_invMassA,i=this.m_invMassB,s=this.m_invIA,o=this.m_invIB,n=this.m_bodyA.c_velocity.v;let r=this.m_bodyA.c_velocity.w;const h=this.m_bodyB.c_velocity.v;let a=this.m_bodyB.c_velocity.w;{const t=tt.dot(this.m_ax,h)-tt.dot(this.m_ax,n)+this.m_sBx*a-this.m_sAx*r,m=-this.m_springMass*(t+this.m_bias+this.m_gamma*this.m_springImpulse);this.m_springImpulse+=m;const c=tt.mulNumVec2(m,this.m_ax),l=m*this.m_sAx,_=m*this.m_sBx;n.subMul(e,c),r-=s*l,h.addMul(i,c),a+=o*_}{const e=a-r-this.m_motorSpeed;let i=-this.m_motorMass*e;const n=this.m_motorImpulse,h=t.dt*this.m_maxMotorTorque;this.m_motorImpulse=$.clamp(this.m_motorImpulse+i,-h,h),i=this.m_motorImpulse-n,r-=s*i,a+=o*i}{const t=tt.dot(this.m_ay,h)-tt.dot(this.m_ay,n)+this.m_sBy*a-this.m_sAy*r,m=-this.m_mass*t;this.m_impulse+=m;const c=tt.mulNumVec2(m,this.m_ay),l=m*this.m_sAy,_=m*this.m_sBy;n.subMul(e,c),r-=s*l,h.addMul(i,c),a+=o*_}this.m_bodyA.c_velocity.v.setVec2(n),this.m_bodyA.c_velocity.w=r,this.m_bodyB.c_velocity.v.setVec2(h),this.m_bodyB.c_velocity.w=a}solvePositionConstraints(t){const e=this.m_bodyA.c_position.c;let i=this.m_bodyA.c_position.a;const s=this.m_bodyB.c_position.c;let o=this.m_bodyB.c_position.a;const n=Rt.neo(i),r=Rt.neo(o),h=Rt.mulVec2(n,tt.sub(this.m_localAnchorA,this.m_localCenterA)),a=Rt.mulVec2(r,tt.sub(this.m_localAnchorB,this.m_localCenterB)),m=tt.zero();m.addCombine(1,s,1,a),m.subCombine(1,e,1,h);const c=Rt.mulVec2(n,this.m_localYAxisA),l=tt.crossVec2Vec2(tt.add(m,h),c),_=tt.crossVec2Vec2(a,c),u=tt.dot(m,c),d=this.m_invMassA+this.m_invMassB+this.m_invIA*this.m_sAy*this.m_sAy+this.m_invIB*this.m_sBy*this.m_sBy;let p;p=0!=d?-u/d:0;const y=tt.mulNumVec2(p,c),x=p*l,f=p*_;return e.subMul(this.m_invMassA,y),i-=this.m_invIA*x,s.addMul(this.m_invMassB,y),o+=this.m_invIB*f,this.m_bodyA.c_position.c.setVec2(e),this.m_bodyA.c_position.a=i,this.m_bodyB.c_position.c.setVec2(s),this.m_bodyB.c_position.a=o,$.abs(u)<=st.linearSlop}}ho.TYPE="wheel-joint";let ao=0;function mo(t){const e=(t=t||{}).rootClass||ys,i=t.preSerialize||function(t){return t},s=t.postSerialize||function(t,e){return t},o=t.preDeserialize||function(t){return t},n=t.postDeserialize||function(t,e){return t},r={World:ys,Body:ae,Joint:ce,Fixture:Qt,Shape:Xt},h=Object.assign({Vec2:tt,Vec3:xs},r),a={[ae.STATIC]:ae,[ae.DYNAMIC]:ae,[ae.KINEMATIC]:ae,[ws.TYPE]:ws,[ks.TYPE]:ks,[vs.TYPE]:vs,[zs.TYPE]:zs,[Ds.TYPE]:Ds,[Ns.TYPE]:Ns,[Os.TYPE]:Os,[Zs.TYPE]:Zs,[Gs.TYPE]:Gs,[$s.TYPE]:$s,[Hs.TYPE]:Hs,[eo.TYPE]:eo,[Js.TYPE]:Js,[so.TYPE]:so,[no.TYPE]:no,[ho.TYPE]:ho};this.toJson=function(t){const e=[],o=[t],n={};function h(t,i){if(t.__sid=t.__sid||++ao,!n[t.__sid]){o.push(t);const s={refIndex:e.length+o.length,refType:i};n[t.__sid]=s}return n[t.__sid]}function a(t,e){if("object"!=typeof t||null===t)return t;if("function"==typeof t._serialize){if(t!==e)for(const e in r)if(t instanceof r[e])return h(t,e);t=function(t){let e=(t=i(t))._serialize();return e=s(e,t),e}(t)}if(Array.isArray(t)){const e=[];for(let i=0;i<t.length;i++)e[i]=a(t[i]);t=e}else{const e={};for(const i in t)t.hasOwnProperty(i)&&(e[i]=a(t[i]));t=e}return t}for(;o.length;){const t=o.shift(),i=a(t,t);e.push(i)}return e},this.fromJson=function(t){const i={};function s(t,e,i){const s=function(t,e){return e&&e._deserialize||(e=a[t.type]),e&&e._deserialize}(e,t);if(!s)return;let h=s(e=o(e),i,r);return h=n(h,e),h}function r(e,o,n){if(!o.refIndex)return e&&e._deserialize&&s(e,o,n);e=h[o.refType]||e;const r=o.refIndex;if(!i[r]){const o=s(e,t[r],n);i[r]=o}return i[r]}return e._deserialize(t[0],null,r)}}const co=new mo;mo.toJson=co.toJson,mo.fromJson=co.fromJson,ds.addType(Ds.TYPE,Ds.TYPE,(function(t,e,i,s,o,n,r){uo(t,i.getShape(),e,n.getShape(),o)}));const lo=ct(0,0),_o=ct(0,0),uo=function(e,i,s,o,n){e.pointCount=0,Lt(lo,s,i.m_p),Lt(_o,n,o.m_p);const r=Pt(_o,lo),h=i.m_radius+o.m_radius;r>h*h||(e.type=t.ManifoldType.e_circles,_t(e.localPoint,i.m_p),ut(e.localNormal),e.pointCount=1,_t(e.points[0].localPoint,o.m_p),e.points[0].id.setFeatures(0,t.ContactFeatureType.e_vertex,0,t.ContactFeatureType.e_vertex))};ds.addType(vs.TYPE,Ds.TYPE,(function(t,e,i,s,o,n,r){const h=i.getShape(),a=n.getShape();Ao(t,h,e,a,o)})),ds.addType(ws.TYPE,Ds.TYPE,(function(t,e,i,s,o,n,r){const h=i.getShape(),a=new vs;h.getChildEdge(a,s);const m=a,c=n.getShape();Ao(t,m,e,c,o)}));const po=ct(0,0),yo=ct(0,0),xo=ct(0,0),fo=ct(0,0),go=ct(0,0),vo=ct(0,0),Ao=function(e,i,s,o,n){e.pointCount=0,Dt(fo,n,s,o.m_p);const r=i.m_vertex1,h=i.m_vertex2;xt(po,h,r);const a=Vt(po,h)-Vt(po,fo),m=Vt(po,fo)-Vt(po,r),c=i.m_radius+o.m_radius;if(m<=0){_t(go,r);if(Pt(fo,r)>c*c)return;if(i.m_hasVertex0){const t=i.m_vertex0,e=r;xt(yo,e,t);if(Vt(yo,e)-Vt(yo,fo)>0)return}return e.type=t.ManifoldType.e_circles,ut(e.localNormal),_t(e.localPoint,go),e.pointCount=1,_t(e.points[0].localPoint,o.m_p),void e.points[0].id.setFeatures(0,t.ContactFeatureType.e_vertex,0,t.ContactFeatureType.e_vertex)}if(a<=0){_t(go,h);if(Pt(fo,go)>c*c)return;if(i.m_hasVertex3){const t=i.m_vertex3,e=h;xt(xo,t,e);if(Vt(xo,fo)-Vt(xo,e)>0)return}return e.type=t.ManifoldType.e_circles,ut(e.localNormal),_t(e.localPoint,go),e.pointCount=1,_t(e.points[0].localPoint,o.m_p),void e.points[0].id.setFeatures(1,t.ContactFeatureType.e_vertex,0,t.ContactFeatureType.e_vertex)}const l=It(po);bt(go,a/l,r,m/l,h);Pt(fo,go)>c*c||(Ct(vo,1,po),Vt(vo,fo)-Vt(vo,r)<0&&dt(vo),Bt(vo),e.type=t.ManifoldType.e_faceA,_t(e.localNormal,vo),_t(e.localPoint,r),e.pointCount=1,_t(e.points[0].localPoint,o.m_p),e.points[0].id.setFeatures(0,t.ContactFeatureType.e_face,0,t.ContactFeatureType.e_vertex))},bo=[new Vi,new Vi],Bo=[new Vi,new Vi],wo=[new Vi,new Vi],Co=ct(0,0),Mo=ct(0,0),Vo=ct(0,0),Io=Ft(0,0,0),So=ct(0,0),Po=ct(0,0),To=ct(0,0),zo=ct(0,0),Fo=ct(0,0),ko=ct(0,0),Lo=ct(0,0),qo=ct(0,0);function Do(t,e,i,s,o){const n=t.m_count,r=i.m_count,h=t.m_normals,a=t.m_vertices,m=i.m_vertices;jt(Io,s,e);let c=0,l=-1/0;for(let t=0;t<n;++t){Tt(Vo,Io.q,h[t]),Lt(Mo,Io,a[t]);let e=1/0;for(let t=0;t<r;++t){const i=Vt(Vo,m[t])-Vt(Vo,Mo);i<e&&(e=i)}e>l&&(l=e,c=t)}o.maxSeparation=l,o.bestIndex=c}ds.addType(zs.TYPE,zs.TYPE,(function(t,e,i,s,o,n,r){Ro(t,i.getShape(),e,n.getShape(),o)}));const jo={maxSeparation:0,bestIndex:0},Ro=function(e,i,s,o,n){e.pointCount=0;const r=i.m_radius+o.m_radius;Do(i,s,o,n,jo);const h=jo.bestIndex,a=jo.maxSeparation;if(a>r)return;Do(o,n,i,s,jo);const m=jo.maxSeparation;if(m>r)return;let c,l,_,u,d,p;m>a+.1*st.linearSlop?(c=o,l=i,_=n,u=s,d=jo.bestIndex,e.type=t.ManifoldType.e_faceB,p=!0):(c=i,l=o,_=s,u=n,d=h,e.type=t.ManifoldType.e_faceA,p=!1),bo[0].recycle(),bo[1].recycle(),function(e,i,s,o,n,r){const h=i.m_normals,a=n.m_count,m=n.m_vertices,c=n.m_normals;!function(t,e,i,s){const o=e.c*s.x+e.s*s.y,n=-e.s*s.x+e.c*s.y,r=i.c*o-i.s*n,h=i.s*o+i.c*n;t.x=r,t.y=h}(qo,r.q,s.q,h[o]);let l=0,_=1/0;for(let t=0;t<a;++t){const e=Vt(qo,c[t]);e<_&&(_=e,l=t)}const u=l,d=u+1<a?u+1:0;Lt(e[0].v,r,m[u]),e[0].id.setFeatures(o,t.ContactFeatureType.e_face,u,t.ContactFeatureType.e_vertex),Lt(e[1].v,r,m[d]),e[1].id.setFeatures(o,t.ContactFeatureType.e_face,d,t.ContactFeatureType.e_vertex)}(bo,c,_,d,l,u);const y=c.m_count,x=c.m_vertices,f=d,g=d+1<y?d+1:0;_t(So,x[f]),_t(Po,x[g]),xt(To,Po,So),Bt(To),wt(zo,To,1),bt(Fo,.5,So,.5,Po),Tt(ko,_.q,To),wt(Lo,ko,1),Lt(So,_,So),Lt(Po,_,Po);const v=Vt(Lo,So),A=-Vt(ko,So)+r,b=Vt(ko,Po)+r;Bo[0].recycle(),Bo[1].recycle(),wo[0].recycle(),wo[1].recycle(),lt(Co,-ko.x,-ko.y);if(Fi(Bo,bo,Co,A,f)<2)return;lt(Co,ko.x,ko.y);if(Fi(wo,Bo,Co,b,g)<2)return;_t(e.localNormal,zo),_t(e.localPoint,Fo);let B=0;for(let t=0;t<wo.length;++t){if(Vt(Lo,wo[t].v)-v<=r){const i=e.points[B];qt(i.localPoint,u,wo[t].v),i.id.set(wo[t].id),p&&i.id.swapFeatures(),++B}}e.pointCount=B};ds.addType(zs.TYPE,Ds.TYPE,(function(t,e,i,s,o,n,r){Oo(t,i.getShape(),e,n.getShape(),o)}));const No=ct(0,0),Eo=ct(0,0),Oo=function(e,i,s,o,n){e.pointCount=0,Dt(No,n,s,o.m_p);let r=0,h=-1/0;const a=i.m_radius+o.m_radius,m=i.m_count,c=i.m_vertices,l=i.m_normals;for(let t=0;t<m;++t){const e=Vt(l[t],No)-Vt(l[t],c[t]);if(e>a)return;e>h&&(h=e,r=t)}const _=r,u=_+1<m?_+1:0,d=c[_],p=c[u];if(h<$.EPSILON)return e.pointCount=1,e.type=t.ManifoldType.e_faceA,_t(e.localNormal,l[r]),bt(e.localPoint,.5,d,.5,p),_t(e.points[0].localPoint,o.m_p),void e.points[0].id.setFeatures(0,t.ContactFeatureType.e_vertex,0,t.ContactFeatureType.e_vertex);const y=Vt(No,p)-Vt(No,d)-Vt(d,p)+Vt(d,d),x=Vt(No,d)-Vt(No,p)-Vt(p,d)+Vt(p,p);if(y<=0){if(Pt(No,d)>a*a)return;e.pointCount=1,e.type=t.ManifoldType.e_faceA,xt(e.localNormal,No,d),Bt(e.localNormal),_t(e.localPoint,d),_t(e.points[0].localPoint,o.m_p),e.points[0].id.setFeatures(0,t.ContactFeatureType.e_vertex,0,t.ContactFeatureType.e_vertex)}else if(x<=0){if(Pt(No,p)>a*a)return;e.pointCount=1,e.type=t.ManifoldType.e_faceA,xt(e.localNormal,No,p),Bt(e.localNormal),_t(e.localPoint,p),_t(e.points[0].localPoint,o.m_p),e.points[0].id.setFeatures(0,t.ContactFeatureType.e_vertex,0,t.ContactFeatureType.e_vertex)}else{bt(Eo,.5,d,.5,p);if(Vt(No,l[_])-Vt(Eo,l[_])>a)return;e.pointCount=1,e.type=t.ManifoldType.e_faceA,_t(e.localNormal,l[_]),_t(e.localPoint,Eo),_t(e.points[0].localPoint,o.m_p),e.points[0].id.setFeatures(0,t.ContactFeatureType.e_vertex,0,t.ContactFeatureType.e_vertex)}};ds.addType(vs.TYPE,zs.TYPE,(function(t,e,i,s,o,n,r){dn(t,i.getShape(),e,n.getShape(),o)})),ds.addType(ws.TYPE,zs.TYPE,(function(t,e,i,s,o,n,r){i.getShape().getChildEdge(Yo,s),dn(t,Yo,e,n.getShape(),o)}));const Yo=new vs;var Wo,Jo;!function(t){t[t.e_unknown=-1]="e_unknown",t[t.e_edgeA=1]="e_edgeA",t[t.e_edgeB=2]="e_edgeB"}(Wo||(Wo={})),function(t){t[t.e_isolated=0]="e_isolated",t[t.e_concave=1]="e_concave",t[t.e_convex=2]="e_convex"}(Jo||(Jo={}));class Xo{}const Ho=[new Vi,new Vi],Ko=[new Vi,new Vi],Zo=[new Vi,new Vi],Uo=new Xo,Go=new Xo,Qo=new class{constructor(){this.vertices=[],this.normals=[],this.count=0;for(let t=0;t<st.maxPolygonVertices;t++)this.vertices.push(ct(0,0)),this.normals.push(ct(0,0))}},$o=new class{constructor(){this.v1=ct(0,0),this.v2=ct(0,0),this.normal=ct(0,0),this.sideNormal1=ct(0,0),this.sideNormal2=ct(0,0)}recycle(){ut(this.v1),ut(this.v2),ut(this.normal),ut(this.sideNormal1),ut(this.sideNormal2)}},tn=ct(0,0),en=ct(0,0),sn=ct(0,0),on=ct(0,0),nn=Ft(0,0,0),rn=ct(0,0),hn=ct(0,0),an=ct(0,0),mn=ct(0,0),cn=ct(0,0),ln=ct(0,0),_n=ct(0,0),un=ct(0,0),dn=function(e,i,s,o,n){jt(nn,s,n),Lt(tn,nn,o.m_centroid);const r=i.m_vertex0,h=i.m_vertex1,a=i.m_vertex2,m=i.m_vertex3,c=i.m_hasVertex0,l=i.m_hasVertex3;xt(sn,a,h),Bt(sn),lt(an,sn.y,-sn.x);const _=Vt(an,tn)-Vt(an,h);let u,d=0,p=0,y=!1,x=!1;ut(hn),ut(mn),c&&(xt(en,h,r),Bt(en),lt(hn,en.y,-en.x),y=Mt(en,sn)>=0,d=tt.dot(hn,tn)-tt.dot(hn,r)),l&&(xt(on,m,a),Bt(on),lt(mn,on.y,-on.x),x=tt.crossVec2Vec2(sn,on)>0,p=tt.dot(mn,tn)-tt.dot(mn,a)),ut(rn),ut(cn),ut(ln),c&&l?y&&x?(u=d>=0||_>=0||p>=0,u?(_t(rn,an),_t(cn,hn),_t(ln,mn)):(gt(rn,-1,an),gt(cn,-1,an),gt(ln,-1,an))):y?(u=d>=0||_>=0&&p>=0,u?(_t(rn,an),_t(cn,hn),_t(ln,an)):(gt(rn,-1,an),gt(cn,-1,mn),gt(ln,-1,an))):x?(u=p>=0||d>=0&&_>=0,u?(_t(rn,an),_t(cn,an),_t(ln,mn)):(gt(rn,-1,an),gt(cn,-1,an),gt(ln,-1,hn))):(u=d>=0&&_>=0&&p>=0,u?(_t(rn,an),_t(cn,an),_t(ln,an)):(gt(rn,-1,an),gt(cn,-1,mn),gt(ln,-1,hn))):c?y?(u=d>=0||_>=0,u?(_t(rn,an),_t(cn,hn),gt(ln,-1,an)):(gt(rn,-1,an),_t(cn,an),gt(ln,-1,an))):(u=d>=0&&_>=0,u?(_t(rn,an),_t(cn,an),gt(ln,-1,an)):(gt(rn,-1,an),_t(cn,an),gt(ln,-1,hn))):l?x?(u=_>=0||p>=0,u?(_t(rn,an),gt(cn,-1,an),_t(ln,mn)):(gt(rn,-1,an),gt(cn,-1,an),_t(ln,an))):(u=_>=0&&p>=0,u?(_t(rn,an),gt(cn,-1,an),_t(ln,an)):(gt(rn,-1,an),gt(cn,-1,mn),_t(ln,an))):(u=_>=0,u?(_t(rn,an),gt(cn,-1,an),gt(ln,-1,an)):(gt(rn,-1,an),_t(cn,an),_t(ln,an))),Qo.count=o.m_count;for(let t=0;t<o.m_count;++t)Lt(Qo.vertices[t],nn,o.m_vertices[t]),Tt(Qo.normals[t],nn.q,o.m_normals[t]);const f=o.m_radius+i.m_radius;e.pointCount=0,Uo.type=Wo.e_edgeA,Uo.index=u?0:1,Uo.separation=1/0;for(let t=0;t<Qo.count;++t){const e=Qo.vertices[t],i=Vt(rn,e)-Vt(rn,h);i<Uo.separation&&(Uo.separation=i)}if(Uo.type==Wo.e_unknown)return;if(Uo.separation>f)return;Go.type=Wo.e_unknown,Go.index=-1,Go.separation=-1/0,lt(_n,-rn.y,rn.x);for(let t=0;t<Qo.count;++t){gt(un,-1,Qo.normals[t]);const e=Vt(un,Qo.vertices[t])-Vt(un,h),i=Vt(un,Qo.vertices[t])-Vt(un,a),s=Math.min(e,i);if(s>f){Go.type=Wo.e_edgeB,Go.index=t,Go.separation=s;break}if(Vt(un,_n)>=0){if(Vt(un,rn)-Vt(ln,rn)<-st.angularSlop)continue}else if(Vt(un,rn)-Vt(cn,rn)<-st.angularSlop)continue;s>Go.separation&&(Go.type=Wo.e_edgeB,Go.index=t,Go.separation=s)}if(Go.type!=Wo.e_unknown&&Go.separation>f)return;let g;if(g=Go.type==Wo.e_unknown?Uo:Go.separation>.98*Uo.separation+.001?Go:Uo,Zo[0].recycle(),Zo[1].recycle(),g.type==Wo.e_edgeA){e.type=t.ManifoldType.e_faceA;let i=0,s=Vt(rn,Qo.normals[0]);for(let t=1;t<Qo.count;++t){const e=Vt(rn,Qo.normals[t]);e<s&&(s=e,i=t)}const o=i,n=o+1<Qo.count?o+1:0;_t(Zo[0].v,Qo.vertices[o]),Zo[0].id.setFeatures(0,t.ContactFeatureType.e_face,o,t.ContactFeatureType.e_vertex),_t(Zo[1].v,Qo.vertices[n]),Zo[1].id.setFeatures(0,t.ContactFeatureType.e_face,n,t.ContactFeatureType.e_vertex),u?($o.i1=0,$o.i2=1,_t($o.v1,h),_t($o.v2,a),_t($o.normal,an)):($o.i1=1,$o.i2=0,_t($o.v1,a),_t($o.v2,h),gt($o.normal,-1,an))}else e.type=t.ManifoldType.e_faceB,_t(Zo[0].v,h),Zo[0].id.setFeatures(0,t.ContactFeatureType.e_vertex,g.index,t.ContactFeatureType.e_face),_t(Zo[1].v,a),Zo[1].id.setFeatures(0,t.ContactFeatureType.e_vertex,g.index,t.ContactFeatureType.e_face),$o.i1=g.index,$o.i2=$o.i1+1<Qo.count?$o.i1+1:0,_t($o.v1,Qo.vertices[$o.i1]),_t($o.v2,Qo.vertices[$o.i2]),_t($o.normal,Qo.normals[$o.i1]);lt($o.sideNormal1,$o.normal.y,-$o.normal.x),lt($o.sideNormal2,-$o.sideNormal1.x,-$o.sideNormal1.y),$o.sideOffset1=Vt($o.sideNormal1,$o.v1),$o.sideOffset2=Vt($o.sideNormal2,$o.v2),Ho[0].recycle(),Ho[1].recycle(),Ko[0].recycle(),Ko[1].recycle();if(Fi(Ho,Zo,$o.sideNormal1,$o.sideOffset1,$o.i1)<st.maxManifoldPoints)return;if(Fi(Ko,Ho,$o.sideNormal2,$o.sideOffset2,$o.i2)<st.maxManifoldPoints)return;g.type==Wo.e_edgeA?(_t(e.localNormal,$o.normal),_t(e.localPoint,$o.v1)):(_t(e.localNormal,o.m_normals[$o.i1]),_t(e.localPoint,o.m_vertices[$o.i1]));let v=0;for(let t=0;t<st.maxManifoldPoints;++t){if(Vt($o.normal,Ko[t].v)-Vt($o.normal,$o.v1)<=f){const i=e.points[v];g.type==Wo.e_edgeA?(qt(i.localPoint,nn,Ko[t].v),i.id.set(Ko[t].id)):(_t(i.localPoint,Ko[t].v),i.id.set(Ko[t].id),i.id.swapFeatures()),++v}}e.pointCount=v},pn=$,yn={CollidePolygons:Ro,Settings:st,Sweep:Et,Manifold:Ii,Distance:we,TimeOfImpact:ti,DynamicTree:ht,stats:le},xn=function(t){var e,i;return null!==(i=null!==(e=t.render)&&void 0!==e?e:t.style)&&void 0!==i?i:{}};class fn{constructor(){this.width=80,this.height=60,this.x=0,this.y=-10,this.scaleY=-1,this.hz=60,this.speed=1,this.ratio=16,this.background="#222222",this.activeKeys={},this.step=(t,e)=>{},this.keydown=(t,e)=>{},this.keyup=(t,e)=>{},this.paused=!1,this.lastDrawHash="",this.newDrawHash="",this.buffer=[],this.start=t=>{const e=this.stage=G.mount(),i=this.canvas=e.dom,s=this;this.canvas=i,e.on(G.Mouse.START,(()=>{var t;window.focus(),null===(t=document.activeElement)||void 0===t||t.blur(),i.focus()})),e.MAX_ELAPSE=1e3/30,e.on("resume",(()=>{this.paused=!1,this._resume()})),e.on("pause",(()=>{this.paused=!0,this._pause()}));const o=new G.Texture;e.append(G.sprite(o)),e.tick((()=>{this.buffer.length=0}),!0),o.draw=t=>{t.save(),t.transform(1,0,0,this.scaleY,-this.x,-this.y),t.lineWidth=2/this.ratio,t.lineCap="round";for(let e=this.buffer.shift();e;e=this.buffer.shift())e(t,this.ratio);t.restore()};const n=new gn(t,this);let r=0,h=0;e.tick(((t,e)=>{r===this.x&&h===this.y||(n.offset(-this.x,-this.y),r=this.x,h=this.y)})),n.tick(((t,i)=>(this.step(t,i),c&&this.drawSegment(c.getPosition(),l,"rgba(255,255,255,0.2)"),this.lastDrawHash!==this.newDrawHash&&(this.lastDrawHash=this.newDrawHash,e.touch()),this.newDrawHash="",!0))),e.background(this.background),e.viewbox(this.width,this.height),e.pin("alignX",-.5),e.pin("alignY",-.5),e.prepend(n);const a=t.createBody();let m=null,c=null;const l={x:0,y:0};n.attr("spy",!0),n.on(G.Mouse.START,(e=>{if(e={x:e.x,y:s.scaleY*e.y},c)return;const i=function(t,e){let i=null;const s=new et(e,e);return t.queryAABB(s,(t=>!t.getBody().isDynamic()||!t.testPoint(e)||(i=t.getBody(),!1))),i}(t,e);i&&(this.mouseForce?c=i:(m=new $s({maxForce:1e3},a,i,tt.clone(e)),t.createJoint(m)))})),n.on(G.Mouse.MOVE,(t=>{t={x:t.x,y:s.scaleY*t.y},m&&m.setTarget(t),l.x=t.x,l.y=t.y})),n.on(G.Mouse.END,(e=>{if(e={x:e.x,y:s.scaleY*e.y},m&&(t.destroyJoint(m),m=null),c&&this.mouseForce){const t=tt.sub(e,c.getPosition());c.applyForceToCenter(t.mul(this.mouseForce),!0),c=null}})),n.on(G.Mouse.CANCEL,(e=>{e={x:e.x,y:s.scaleY*e.y},m&&(t.destroyJoint(m),m=null),c&&(c=null)})),window.addEventListener("keydown",(t=>{switch(t.keyCode){case"P".charCodeAt(0):this.togglePause()}}),!1);const _=s.activeKeys,u={};function d(t,e){const i=String.fromCharCode(t);/\w/.test(i)&&(_[i]=e),_.right=u[39]||_.D,_.left=u[37]||_.A,_.up=u[38]||_.W,_.down=u[40]||_.S,_.fire=u[32]||u[13]}window.addEventListener("keydown",(function(t){const e=t.keyCode;u[e]=!0,d(e,!0),s.keydown&&s.keydown(e,String.fromCharCode(e))})),window.addEventListener("keyup",(function(t){const e=t.keyCode;u[e]=!1,d(e,!1),s.keyup&&s.keyup(e,String.fromCharCode(e))})),this.resume()},this.focus=()=>{document.activeElement&&document.activeElement.blur(),this.canvas.focus()},this._pause=()=>{},this._resume=()=>{},this._status=t=>{},this._info=t=>{},this.isPaused=()=>this.paused,this.togglePause=()=>{this.paused?this.resume():this.pause()},this.pause=()=>{this.stage.pause()},this.resume=()=>{this.stage.resume(),this.focus()},this.statusText="",this.statusMap={},this.info=t=>{this._info(t)},this.drawPoint=(t,e,i)=>{this.buffer.push((function(e,s){e.beginPath(),e.arc(t.x,t.y,5/s,0,2*Math.PI),e.strokeStyle=i,e.stroke()})),this.newDrawHash+="point"+t.x+","+t.y+","+e+","+i},this.drawCircle=(t,e,i)=>{this.buffer.push((function(s){s.beginPath(),s.arc(t.x,t.y,e,0,2*Math.PI),s.strokeStyle=i,s.stroke()})),this.newDrawHash+="circle"+t.x+","+t.y+","+e+","+i},this.drawEdge=(t,e,i)=>{this.buffer.push((function(s){s.beginPath(),s.moveTo(t.x,t.y),s.lineTo(e.x,e.y),s.strokeStyle=i,s.stroke()})),this.newDrawHash+="segment"+t.x+","+t.y+","+e.x+","+e.y+","+i},this.drawSegment=this.drawEdge,this.drawPolygon=(t,e)=>{if(t&&t.length){this.buffer.push((function(i){i.beginPath(),i.moveTo(t[0].x,t[0].y);for(let e=1;e<t.length;e++)i.lineTo(t[e].x,t[e].y);i.strokeStyle=e,i.closePath(),i.stroke()})),this.newDrawHash+="segment";for(let e=1;e<t.length;e++)this.newDrawHash+=t[e].x+","+t[e].y+",";this.newDrawHash+=e}},this.drawAABB=(t,e)=>{this.buffer.push((function(i){i.beginPath(),i.moveTo(t.lowerBound.x,t.lowerBound.y),i.lineTo(t.upperBound.x,t.lowerBound.y),i.lineTo(t.upperBound.x,t.upperBound.y),i.lineTo(t.lowerBound.x,t.upperBound.y),i.strokeStyle=e,i.closePath(),i.stroke()})),this.newDrawHash+="aabb",this.newDrawHash+=t.lowerBound.x+","+t.lowerBound.y+",",this.newDrawHash+=t.upperBound.x+","+t.upperBound.y+",",this.newDrawHash+=e},this.color=function(t,e,i){return"rgb("+(t=256*t|0)+", "+(e=256*e|0)+", "+(i=256*i|0)+")"},this.findOne=t=>null,this.findAll=t=>[]}statusSet(t,e){"function"!=typeof e&&"object"!=typeof e&&(this.statusMap[t]=e)}status(t,e){if(void 0!==e)this.statusSet(t,e);else if(t&&"object"==typeof t)for(const e in t)this.statusSet(e,t[e]);else"string"==typeof t&&(this.statusText=t);var i=this.statusText||"";for(var s in this.statusMap){var o=this.statusMap[s];"function"!=typeof o&&(i+=(i&&"\n")+s+": "+o)}this._status(i)}}class gn extends G.Node{constructor(t,e={}){var i,s,o,n;super(),this.nodes=new WeakMap,this.options={speed:1,hz:60,scaleY:-1,ratio:16,lineWidth:1,stroke:void 0,fill:void 0},this.renderWorld=()=>{const t=this.world,e=this.options,i=this;for(let s=t.getBodyList();s;s=s.getNext())for(let t=s.getFixtureList();t;t=t.getNext()){let o=this.nodes.get(t);const n=xn(t),r=xn(s);if(!o){n&&n.stroke?e.stroke=n.stroke:r&&r.stroke?e.stroke=r.stroke:s.isDynamic()?e.stroke="rgba(255,255,255,0.9)":s.isKinematic()?e.stroke="rgba(255,255,255,0.7)":s.isStatic()&&(e.stroke="rgba(255,255,255,0.5)"),n&&n.fill?e.fill=n.fill:r&&r.fill?e.fill=r.fill:e.fill="";const h=t.getType(),a=t.getShape();"circle"==h&&(o=i.drawCircle(a,e)),"edge"==h&&(o=i.drawEdge(a,e)),"polygon"==h&&(o=i.drawPolygon(a,e)),"chain"==h&&(o=i.drawChain(a,e)),o&&(o.appendTo(i),this.nodes.set(t,o))}if(o){const t=s.getPosition(),i=s.getAngle();(o.__lastX!==t.x||o.__lastY!==t.y||o.__lastR!==i)&&(o.__lastX=t.x,o.__lastY=t.y,o.__lastR=i,o.offset(t.x,e.scaleY*t.y),o.rotate(e.scaleY*i))}}for(let s=t.getJointList();s;s=s.getNext()){s.getType();const t=s.getAnchorA(),o=s.getAnchorB();let n=this.nodes.get(s);if(n||(e.stroke="rgba(255,255,255,0.2)",n=i.drawJoint(s,e),n.pin("handle",.5),n.appendTo(i),this.nodes.set(s,n)),n){const i=.5*(t.x+o.x),s=e.scaleY*(t.y+o.y)*.5,r=t.x-o.x,h=e.scaleY*(t.y-o.y),a=Math.sqrt(r*r+h*h);n.width(a),n.rotate(Math.atan2(h,r)),n.offset(i,s)}}},this.drawJoint=(t,e)=>{const i=e.lineWidth,s=e.ratio,o=G.canvas((function(t){var o;this.size(10+2*i,2*i,s),t.scale(s,s),t.beginPath(),t.moveTo(i,i),t.lineTo(i+10,i),t.lineCap="round",t.lineWidth=e.lineWidth,t.strokeStyle=null!==(o=e.stroke)&&void 0!==o?o:"",t.stroke()}));return G.sprite(o).stretch()},this.drawCircle=(t,e)=>{const i=e.lineWidth,s=e.ratio,o=t.m_radius,n=o+i,r=o+i,h=2*o+2*i,a=2*o+2*i,m=G.canvas((function(t){var i;this.size(h,a,s),t.scale(s,s),t.arc(n,r,o,0,2*Math.PI),e.fill&&(t.fillStyle=e.fill,t.fill()),t.lineTo(n,r),t.lineWidth=e.lineWidth,t.strokeStyle=null!==(i=e.stroke)&&void 0!==i?i:"",t.stroke()})),c=G.sprite(m).offset(t.m_p.x-n,e.scaleY*t.m_p.y-r);return G.create().append(c)},this.drawEdge=(t,e)=>{const i=e.lineWidth,s=e.ratio,o=t.m_vertex1,n=t.m_vertex2,r=n.x-o.x,h=n.y-o.y,a=Math.sqrt(r*r+h*h),m=G.canvas((function(t){var o;this.size(a+2*i,2*i,s),t.scale(s,s),t.beginPath(),t.moveTo(i,i),t.lineTo(i+a,i),t.lineCap="round",t.lineWidth=e.lineWidth,t.strokeStyle=null!==(o=e.stroke)&&void 0!==o?o:"",t.stroke()})),c=Math.min(o.x,n.x),l=Math.min(e.scaleY*o.y,e.scaleY*n.y),_=G.sprite(m);_.rotate(e.scaleY*Math.atan2(h,r)),_.offset(c-i,l-i);return G.create().append(_)},this.drawPolygon=(t,e)=>{const i=e.lineWidth,s=e.ratio,o=t.m_vertices;if(!o.length)return;let n=1/0,r=1/0,h=-1/0,a=-1/0;for(let t=0;t<o.length;++t){const i=o[t];n=Math.min(n,i.x),h=Math.max(h,i.x),r=Math.min(r,e.scaleY*i.y),a=Math.max(a,e.scaleY*i.y)}const m=h-n,c=a-r,l=G.canvas((function(t){var h;this.size(m+2*i,c+2*i,s),t.scale(s,s),t.beginPath();for(let s=0;s<o.length;++s){const h=o[s],a=h.x-n+i,m=e.scaleY*h.y-r+i;0==s?t.moveTo(a,m):t.lineTo(a,m)}o.length>2&&t.closePath(),e.fill&&(t.fillStyle=e.fill,t.fill(),t.closePath()),t.lineCap="round",t.lineWidth=e.lineWidth,t.strokeStyle=null!==(h=e.stroke)&&void 0!==h?h:"",t.stroke()})),_=G.sprite(l);_.offset(n-i,r-i);return G.create().append(_)},this.drawChain=(t,e)=>{const i=e.lineWidth,s=e.ratio,o=t.m_vertices;if(!o.length)return;let n=1/0,r=1/0,h=-1/0,a=-1/0;for(let t=0;t<o.length;++t){const i=o[t];n=Math.min(n,i.x),h=Math.max(h,i.x),r=Math.min(r,e.scaleY*i.y),a=Math.max(a,e.scaleY*i.y)}const m=h-n,c=a-r,l=G.canvas((function(t){var h;this.size(m+2*i,c+2*i,s),t.scale(s,s),t.beginPath();for(let s=0;s<o.length;++s){const h=o[s],a=h.x-n+i,m=e.scaleY*h.y-r+i;0==s?t.moveTo(a,m):t.lineTo(a,m)}o.length,e.fill&&(t.fillStyle=e.fill,t.fill(),t.closePath()),t.lineCap="round",t.lineWidth=e.lineWidth,t.strokeStyle=null!==(h=e.stroke)&&void 0!==h?h:"",t.stroke()})),_=G.sprite(l);_.offset(n-i,r-i);return G.create().append(_)},this.label("Planck"),this.options.speed=null!==(i=e.speed)&&void 0!==i?i:this.options.speed,this.options.hz=null!==(s=e.hz)&&void 0!==s?s:this.options.speed,Math.abs(this.options.hz)<1&&(this.options.hz=1/this.options.hz),this.options.scaleY=null!==(o=e.scaleY)&&void 0!==o?o:this.options.scaleY,this.options.ratio=null!==(n=e.ratio)&&void 0!==n?n:this.options.ratio,this.options.lineWidth=2/this.options.ratio,this.world=t;const r=1/this.options.hz;let h=0,a=!1;this.tick((e=>{if(a)return!1;try{for(e=.001*e*this.options.speed,h+=e;h>r;)t.step(r),h-=r;return this.renderWorld(),!0}catch(t){return a=!0,console.error(t),!1}}),!0),t.on("remove-fixture",(t=>{var e;null===(e=this.nodes.get(t))||void 0===e||e.remove()})),t.on("remove-joint",(t=>{var e;null===(e=this.nodes.get(t))||void 0===e||e.remove()}))}}const vn=new fn;function An(t,e){let i;if("function"==typeof t?i=t:"function"==typeof e&&(i=e),!i)return vn;{const t=i(vn);vn.start(t)}}var bn=Object.freeze({__proto__:null,Testbed:fn,testbed:An,Serializer:mo,math:$,Vec2:tt,Vec3:xs,Mat22:pi,Mat33:Ys,Transform:Ot,Rot:Rt,AABB:et,Shape:Xt,FixtureProxy:Gt,Fixture:Qt,MassData:he,Body:ae,ContactEdge:Di,mixFriction:ji,mixRestitution:Ri,VelocityConstraintPoint:Ei,Contact:ds,JointEdge:me,Joint:ce,World:ys,CircleShape:Ds,Circle:js,EdgeShape:vs,Edge:As,PolygonShape:zs,Polygon:Fs,ChainShape:ws,Chain:Cs,BoxShape:ks,Box:Ls,CollideCircles:uo,CollideEdgeCircle:Ao,CollidePolygons:Ro,CollidePolygonCircle:Oo,CollideEdgePolygon:dn,DistanceJoint:Ns,FrictionJoint:Os,GearJoint:Zs,MotorJoint:Gs,MouseJoint:$s,PrismaticJoint:Hs,PulleyJoint:eo,RevoluteJoint:Js,RopeJoint:so,WeldJoint:no,WheelJoint:ho,Settings:it,SettingsInternal:st,Sweep:Et,get ManifoldType(){return t.ManifoldType},get ContactFeatureType(){return t.ContactFeatureType},get PointState(){return t.PointState},ClipVertex:Vi,Manifold:Ii,ManifoldPoint:Si,ContactID:Pi,WorldManifold:Ti,getPointStates:zi,clipSegmentToLine:Fi,DistanceInput:Ae,DistanceOutput:be,SimplexCache:Be,Distance:we,DistanceProxy:Ce,testOverlap:ke,ShapeCastInput:Le,ShapeCastOutput:qe,ShapeCast:De,TOIInput:je,get TOIOutputState(){return t.TOIOutputState},TOIOutput:Ne,TimeOfImpact:ti,TreeNode:nt,DynamicTree:ht,stats:le,Math:pn,internal:yn});t.AABB=et,t.Body=ae,t.Box=Ls,t.BoxShape=ks,t.Chain=Cs,t.ChainShape=ws,t.Circle=js,t.CircleShape=Ds,t.ClipVertex=Vi,t.CollideCircles=uo,t.CollideEdgeCircle=Ao,t.CollideEdgePolygon=dn,t.CollidePolygonCircle=Oo,t.CollidePolygons=Ro,t.Contact=ds,t.ContactEdge=Di,t.ContactID=Pi,t.Distance=we,t.DistanceInput=Ae,t.DistanceJoint=Ns,t.DistanceOutput=be,t.DistanceProxy=Ce,t.DynamicTree=ht,t.Edge=As,t.EdgeShape=vs,t.Fixture=Qt,t.FixtureProxy=Gt,t.FrictionJoint=Os,t.GearJoint=Zs,t.Joint=ce,t.JointEdge=me,t.Manifold=Ii,t.ManifoldPoint=Si,t.MassData=he,t.Mat22=pi,t.Mat33=Ys,t.Math=pn,t.MotorJoint=Gs,t.MouseJoint=$s,t.Polygon=Fs,t.PolygonShape=zs,t.PrismaticJoint=Hs,t.PulleyJoint=eo,t.RevoluteJoint=Js,t.RopeJoint=so,t.Rot=Rt,t.Serializer=mo,t.Settings=it,t.SettingsInternal=st,t.Shape=Xt,t.ShapeCast=De,t.ShapeCastInput=Le,t.ShapeCastOutput=qe,t.SimplexCache=Be,t.Sweep=Et,t.TOIInput=je,t.TOIOutput=Ne,t.Testbed=fn,t.TimeOfImpact=ti,t.Transform=Ot,t.TreeNode=nt,t.Vec2=tt,t.Vec3=xs,t.VelocityConstraintPoint=Ei,t.WeldJoint=no,t.WheelJoint=ho,t.World=ys,t.WorldManifold=Ti,t.clipSegmentToLine=Fi,t.default=bn,t.getPointStates=zi,t.internal=yn,t.math=$,t.mixFriction=ji,t.mixRestitution=Ri,t.stats=le,t.testOverlap=ke,t.testbed=An,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=planck-with-testbed.min.js.map
